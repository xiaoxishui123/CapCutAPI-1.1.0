# CapCutAPI 需求文档

## 📋 项目概述

### 项目名称
CapCutAPI - 开源剪映API工具

### 项目版本
v1.2.0 Enhanced Edition

### 项目目标
提供一个功能完整、易于使用的剪映API服务，支持草稿创建、素材管理、效果应用、批量处理和云端存储等核心功能，为开发者和内容创作者提供强大的视频编辑自动化解决方案。

### 目标用户
- 视频内容创作者
- 自动化视频生成开发者
- 批量视频处理需求的企业用户
- AI视频生成应用开发者

## 🎯 核心功能需求

### 1. 草稿管理功能

#### 1.1 草稿创建与编辑
- **需求描述**: 支持创建新的剪映草稿，设置基本参数
- **功能规格**:
  - 支持自定义草稿ID
  - 支持设置视频分辨率（宽度、高度）
  - 支持多种视频比例（9:16, 16:9, 1:1等）
  - 自动生成草稿元数据
- **API端点**: `POST /create_draft`
- **优先级**: 高

#### 1.2 草稿保存与存储
- **需求描述**: 支持将草稿保存到本地或云端存储
- **功能规格**:
  - 本地保存模式：保存到指定目录
  - 云端保存模式：自动上传到阿里云OSS
  - 支持草稿压缩打包
  - 自动清理临时文件
- **API端点**: `POST /save_draft`
- **优先级**: 高

#### 1.3 草稿列表与查询
- **需求描述**: 提供草稿列表查询和管理功能
- **功能规格**:
  - 扫描本地和云端草稿
  - 显示草稿元数据（创建时间、大小、素材数量等）
  - 支持按ID搜索草稿
  - 支持草稿状态分类
- **API端点**: `GET /api/drafts/list`
- **优先级**: 中

### 2. 素材管理功能

#### 2.1 视频素材处理
- **需求描述**: 支持添加和编辑视频素材
- **功能规格**:
  - 支持多种视频格式（MP4, MOV, AVI等）
  - 支持视频裁剪（开始时间、结束时间）
  - 支持视频缩放和位置调整
  - 支持播放速度调整
  - 支持音量控制
- **API端点**: `POST /add_video`
- **优先级**: 高

#### 2.2 音频素材处理
- **需求描述**: 支持添加和编辑音频素材
- **功能规格**:
  - 支持多种音频格式（MP3, WAV, AAC等）
  - 支持音频裁剪
  - 支持音量调整
  - 支持音频淡入淡出效果
- **API端点**: `POST /add_audio`
- **优先级**: 高

#### 2.3 图片素材处理
- **需求描述**: 支持添加和编辑图片素材
- **功能规格**:
  - 支持多种图片格式（JPG, PNG, GIF等）
  - 支持图片缩放和位置调整
  - 支持显示时长设置
  - 支持图片动画效果
- **API端点**: `POST /add_image`
- **优先级**: 中

#### 2.4 文本素材处理
- **需求描述**: 支持添加和编辑文本素材
- **功能规格**:
  - 支持自定义文本内容
  - 支持字体选择和大小调整
  - 支持文本颜色和样式设置
  - 支持文本位置和动画
  - 支持文本描边和阴影效果
- **API端点**: `POST /add_text`
- **优先级**: 高

#### 2.5 字幕功能
- **需求描述**: 支持添加和编辑字幕
- **功能规格**:
  - 支持字幕文本设置
  - 支持字幕样式自定义
  - 支持字幕时间轴控制
  - 支持多语言字幕
- **API端点**: `POST /add_subtitle`
- **优先级**: 中

### 3. 特效与动画功能

#### 3.1 转场效果
- **需求描述**: 支持添加视频转场效果
- **功能规格**:
  - 提供多种转场类型（淡入淡出、滑动、缩放等）
  - 支持转场时长调整
  - 支持自定义转场参数
- **API端点**: `POST /add_effect`
- **优先级**: 中

#### 3.2 动画效果
- **需求描述**: 支持为素材添加动画效果
- **功能规格**:
  - 入场动画（从无到有的动画）
  - 出场动画（从有到无的动画）
  - 循环动画（持续播放的动画）
  - 自定义动画参数
- **API端点**: `GET /get_intro_animation_types`, `GET /get_outro_animation_types`
- **优先级**: 中

#### 3.3 滤镜和遮罩
- **需求描述**: 支持添加视觉滤镜和遮罩效果
- **功能规格**:
  - 多种滤镜效果（美颜、复古、黑白等）
  - 遮罩形状选择（圆形、方形、自定义等）
  - 效果强度调整
- **API端点**: `GET /get_mask_types`
- **优先级**: 低

### 4. 用户界面功能

#### 4.1 草稿管理仪表板
- **需求描述**: 提供可视化的草稿管理界面
- **功能规格**:
  - 草稿列表展示
  - 草稿预览功能
  - 批量操作支持（下载、删除）
  - 搜索和筛选功能
  - 响应式设计，支持多设备访问
- **访问路径**: `/api/drafts/dashboard`
- **优先级**: 中

#### 4.2 草稿预览界面
- **需求描述**: 提供沉浸式的草稿预览体验
- **功能规格**:
  - 可视化时间轴显示
  - 素材详情展示
  - 交互式预览控制
  - 专业的视觉设计
  - 素材统计信息
- **访问路径**: `/draft/preview/<draft_id>`
- **优先级**: 中

#### 4.3 草稿下载界面
- **需求描述**: 提供智能化的草稿下载功能
- **功能规格**:
  - 自动检测云端文件
  - 多平台路径适配
  - 下载进度显示
  - 错误处理和重试机制
  - 路径配置和预览
- **访问路径**: `/draft/downloader`
- **优先级**: 中

### 5. 批量处理功能

#### 5.1 批量下载
- **需求描述**: 支持一次性下载多个草稿
- **功能规格**:
  - 支持多草稿ID批量处理
  - 并发下载提升效率
  - 详细的成功/失败报告
  - 支持断点续传
- **API端点**: `POST /api/drafts/batch-download`
- **优先级**: 中

#### 5.2 批量操作
- **需求描述**: 支持对多个草稿进行批量操作
- **功能规格**:
  - 批量删除草稿
  - 批量修改草稿属性
  - 批量导出草稿
- **优先级**: 低

### 6. 云端存储功能

#### 6.1 OSS集成
- **需求描述**: 集成阿里云OSS存储服务
- **功能规格**:
  - 自动上传草稿到OSS
  - 生成可下载的云端URL
  - 支持大文件分片上传
  - 自动清理本地临时文件
- **配置项**: `is_upload_draft: true`
- **优先级**: 高

#### 6.2 URL生成
- **需求描述**: 生成草稿的下载链接
- **功能规格**:
  - 标准直链生成
  - 定制化下载链接（按客户端系统）
  - 链接有效期管理
  - 访问权限控制
- **API端点**: `POST /generate_draft_url`
- **优先级**: 高

## 🔧 技术需求

### 1. 系统架构需求

#### 1.1 后端架构
- **框架**: Flask (Python)
- **数据库**: SQLite (本地) / PostgreSQL (生产)
- **存储**: 本地文件系统 + 阿里云OSS
- **缓存**: 内存缓存 + 文件缓存

#### 1.2 前端架构
- **技术栈**: 纯HTML/CSS/JavaScript
- **设计**: 响应式设计，支持多设备
- **样式**: CSS Grid/Flexbox布局
- **交互**: 原生JavaScript，无第三方依赖

### 2. 性能需求

#### 2.1 响应时间
- API响应时间 < 2秒
- 页面加载时间 < 3秒
- 文件上传速度 > 1MB/s

#### 2.2 并发处理
- 支持至少50个并发用户
- 支持批量操作的并发处理
- 合理的资源使用率

#### 2.3 存储优化
- 自动清理临时文件
- 压缩算法优化
- 云端存储成本控制

### 3. 安全需求

#### 3.1 数据安全
- 敏感信息环境变量配置
- API访问频率限制
- 文件上传安全检查

#### 3.2 系统安全
- 非root用户运行服务
- 防火墙端口控制
- 日志记录和监控

### 4. 兼容性需求

#### 4.1 系统兼容性
- Linux (CentOS, Ubuntu)
- Windows (开发环境)
- macOS (开发环境)

#### 4.2 Python版本
- Python 3.8.20+
- 推荐使用Python 3.9

#### 4.3 浏览器兼容性
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 📊 质量需求

### 1. 可用性需求
- 系统可用性 > 99%
- 7x24小时服务运行
- 自动故障恢复机制

### 2. 可维护性需求
- 模块化代码结构
- 完整的API文档
- 详细的错误日志
- 自动化部署脚本

### 3. 可扩展性需求
- 支持水平扩展
- 插件化架构设计
- API版本控制

### 4. 用户体验需求
- 直观的用户界面
- 清晰的错误提示
- 完整的操作反馈
- 多语言支持（中英文）

## 🚀 部署需求

### 1. 环境要求
- Python 3.8.20+
- ffmpeg
- systemd服务管理
- 网络连接（用于云端存储）

### 2. 配置要求
- 配置文件：`config.json`
- 环境变量：OSS相关配置
- 服务端口：9000（可配置）
- 日志目录：`logs/`

### 3. 服务管理
- systemd服务配置
- 自动启动和重启
- 日志轮转和清理
- 健康检查机制

## 📋 验收标准

### 1. 功能验收
- [ ] 所有API端点正常响应
- [ ] 草稿创建和保存功能正常
- [ ] 素材添加功能完整
- [ ] 用户界面功能正常
- [ ] 批量处理功能可用
- [ ] 云端存储功能稳定

### 2. 性能验收
- [ ] API响应时间符合要求
- [ ] 并发处理能力达标
- [ ] 存储优化效果明显

### 3. 安全验收
- [ ] 敏感信息安全配置
- [ ] 系统安全措施到位
- [ ] 访问控制正常

### 4. 兼容性验收
- [ ] 多系统兼容性测试通过
- [ ] 多浏览器兼容性测试通过
- [ ] Python版本兼容性确认

## 📅 开发计划

### 阶段一：核心功能开发 ✅
- 草稿管理基础功能
- 素材处理核心API
- 基本的保存和存储功能

### 阶段二：界面和体验优化 ✅
- 草稿管理仪表板
- 草稿预览界面
- 草稿下载界面
- 响应式设计优化

### 阶段三：高级功能开发 ✅
- 批量处理功能
- 云端存储集成
- 性能优化
- 安全加固

### 阶段四：文档和部署 🔄
- 完善API文档
- 用户操作指南
- 自动化部署脚本
- 测试用例完善

---

**文档版本**: v1.2.0  
**最后更新**: 2025年1月21日  
**状态**: 已完成核心功能，持续优化中