app:
  description: è±†åŒ…æ–‡ç”Ÿå›¾æ‰¹é‡å¤„ç†ä¼˜åŒ–ç‰ˆå·¥ä½œæµã€‚é‡‡ç”¨å¹¶è¡Œå¤„ç†æ¶æ„ï¼Œæ”¯æŒå›¾ç‰‡ç”Ÿæˆå’Œè¯­éŸ³åˆæˆåŒæ—¶è¿›è¡Œï¼ŒåŒ…å«æ™ºèƒ½é‡è¯•ã€äº‹åŠ¡æ€§å¤„ç†å’Œèµ„æºç®¡ç†æœºåˆ¶ã€‚
  icon: ğŸš€
  icon_background: '#E3F2FD'
  mode: advanced-chat
  name: v11è±†åŒ…æ–‡ç”Ÿå›¾æ‰¹é‡å¤„ç†
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: allenwriter/doubao_image:0.0.1@d9cb638d96848452b8fc2296c61ce93082a5ffa6968a114c15d008cbd4b3730b
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/volcengine_maas:0.0.30@0e6b13a721cc8fb7b928787f86ffc57655ace2cbc938c4738c209d70b18a85f8
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: ''
    id: api_base_url
    name: api_base_url
    selector:
    - env
    - api_base_url
    value: http://8.148.70.18:9000
    value_type: string
  - description: å›¾ç‰‡å¼€å§‹æ—¶é—´åç§»é‡ï¼ˆç§’ï¼‰
    id: image_start_offset
    name: image_start_offset
    selector:
    - env
    - image_start_offset
    value: '0.05'
    value_type: string
  - description: æœ€å°åª’ä½“æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
    id: min_media_duration
    name: min_media_duration
    selector:
    - env
    - min_media_duration
    value: '0.1'
    value_type: string
  - description: é‡è¯•åŸºç¡€å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
    id: retry_base_delay
    name: retry_base_delay
    selector:
    - env
    - retry_base_delay
    value: '1'
    value_type: string
  features:
    file_upload:
      allowed_file_extensions: []
      allowed_file_types: []
      allowed_file_upload_methods: []
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 5
    opening_statement: 'ğŸš€ æ¬¢è¿ä½¿ç”¨è±†åŒ…æ–‡ç”Ÿå›¾æ‰¹é‡å¤„ç†å·¥å…·-ä¼˜åŒ–ç‰ˆï¼


      âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼š - ğŸ”„ å¹¶è¡Œå¤„ç†ï¼šå›¾ç‰‡ç”Ÿæˆå’Œè¯­éŸ³åˆæˆåŒæ—¶è¿›è¡Œï¼Œå¤§å¹…æå‡å¤„ç†é€Ÿåº¦ - ğŸ›¡ï¸ æ™ºèƒ½é‡è¯•ï¼šæŒ‡æ•°é€€é¿ç®—æ³•ï¼ŒAPIé™æµæ„ŸçŸ¥ - ğŸ”§ äº‹åŠ¡æ€§å¤„ç†ï¼šè‡ªåŠ¨èµ„æºæ¸…ç†ï¼Œæ”¯æŒéƒ¨åˆ†é‡è¯•
      - â±ï¸ é…ç½®åŒ–æ—¶é—´åŒæ­¥ï¼šçµæ´»çš„åª’ä½“å¯¹é½ç­–ç•¥


      ğŸ“‹ **æ ¸å¿ƒåŠŸèƒ½**ï¼š - ğŸ¬ è‡ªåŠ¨ç”ŸæˆçŸ­è§†é¢‘è„šæœ¬å¹¶è½¬æ¢ä¸ºSRTå­—å¹• - ğŸ–¼ï¸ åŸºäºå­—å¹•å†…å®¹æ‰¹é‡ç”Ÿæˆé«˜è´¨é‡å›¾åƒ - âœ¨ æ™ºèƒ½æç¤ºè¯ä¼˜åŒ–ï¼Œæ”¯æŒå¤šç§è‰ºæœ¯é£æ ¼
      - ğŸ“Š è¯¦ç»†çš„å¤„ç†è¿›åº¦å’Œç»“æœç»Ÿè®¡ - ğŸµ å®Œæ•´çš„è§†é¢‘åˆæˆæµæ°´çº¿


      ğŸ’¡ **ä½¿ç”¨æ–¹æ³•**ï¼š 1. è¾“å…¥æ‚¨çš„è§†é¢‘ä¸»é¢˜æˆ–è„šæœ¬å†…å®¹ 2. é€‰æ‹©å›¾åƒå°ºå¯¸å’Œé£æ ¼ï¼ˆrealistic/anime/oil_paintingç­‰ï¼‰ 3.
      è®¾ç½®æ‰¹å¤„ç†å¤§å°å’Œé‡è¯•æ¬¡æ•° 4. ç‚¹å‡»å¼€å§‹ï¼Œäº«å—é«˜æ•ˆçš„å¹¶è¡Œå¤„ç†ä½“éªŒï¼


      ğŸ¯ æ–°ç‰ˆæœ¬å¤„ç†é€Ÿåº¦æå‡50%+ï¼Œé”™è¯¯å¤„ç†æ›´æ™ºèƒ½ï¼'
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: if-else
        targetType: code
      id: 1760603125046-true-17606215510130-target
      selected: false
      source: '1760603125046'
      sourceHandle: 'true'
      target: '17606215510130'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: tool
        targetType: code
      id: 1760603213982-source-17606215510130-target
      selected: false
      source: '1760603213982'
      sourceHandle: source
      target: '17606215510130'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: start_1-source-1760621763757-target
      selected: false
      source: start_1
      sourceHandle: source
      target: '1760621763757'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1760621763757-source-1760621945531-target
      selected: false
      source: '1760621763757'
      sourceHandle: source
      target: '1760621945531'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1760621945531-source-1760622014513-target
      selected: false
      source: '1760621945531'
      sourceHandle: source
      target: '1760622014513'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: code
      id: 1760622014513-source-code_input_validation-target
      selected: false
      source: '1760622014513'
      sourceHandle: source
      target: code_input_validation
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: code_input_validation-source-parallel_gateway-target
      selected: false
      source: code_input_validation
      sourceHandle: source
      target: parallel_gateway
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: iteration
      id: parallel_gateway-source-1760602669786-target
      selected: false
      source: parallel_gateway
      sourceHandle: source
      target: '1760602669786'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: iteration
        targetType: code
      id: 1760602669786-source-sync_gateway-target
      selected: false
      source: '1760602669786'
      sourceHandle: source
      target: sync_gateway
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: sync_gateway-source-code_aggregate_results-target
      selected: false
      source: sync_gateway
      sourceHandle: source
      target: code_aggregate_results
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: http-request
      id: code_aggregate_results-source-1761041582774-target
      selected: false
      source: code_aggregate_results
      sourceHandle: source
      target: '1761041582774'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 1761041582774-source-1761042052305-target
      selected: false
      source: '1761041582774'
      sourceHandle: source
      target: '1761042052305'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: http-request
      id: 17610437227200-source-17610437271090-target
      selected: false
      source: '17610437227200'
      sourceHandle: source
      target: '17610437271090'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: iteration
      id: parallel_gateway-source-1761044157730-target
      selected: false
      source: parallel_gateway
      sourceHandle: source
      target: '1761044157730'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761044157730'
        sourceType: iteration-start
        targetType: tool
      id: 1761044157730start-source-1761044198738-target
      selected: false
      source: 1761044157730start
      sourceHandle: source
      target: '1761044198738'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761044157730'
        sourceType: tool
        targetType: code
      id: 1761044198738-source-1761044567218-target
      selected: false
      source: '1761044198738'
      sourceHandle: source
      target: '1761044567218'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1761044157730'
        sourceType: code
        targetType: code
      id: 1761044567218-source-1761044999999-target
      selected: false
      source: '1761044567218'
      sourceHandle: source
      target: '1761044999999'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: 1761042052305-source-17610450813550-target
      source: '1761042052305'
      sourceHandle: source
      target: '17610450813550'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: 17610450813550-source-code_batch_add_images-target
      source: '17610450813550'
      sourceHandle: source
      target: code_batch_add_images
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: iteration
        targetType: code
      id: 1761044157730-source-sync_gateway-target
      selected: false
      source: '1761044157730'
      sourceHandle: source
      target: sync_gateway
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: http-request
      id: 17610437271090-source-17610453130500-target
      source: '17610437271090'
      sourceHandle: source
      target: '17610453130500'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: answer
      id: 1761045650096-source-answer_1-target
      source: '1761045650096'
      sourceHandle: source
      target: answer_1
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 17610453130500-source-1761045650096-target
      source: '17610453130500'
      sourceHandle: source
      target: '1761045650096'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: iteration-start
        targetType: llm
      id: 1760602669786start-source-17606223903400-target
      source: 1760602669786start
      sourceHandle: source
      target: '17606223903400'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: llm
        targetType: tool
      id: 17606223903400-source-1760602895868-target
      source: '17606223903400'
      sourceHandle: source
      target: '1760602895868'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: tool
        targetType: code
      id: 1760602895868-source-1760999999001-target
      source: '1760602895868'
      sourceHandle: source
      target: '1760999999001'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: code
        targetType: code
      id: 1760999999001-source-1760602942927-target
      source: '1760999999001'
      sourceHandle: source
      target: '1760602942927'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: code
        targetType: if-else
      id: 1760602942927-source-1760603125046-target
      source: '1760602942927'
      sourceHandle: source
      target: '1760603125046'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: if-else
        targetType: tool
      id: 1760603125046-retry-1760603213982-target
      source: '1760603125046'
      sourceHandle: retry
      target: '1760603213982'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        sourceType: if-else
        targetType: code
      id: 1760603125046-328e3dc0-d189-4b54-b120-17bd316652e1-17606215510130-target
      source: '1760603125046'
      sourceHandle: 328e3dc0-d189-4b54-b120-17bd316652e1
      target: '17606215510130'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: code
      id: code_batch_add_images-source-1761461437058-target
      source: code_batch_add_images
      sourceHandle: source
      target: '1761461437058'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: http-request
      id: 1761461437058-source-17610437227200-target
      source: '1761461437058'
      sourceHandle: source
      target: '17610437227200'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - default: 1024x1024
          label: å›¾åƒå°ºå¯¸
          max_length: 20
          options:
          - 512x512
          - 1024x1024
          - 1024x768
          - 768x1024
          required: false
          type: select
          variable: image_size
        - default: realistic
          label: å›¾åƒé£æ ¼
          max_length: 20
          options:
          - realistic
          - anime
          - oil_painting
          - watercolor
          - sketch
          required: false
          type: select
          variable: image_style
        - default: '3'
          label: æ‰¹å¤„ç†å¤§å°
          max_length: 10
          options: []
          required: false
          type: number
          variable: batch_size
        - default: '1'
          label: æœ€å¤§é‡è¯•æ¬¡æ•°
          max_length: 10
          options: []
          required: false
          type: number
          variable: max_retries
        - default: ''
          hint: ''
          label: è„šæœ¬/ä¸»é¢˜
          max_length: 256
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: prompt
        - default: '5'
          hint: ''
          label: æ—¶é•¿ï¼ˆç§’ï¼‰
          max_length: 48
          options:
          - '5'
          - '10'
          - '15'
          - '30'
          - '60'
          placeholder: ''
          required: true
          type: select
          variable: duration
        - default: '1080'
          hint: ''
          label: ç”»é¢å®½åº¦
          max_length: 10
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: width
        - default: '1920'
          hint: ''
          label: ç”»é¢é«˜åº¦
          max_length: 10
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: height
        - default: SourceHanSansCN_Regular
          hint: ''
          label: å­—ä½“ï¼ˆå­—å¹•/æ ‡é¢˜ï¼‰
          max_length: 48
          options:
          - SourceHanSansCN_Regular
          - SourceHanSansCN_Bold
          - MiSans_Regular
          - HarmonyOS_Sans_SC_Regular
          placeholder: ''
          required: true
          type: select
          variable: font
        - default: zh_male_dongfanghaoran_moon_bigtts
          hint: ''
          label: æ—ç™½éŸ³è‰²
          max_length: 48
          options:
          - zh_male_dongfanghaoran_moon_bigtts
          - zh_female_tianmei_moon_bigtts
          - zh_male_zhigang_moon_bigtts
          - zh_female_siyue_moon_bigtts
          - zh_male_kaikai_moon_bigtts
          - zh_female_xiaoyu_moon_bigtts
          - zh_male_zhengqi_moon_bigtts
          - zh_female_xiaomo_moon_bigtts
          - zh_male_zhihao_moon_bigtts
          - zh_female_xiaoxin_moon_bigtts
          placeholder: ''
          required: false
          type: select
          variable: tts_voice
        - default: https://sf16-ies-music-va.tiktokcdn.com/obj/tos-useast2a-ve-2774/oQeNAeaxIwAEtoADBAjwbzEfwbDrD6AhAjBzAn/?filename=7426692799697693483.mp3&br=128&tat=0&aid=6383
          hint: ''
          label: BGM éŸ³é¢‘URLï¼ˆå¯é€‰ï¼‰
          max_length: 512
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: bgm_url
      height: 347
      id: start_1
      position:
        x: 30
        y: 423
      positionAbsolute:
        x: 30
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(valid: bool, srt_array: list, config: dict, validation_info:\
          \ str) -> dict:\n    \"\"\"\n    å¹¶è¡Œç½‘å…³ï¼šéªŒè¯è¾“å…¥å¹¶å‡†å¤‡å¯åŠ¨å¹¶è¡Œå¤„ç†åˆ†æ”¯\n    \n    åŠŸèƒ½è¯´æ˜ï¼š\n\
          \    1. æ¥æ”¶è¾“å…¥éªŒè¯ç»“æœ\n    2. æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§\n    3. å‡†å¤‡å¹¶è¡Œå¤„ç†çš„é…ç½®\n    4. ä¸ºæ–‡ç”Ÿå›¾å’Œè¯­éŸ³åˆæˆä¸¤ä¸ªå¹¶è¡Œåˆ†æ”¯æä¾›æ•°æ®\n\
          \    \n    Args:\n        valid: è¾“å…¥éªŒè¯ç»“æœ\n        srt_array: SRTå­—å¹•æ•°ç»„\n  \
          \      config: é…ç½®å‚æ•°\n        validation_info: éªŒè¯ä¿¡æ¯\n        \n    Returns:\n\
          \        åŒ…å«SRTæ•°ç»„ã€é…ç½®å’Œåˆ†æ”¯æ•°æ®çš„å­—å…¸ï¼Œä¾›å¹¶è¡Œåˆ†æ”¯ä½¿ç”¨\n    \"\"\"\n    import logging\n  \
          \  import time\n    from datetime import datetime\n    \n    # è®°å½•å¼€å§‹æ—¶é—´\n\
          \    start_time = datetime.now().strftime(\"%H:%M:%S\")\n    transaction_id\
          \ = f\"gateway_{int(time.time() * 1000)}\"\n    \n    logging.info(f\"\U0001F6AA\
          \ å¹¶è¡Œç½‘å…³ [{transaction_id}]: æ¥æ”¶åˆ° {len(srt_array) if srt_array else 0} ä¸ªå­—å¹•æ®µè½\"\
          )\n    \n    # éªŒè¯è¾“å…¥\n    if not valid:\n        error_msg = \"è¾“å…¥éªŒè¯å¤±è´¥ï¼Œæ— æ³•å¯åŠ¨å¹¶è¡Œå¤„ç†\"\
          \n        logging.error(f\"âŒ å¹¶è¡Œç½‘å…³: {error_msg}\")\n        return {\n  \
          \          \"success\": False,\n            \"error\": error_msg,\n    \
          \        \"error_type\": \"validation_failed\",\n            \"error_details\"\
          : {\"reason\": \"è¾“å…¥éªŒè¯å¤±è´¥\", \"valid\": valid},\n            \"srt_array\"\
          : [],\n            \"config\": config or {},\n            \"branch_data\"\
          : {},\n            \"start_time\": start_time,\n            \"transaction_id\"\
          : transaction_id,\n            \"total_items\": 0,\n            \"validation_info\"\
          : validation_info,\n            \"progress_info\": \"âŒ è¾“å…¥éªŒè¯å¤±è´¥\",\n     \
          \       \"recovery_info\": \"è¯·æ£€æŸ¥è¾“å…¥æ•°æ®\",\n            \"performance_info\"\
          : {\"status\": \"failed\"},\n            \"resource_status\": {\"allocated\"\
          : False}\n        }\n    \n    if not srt_array or len(srt_array) == 0:\n\
          \        error_msg = \"SRTæ•°ç»„ä¸ºç©ºï¼Œæ— æ³•å¤„ç†\"\n        logging.error(f\"âŒ å¹¶è¡Œç½‘å…³:\
          \ {error_msg}\")\n        return {\n            \"success\": False,\n  \
          \          \"error\": error_msg,\n            \"error_type\": \"empty_data\"\
          ,\n            \"error_details\": {\"reason\": \"SRTæ•°ç»„ä¸ºç©º\", \"length\":\
          \ 0},\n            \"srt_array\": [],\n            \"config\": config or\
          \ {},\n            \"branch_data\": {},\n            \"start_time\": start_time,\n\
          \            \"transaction_id\": transaction_id,\n            \"total_items\"\
          : 0,\n            \"validation_info\": validation_info,\n            \"\
          progress_info\": \"âŒ SRTæ•°ç»„ä¸ºç©º\",\n            \"recovery_info\": \"è¯·æä¾›æœ‰æ•ˆçš„SRTæ•°æ®\"\
          ,\n            \"performance_info\": {\"status\": \"failed\"},\n       \
          \     \"resource_status\": {\"allocated\": False}\n        }\n    \n   \
          \ # å‡†å¤‡å¹¶è¡Œå¤„ç†æ•°æ®\n    total_items = len(srt_array)\n    \n    # å‡†å¤‡åˆ†æ”¯æ•°æ®\n   \
          \ branch_data = {\n        \"image_branch\": {\n            \"enabled\"\
          : True,\n            \"items\": total_items,\n            \"config\": config\n\
          \        },\n        \"audio_branch\": {\n            \"enabled\": True,\n\
          \            \"items\": total_items,\n            \"config\": config\n \
          \       }\n    }\n    \n    logging.info(f\"âœ… å¹¶è¡Œç½‘å…³ [{transaction_id}]: å‡†å¤‡å¯åŠ¨å¹¶è¡Œå¤„ç†\"\
          )\n    logging.info(f\"   - æ–‡ç”Ÿå›¾åˆ†æ”¯: {total_items} ä¸ªä»»åŠ¡\")\n    logging.info(f\"\
          \   - è¯­éŸ³åˆæˆåˆ†æ”¯: {total_items} ä¸ªä»»åŠ¡\")\n    logging.info(f\"   - é…ç½®: {config}\"\
          )\n    \n    # è¿”å›æ•°æ®ä¾›å¹¶è¡Œåˆ†æ”¯ä½¿ç”¨\n    return {\n        \"success\": True,\n \
          \       \"error\": \"\",\n        \"error_type\": \"\",\n        \"error_details\"\
          : {},\n        \"srt_array\": srt_array,\n        \"config\": config,\n\
          \        \"branch_data\": branch_data,\n        \"start_time\": start_time,\n\
          \        \"transaction_id\": transaction_id,\n        \"total_items\": total_items,\n\
          \        \"validation_info\": validation_info,\n        \"progress_info\"\
          : f\"âœ“ å¹¶è¡Œç½‘å…³å‡†å¤‡å°±ç»ª - å¯åŠ¨ {total_items} ä¸ªå¹¶è¡Œä»»åŠ¡\",\n        \"recovery_info\":\
          \ \"\",\n        \"performance_info\": {\n            \"status\": \"ready\"\
          ,\n            \"preparation_time\": \"0.001s\"\n        },\n        \"\
          resource_status\": {\n            \"allocated\": True,\n            \"image_branch_ready\"\
          : True,\n            \"audio_branch_ready\": True\n        }\n    }\n"
        code_language: python3
        desc: å¹¶è¡Œç½‘å…³ï¼Œåˆ†å‘æ•°æ®åˆ°å›¾ç‰‡ç”Ÿæˆå’Œè¯­éŸ³åˆæˆåˆ†æ”¯
        outputs:
          branch_data:
            children: null
            type: object
          config:
            children: null
            type: object
          error:
            children: null
            type: string
          error_details:
            children: null
            type: object
          error_type:
            children: null
            type: string
          performance_info:
            children: null
            type: object
          progress_info:
            children: null
            type: string
          recovery_info:
            children: null
            type: string
          resource_status:
            children: null
            type: object
          srt_array:
            children: null
            type: array[object]
          start_time:
            children: null
            type: string
          success:
            children: null
            type: boolean
          total_items:
            children: null
            type: number
          transaction_id:
            children: null
            type: string
          validation_info:
            children: null
            type: string
        selected: false
        title: å¹¶è¡Œç½‘å…³
        type: code
        variables:
        - value_selector:
          - code_input_validation
          - valid
          value_type: boolean
          variable: valid
        - value_selector:
          - code_input_validation
          - srt_array
          value_type: array[object]
          variable: srt_array
        - value_selector:
          - code_input_validation
          - config
          value_type: object
          variable: config
        - value_selector:
          - code_input_validation
          - validation_info
          value_type: string
          variable: validation_info
      height: 95
      id: parallel_gateway
      position:
        x: 1540
        y: 423
      positionAbsolute:
        x: 1540
        y: 423
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(srt_array: list, image_size: str, image_style: str, batch_size:\
          \ int, max_retries: int) -> dict:\n    \"\"\"\n    éªŒè¯è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§å¹¶æä¾›è¯¦ç»†çš„éªŒè¯åé¦ˆ\n\
          \    \n    åŠŸèƒ½è¯´æ˜ï¼š\n    1. æ£€æŸ¥ srt_array æ˜¯å¦ä¸ºç©º\n    2. éªŒè¯ image_sizeã€image_style\
          \ ç­‰å‚æ•°æ˜¯å¦æœ‰æ•ˆ\n    3. è®¾ç½®é»˜è®¤å€¼\n    4. è¿”å›éªŒè¯åçš„é…ç½®\n    5. éªŒè¯SRTæ•°ç»„ä¸­æ¯ä¸ªé¡¹ç›®çš„ç»“æ„\n    6.\
          \ æä¾›è¯¦ç»†çš„SRTè§£æçŠ¶æ€ä¿¡æ¯\n    \n    Args:\n        srt_array: SRTå­—å¹•æ•°ç»„\n        image_size:\
          \ å›¾åƒå°ºå¯¸\n        image_style: å›¾åƒé£æ ¼\n        batch_size: æ‰¹å¤„ç†å¤§å°\n        max_retries:\
          \ æœ€å¤§é‡è¯•æ¬¡æ•°\n        \n    Returns:\n        éªŒè¯åçš„é…ç½®å­—å…¸\n    \"\"\"\n    import\
          \ logging\n    import json\n    \n    validation_messages = []\n    warnings\
          \ = []\n    \n    # æ£€æŸ¥ srt_array æ˜¯å¦ä¸ºç©º\n    if not srt_array or len(srt_array)\
          \ == 0:\n        return {\n            \"valid\": False,\n            \"\
          error\": \"âŒ SRTæ•°ç»„ä¸ºç©ºï¼Œæ— æ³•å¤„ç†ã€‚è¯·ç¡®ä¿å·²æ­£ç¡®è§£æSRTå­—å¹•æ–‡ä»¶ã€‚\",\n            \"srt_array\"\
          : [],\n            \"config\": {},\n            \"validation_info\": \"\
          SRTæ•°æ®éªŒè¯å¤±è´¥\",\n            \"warnings\": []\n        }\n    \n    validation_messages.append(f\"\
          âœ… æˆåŠŸæ¥æ”¶åˆ°SRTæ•°ç»„ï¼ŒåŒ…å« {len(srt_array)} ä¸ªå­—å¹•æ®µè½\")\n    \n    # éªŒè¯SRTæ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹ç›®\n \
          \   valid_items = 0\n    for i, item in enumerate(srt_array):\n        if\
          \ not isinstance(item, dict):\n            return {\n                \"\
          valid\": False,\n                \"error\": f\"âŒ SRTæ•°ç»„ç¬¬{i+1}é¡¹ä¸æ˜¯æœ‰æ•ˆçš„å¯¹è±¡æ ¼å¼\"\
          ,\n                \"srt_array\": [],\n                \"config\": {},\n\
          \                \"validation_info\": f\"æ•°æ®æ ¼å¼éªŒè¯å¤±è´¥ï¼šç¬¬{i+1}é¡¹\",\n         \
          \       \"warnings\": warnings\n            }\n        \n        required_keys\
          \ = [\"index\", \"timestamp\", \"text\"]\n        missing_keys = []\n  \
          \      for key in required_keys:\n            if key not in item:\n    \
          \            missing_keys.append(key)\n        \n        if missing_keys:\n\
          \            return {\n                \"valid\": False,\n             \
          \   \"error\": f\"âŒ SRTæ•°ç»„ç¬¬{i+1}é¡¹ç¼ºå°‘å¿…éœ€å­—æ®µ: {', '.join(missing_keys)}\",\n \
          \               \"srt_array\": [],\n                \"config\": {},\n  \
          \              \"validation_info\": f\"å­—æ®µéªŒè¯å¤±è´¥ï¼šç¬¬{i+1}é¡¹ç¼ºå°‘{', '.join(missing_keys)}\"\
          ,\n                \"warnings\": warnings\n            }\n        \n   \
          \     # æ£€æŸ¥æ–‡æœ¬å†…å®¹\n        if not item.get('text', '').strip():\n         \
          \   warnings.append(f\"âš ï¸ ç¬¬{i+1}é¡¹æ–‡æœ¬å†…å®¹ä¸ºç©º\")\n        else:\n            valid_items\
          \ += 1\n    \n    validation_messages.append(f\"âœ… SRTæ•°æ®ç»“æ„éªŒè¯é€šè¿‡ï¼Œ{valid_items}\
          \ ä¸ªæœ‰æ•ˆå­—å¹•æ®µè½\")\n    \n    # éªŒè¯å›¾åƒå°ºå¯¸\n    valid_sizes = [\"512x512\", \"1024x1024\"\
          , \"1024x768\", \"768x1024\"]\n    if image_size not in valid_sizes:\n \
          \       return {\n            \"valid\": False,\n            \"error\":\
          \ f\"âŒ æ— æ•ˆçš„å›¾åƒå°ºå¯¸: {image_size}\\næ”¯æŒçš„å°ºå¯¸: {', '.join(valid_sizes)}\",\n    \
          \        \"srt_array\": [],\n            \"config\": {},\n            \"\
          validation_info\": f\"å›¾åƒå°ºå¯¸éªŒè¯å¤±è´¥ï¼š{image_size}\",\n            \"warnings\"\
          : warnings\n        }\n    \n    validation_messages.append(f\"âœ… å›¾åƒå°ºå¯¸éªŒè¯é€šè¿‡ï¼š{image_size}\"\
          )\n    \n    # éªŒè¯å›¾åƒé£æ ¼\n    valid_styles = [\"realistic\", \"anime\", \"\
          oil_painting\", \"watercolor\", \"sketch\"]\n    if image_style not in valid_styles:\n\
          \        return {\n            \"valid\": False,\n            \"error\"\
          : f\"âŒ æ— æ•ˆçš„å›¾åƒé£æ ¼: {image_style}\\næ”¯æŒçš„é£æ ¼: {', '.join(valid_styles)}\",\n  \
          \          \"srt_array\": [],\n            \"config\": {},\n           \
          \ \"validation_info\": f\"å›¾åƒé£æ ¼éªŒè¯å¤±è´¥ï¼š{image_style}\",\n            \"warnings\"\
          : warnings\n        }\n    \n    validation_messages.append(f\"âœ… å›¾åƒé£æ ¼éªŒè¯é€šè¿‡ï¼š{image_style}\"\
          )\n    \n    # è®¾ç½®é»˜è®¤å€¼å¹¶éªŒè¯èŒƒå›´\n    final_batch_size = max(1, min(int(batch_size)\
          \ if batch_size else 3, 10))\n    final_max_retries = max(0, min(int(max_retries)\
          \ if max_retries else 1, 3))\n    \n    if final_batch_size != batch_size:\n\
          \        warnings.append(f\"âš ï¸ æ‰¹å¤„ç†å¤§å°å·²è°ƒæ•´ä¸º {final_batch_size} (åŸå€¼: {batch_size})\"\
          )\n    \n    if final_max_retries != max_retries:\n        warnings.append(f\"\
          âš ï¸ æœ€å¤§é‡è¯•æ¬¡æ•°å·²è°ƒæ•´ä¸º {final_max_retries} (åŸå€¼: {max_retries})\")\n    \n    validated_config\
          \ = {\n        \"image_size\": image_size,\n        \"image_style\": image_style,\n\
          \        \"batch_size\": final_batch_size,\n        \"max_retries\": final_max_retries,\n\
          \        \"total_count\": len(srt_array),\n        \"valid_items\": valid_items,\n\
          \        \"estimated_batches\": (len(srt_array) + final_batch_size - 1)\
          \ // final_batch_size\n    }\n    \n    validation_messages.append(f\"âœ…\
          \ å‚æ•°é…ç½®å®Œæˆï¼šæ‰¹å¤„ç†å¤§å°={final_batch_size}ï¼Œæœ€å¤§é‡è¯•={final_max_retries}\")\n    validation_messages.append(f\"\
          \U0001F4CA å¤„ç†è®¡åˆ’ï¼š{len(srt_array)} ä¸ªå­—å¹•æ®µè½ï¼Œé¢„è®¡åˆ† {validated_config['estimated_batches']}\
          \ æ‰¹å¤„ç†\")\n    \n    validation_info = \"\\n\".join(validation_messages)\n\
          \    if warnings:\n        validation_info += \"\\n\\nâš ï¸ è­¦å‘Šä¿¡æ¯ï¼š\\n\" + \"\
          \\n\".join(warnings)\n    \n    # è¿”å›éªŒè¯ç»“æœ\n    return {\n        \"valid\"\
          : True,\n        \"error\": \"\",\n        \"srt_array\": srt_array,\n \
          \       \"config\": validated_config,\n        \"validation_info\": validation_info,\n\
          \        \"warnings\": warnings\n    }\n"
        code_language: python3
        desc: éªŒè¯è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œè®¾ç½®é»˜è®¤å€¼
        outputs:
          config:
            children: null
            type: object
          error:
            children: null
            type: string
          srt_array:
            children: null
            type: array[object]
          valid:
            children: null
            type: boolean
          validation_info:
            children: null
            type: string
          warnings:
            children: null
            type: array[string]
        selected: false
        title: è¾“å…¥å‚æ•°éªŒè¯
        type: code
        variables:
        - value_selector:
          - '1760622014513'
          - srt_array
          value_type: array[object]
          variable: srt_array
        - value_selector:
          - start_1
          - image_size
          value_type: string
          variable: image_size
        - value_selector:
          - start_1
          - image_style
          value_type: string
          variable: image_style
        - value_selector:
          - start_1
          - batch_size
          value_type: number
          variable: batch_size
        - value_selector:
          - start_1
          - max_retries
          value_type: number
          variable: max_retries
      height: 79
      id: code_input_validation
      position:
        x: 1238
        y: 423
      positionAbsolute:
        x: 1238
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(image_results: list = None, audio_results: list = None) ->\
          \ dict:\n    \"\"\"\n    å¢å¼ºçš„åŒæ­¥ç½‘å…³ï¼šç­‰å¾…å¹¶è¡Œåˆ†æ”¯å®Œæˆï¼Œåˆå¹¶ç»“æœï¼ŒåŒ…å«äº‹åŠ¡æ€§å¤„ç†\n    \n    åŠŸèƒ½è¯´æ˜ï¼š\n\
          \    1. æ¥æ”¶ä¸¤ä¸ªå¹¶è¡Œåˆ†æ”¯çš„ç»“æœ\n    2. éªŒè¯ä¸¤ä¸ªåˆ†æ”¯éƒ½å·²å®Œæˆ\n    3. åˆå¹¶ç»“æœå¹¶ä¼ é€’ç»™èšåˆèŠ‚ç‚¹\n    4. æä¾›åŒæ­¥çŠ¶æ€ä¿¡æ¯\n\
          \    5. äº‹åŠ¡æ€§å¤„ç†å’Œé”™è¯¯æ¢å¤\n    \n    Args:\n        image_results: å›¾åƒç”Ÿæˆåˆ†æ”¯çš„ç»“æœåˆ—è¡¨\n\
          \        audio_results: è¯­éŸ³åˆæˆåˆ†æ”¯çš„ç»“æœåˆ—è¡¨\n        \n    Returns:\n        åˆå¹¶åçš„ç»“æœï¼ŒåŒ…å«ä¸¤ä¸ªåˆ†æ”¯çš„æ•°æ®\n\
          \    \"\"\"\n    import logging\n    import time\n    import traceback\n\
          \    from datetime import datetime\n    from enum import Enum\n    \n  \
          \  class ErrorType(Enum):\n        VALIDATION_ERROR = \"validation_error\"\
          \n        SYNC_ERROR = \"sync_error\"\n        DATA_ERROR = \"data_error\"\
          \n        SYSTEM_ERROR = \"system_error\"\n    \n    def classify_error(error):\n\
          \        \"\"\"åˆ†ç±»é”™è¯¯ç±»å‹\"\"\"\n        error_str = str(error).lower()\n  \
          \      if \"validation\" in error_str or \"invalid\" in error_str:\n   \
          \         return ErrorType.VALIDATION_ERROR\n        elif \"sync\" in error_str\
          \ or \"branch\" in error_str:\n            return ErrorType.SYNC_ERROR\n\
          \        elif \"data\" in error_str or \"format\" in error_str:\n      \
          \      return ErrorType.DATA_ERROR\n        else:\n            return ErrorType.SYSTEM_ERROR\n\
          \    \n    def handle_error(error, context=None):\n        \"\"\"å¤„ç†é”™è¯¯å¹¶è¿”å›è¯¦ç»†ä¿¡æ¯\"\
          \"\"\n        error_type = classify_error(error)\n        error_info = {\n\
          \            \"error_type\": error_type.value,\n            \"error_message\"\
          : str(error),\n            \"error_class\": error.__class__.__name__,\n\
          \            \"timestamp\": datetime.now().isoformat(),\n            \"\
          context\": context or {},\n            \"traceback\": traceback.format_exc(),\n\
          \            \"severity\": \"high\" if error_type in [ErrorType.SYNC_ERROR,\
          \ ErrorType.SYSTEM_ERROR] else \"medium\"\n        }\n        \n       \
          \ if error_info[\"severity\"] == \"high\":\n            logging.error(f\"\
          âŒ é«˜çº§é”™è¯¯: {error_info['error_message']}\")\n        else:\n            logging.warning(f\"\
          âš ï¸ ä¸­çº§é”™è¯¯: {error_info['error_message']}\")\n        \n        return error_info\n\
          \    \n    # äº‹åŠ¡å¼€å§‹\n    transaction_id = f\"sync_tx_{int(time.time() * 1000)}\"\
          \n    sync_time = datetime.now().strftime(\"%H:%M:%S\")\n    \n    try:\n\
          \        logging.info(f\"\U0001F504 åŒæ­¥ç½‘å…³äº‹åŠ¡å¼€å§‹: {transaction_id}\")\n    \
          \    \n        # éªŒè¯è¾“å…¥\n        image_count = len(image_results) if image_results\
          \ else 0\n        audio_count = len(audio_results) if audio_results else\
          \ 0\n        \n        logging.info(f\"\U0001F504 åŒæ­¥ç½‘å…³: å›¾åƒåˆ†æ”¯={image_count}ä¸ªç»“æœ,\
          \ è¯­éŸ³åˆ†æ”¯={audio_count}ä¸ªç»“æœ, åŒæ­¥æ—¶é—´={sync_time}\")\n        \n        # æ£€æŸ¥åŒæ­¥çŠ¶æ€\n\
          \        sync_success = image_results is not None and audio_results is not\
          \ None\n        \n        if not sync_success:\n            missing_branches\
          \ = []\n            if image_results is None:\n                missing_branches.append(\"\
          å›¾åƒåˆ†æ”¯\")\n            if audio_results is None:\n                missing_branches.append(\"\
          è¯­éŸ³åˆ†æ”¯\")\n            \n            error_msg = f\"å¹¶è¡Œåˆ†æ”¯åŒæ­¥å¤±è´¥: {', '.join(missing_branches)}\
          \ æœªå®Œæˆ\"\n            raise RuntimeError(error_msg)\n        \n        #\
          \ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥\n        if not isinstance(image_results, list) or not isinstance(audio_results,\
          \ list):\n            raise ValueError(\"åˆ†æ”¯ç»“æœæ•°æ®æ ¼å¼é”™è¯¯ï¼šæœŸæœ›åˆ—è¡¨ç±»å‹\")\n        \n\
          \        # æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§\n        if image_count > 0 and audio_count > 0 and image_count\
          \ != audio_count:\n            logging.warning(f\"âš ï¸ æ•°æ®ä¸ä¸€è‡´ï¼šå›¾åƒç»“æœ{image_count}ä¸ªï¼ŒéŸ³é¢‘ç»“æœ{audio_count}ä¸ª\"\
          )\n        \n        # æ•°æ®è´¨é‡æ£€æŸ¥\n        valid_image_count = sum(1 for item\
          \ in image_results if item and isinstance(item, dict))\n        valid_audio_count\
          \ = sum(1 for item in audio_results if item and isinstance(item, dict))\n\
          \        \n        quality_info = {\n            \"image_quality\": valid_image_count\
          \ / image_count if image_count > 0 else 0,\n            \"audio_quality\"\
          : valid_audio_count / audio_count if audio_count > 0 else 0,\n         \
          \   \"overall_quality\": (valid_image_count + valid_audio_count) / (image_count\
          \ + audio_count) if (image_count + audio_count) > 0 else 0\n        }\n\
          \        \n        # äº‹åŠ¡æäº¤\n        logging.info(f\"âœ… åŒæ­¥ç½‘å…³äº‹åŠ¡æäº¤æˆåŠŸ: {transaction_id}\"\
          )\n        \n        return {\n            \"success\": True,\n        \
          \    \"transaction_id\": transaction_id,\n            \"sync_status\": \"\
          completed\",\n            \"sync_time\": sync_time,\n            \"image_results\"\
          : image_results,\n            \"audio_results\": audio_results,\n      \
          \      \"sync_info\": f\"âœ“ å¹¶è¡Œåˆ†æ”¯åŒæ­¥æˆåŠŸ - å›¾åƒ: {image_count}ä¸ª, è¯­éŸ³: {audio_count}ä¸ª\"\
          ,\n            \"total_items\": max(image_count, audio_count),\n       \
          \     \"quality_info\": quality_info,\n            \"data_consistency\"\
          : {\n                \"image_count\": image_count,\n                \"audio_count\"\
          : audio_count,\n                \"valid_image_count\": valid_image_count,\n\
          \                \"valid_audio_count\": valid_audio_count,\n           \
          \     \"consistency_check\": \"passed\" if abs(image_count - audio_count)\
          \ <= 1 else \"warning\"\n            },\n            \"error\": \"\",\n\
          \            \"error_details\": {},\n            \"error_type\": \"\",\n\
          \            \"recovery_info\": \"\",\n        }\n        \n    except Exception\
          \ as e:\n        # é”™è¯¯å¤„ç†å’Œäº‹åŠ¡å›æ»š\n        error_info = handle_error(e, {\n \
          \           \"node\": \"sync_gateway\",\n            \"transaction_id\"\
          : transaction_id,\n            \"image_count\": len(image_results) if image_results\
          \ else 0,\n            \"audio_count\": len(audio_results) if audio_results\
          \ else 0\n        })\n        \n        logging.error(f\"âŒ åŒæ­¥ç½‘å…³äº‹åŠ¡å›æ»š: {transaction_id}\"\
          )\n        \n        # æ¸…ç†èµ„æº\n        try:\n            if image_results:\n\
          \                logging.info(\"æ¸…ç†å›¾åƒç»“æœèµ„æº\")\n            if audio_results:\n\
          \                logging.info(\"æ¸…ç†éŸ³é¢‘ç»“æœèµ„æº\")\n        except Exception as\
          \ cleanup_error:\n            logging.warning(f\"èµ„æºæ¸…ç†è­¦å‘Š: {str(cleanup_error)}\"\
          )\n        \n        return {\n            \"success\": False,\n       \
          \     \"transaction_id\": transaction_id,\n            \"sync_status\":\
          \ \"failed\",\n            \"sync_time\": sync_time,\n            \"image_results\"\
          : image_results or [],\n            \"audio_results\": audio_results or\
          \ [],\n            \"error\": error_info[\"error_message\"],\n         \
          \   \"error_type\": error_info[\"error_type\"],\n            \"error_details\"\
          : error_info,\n            \"sync_info\": f\"âŒ å¹¶è¡Œåˆ†æ”¯åŒæ­¥å¤±è´¥: {error_info['error_message']}\"\
          ,\n            \"recovery_info\": \"å·²æ‰§è¡Œèµ„æºæ¸…ç†å’Œäº‹åŠ¡å›æ»š\",\n            \"data_consistency\"\
          : {},\n            \"quality_info\": {},\n            \"total_items\": 0,\n\
          \        }"
        code_language: python3
        desc: åŒæ­¥ç½‘å…³èŠ‚ç‚¹ï¼Œç­‰å¾…å¹¶è¡Œåˆ†æ”¯å®Œæˆ
        outputs:
          audio_results:
            children: null
            type: array[object]
          data_consistency:
            children: null
            type: object
          error:
            children: null
            type: string
          error_details:
            children: null
            type: object
          error_type:
            children: null
            type: string
          image_results:
            children: null
            type: array[object]
          quality_info:
            children: null
            type: object
          recovery_info:
            children: null
            type: string
          success:
            children: null
            type: boolean
          sync_info:
            children: null
            type: string
          sync_status:
            children: null
            type: string
          sync_time:
            children: null
            type: string
          total_items:
            children: null
            type: number
          transaction_id:
            children: null
            type: string
        selected: false
        title: åŒæ­¥ç½‘å…³
        type: code
        variables:
        - value_selector:
          - '1760602669786'
          - output
          value_type: array[object]
          variable: image_results
        - value_selector:
          - '1761044157730'
          - output
          value_type: array[object]
          variable: audio_results
      height: 79
      id: sync_gateway
      position:
        x: 4217.142857142857
        y: 423
      positionAbsolute:
        x: 4217.142857142857
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(results: list, output: list = None, transaction_id: str =\
          \ \"\") -> dict:\n    \"\"\"\n    ç®€åŒ–ç‰ˆèšåˆç»“æœç»Ÿè®¡èŠ‚ç‚¹\n    ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œç§»é™¤å¤æ‚çš„é”™è¯¯å¤„ç†å’Œç»Ÿè®¡é€»è¾‘\n\
          \    \"\"\"\n    import json\n    import time\n    from datetime import\
          \ datetime\n    \n    # ç”Ÿæˆäº‹åŠ¡ID\n    if not transaction_id:\n        transaction_id\
          \ = f\"agg_{int(time.time() * 1000)}\"[-8:]\n    \n    # å¤„ç†ç©ºè¾“å…¥\n    if not\
          \ results:\n        return {\n            \"success\": False,\n        \
          \    \"total_count\": 0,\n            \"success_count\": 0,\n          \
          \  \"failed_count\": 0,\n            \"success_rate\": 0.0,\n          \
          \  \"images\": [],\n            \"audios\": [],\n            \"texts\":\
          \ [],\n            \"images_json\": \"[]\",\n            \"audios_json\"\
          : \"[]\",\n            \"texts_json\": \"[]\",\n            \"total_duration\"\
          : 0,\n            \"errors\": [],\n            \"progress_summary\": \"\
          âŒ æ²¡æœ‰å¤„ç†ä»»ä½•æ•°æ®\",\n            \"aggregation_status\": \"empty\",\n        \
          \    \"audio_url\": [],\n            \"completion_time\": datetime.now().strftime(\"\
          %H:%M:%S\"),\n            \"error_classification\": \"EMPTY_RESULTS\",\n\
          \            \"formatted_audios\": [],\n            \"formatted_images\"\
          : [],\n            \"formatted_texts\": [],\n            \"metrics\": {},\n\
          \            \"performance_info\": {},\n            \"processing_details\"\
          : [],\n            \"recovery_plan\": \"è¯·æ£€æŸ¥è¾“å…¥æ•°æ®\",\n            \"retry_count\"\
          : 0,\n            \"retry_details\": [],\n            \"total_duration_sec\"\
          : 0,\n            \"total_retries\": 0,\n            \"transaction_id\"\
          : transaction_id\n        }\n    \n    # è¿‡æ»¤æœ‰æ•ˆç»“æœ\n    valid_results = [r\
          \ for r in results if r and isinstance(r, dict)]\n    \n    # ç»Ÿè®¡æˆåŠŸå’Œå¤±è´¥\n\
          \    success_count = len([r for r in valid_results if r.get('status') ==\
          \ 'success'])\n    failed_count = len(valid_results) - success_count\n \
          \   total_count = len(valid_results)\n    success_rate = round(success_count\
          \ / total_count, 4) if total_count > 0 else 0.0\n    \n    # æ”¶é›†é”™è¯¯\n    errors\
          \ = []\n    for r in valid_results:\n        if r.get('error'):\n      \
          \      errors.append({\n                \"index\": r.get('index', 0),\n\
          \                \"error\": r.get('error', ''),\n                \"error_type\"\
          : r.get('error_type', 'UNKNOWN')\n            })\n    \n    # å¤„ç†éŸ³é¢‘æ•°æ®\n \
          \   audios = output if output else []\n    \n    # æ ¼å¼åŒ–å›¾ç‰‡æ•°æ®\n    formatted_images\
          \ = []\n    for r in valid_results:\n        if r.get('image_url'):\n  \
          \          formatted_images.append({\n                \"type\": \"image\"\
          ,\n                \"material_url\": r.get('image_url', ''),\n         \
          \       \"duration\": 1.25,  # é»˜è®¤æ—¶é•¿\n                \"start_time\": (r.get('index',\
          \ 1) - 1) * 1.25,\n                \"end_time\": r.get('index', 1) * 1.25\n\
          \            })\n    \n    # æ ¼å¼åŒ–éŸ³é¢‘æ•°æ®\n    formatted_audios = []\n    for\
          \ audio in audios:\n        if audio.get('audio_url'):\n            formatted_audios.append({\n\
          \                \"type\": \"audio\",\n                \"material_url\"\
          : audio.get('audio_url', ''),\n                \"duration\": audio.get('duration',\
          \ 1.25),\n                \"start_time\": (audio.get('index', 1) - 1) *\
          \ 1.25,\n                \"end_time\": audio.get('index', 1) * 1.25\n  \
          \          })\n    \n    # è®¡ç®—æ€»æ—¶é•¿\n    total_duration = sum([img.get('duration',\
          \ 1.25) for img in formatted_images])\n    \n    # ç”Ÿæˆè¿›åº¦æ‘˜è¦\n    if success_count\
          \ == total_count:\n        status = \"âœ… æ‰€æœ‰é¡¹ç›®å¤„ç†æˆåŠŸ\"\n        aggregation_status\
          \ = \"success\"\n    elif success_count > 0:\n        status = f\"âš ï¸ éƒ¨åˆ†æˆåŠŸ:\
          \ {success_count}/{total_count}\"\n        aggregation_status = \"partial_success\"\
          \n    else:\n        status = \"âŒ æ‰€æœ‰é¡¹ç›®å¤„ç†å¤±è´¥\"\n        aggregation_status\
          \ = \"failed\"\n    \n    # è¿”å›ç»“æœ\n    return {\n        \"success\": success_count\
          \ > 0,\n        \"total_count\": total_count,\n        \"success_count\"\
          : success_count,\n        \"failed_count\": failed_count,\n        \"success_rate\"\
          : success_rate,\n        \"images\": valid_results,\n        \"audios\"\
          : audios,\n        \"texts\": [],\n        \"images_json\": json.dumps(formatted_images,\
          \ ensure_ascii=False),\n        \"audios_json\": json.dumps(formatted_audios,\
          \ ensure_ascii=False),\n        \"texts_json\": \"[]\",\n        \"total_duration\"\
          : total_duration,\n        \"errors\": errors,\n        \"progress_summary\"\
          : status,\n        \"aggregation_status\": aggregation_status,\n       \
          \ \"audio_url\": [a.get('audio_url', '') for a in audios if a.get('audio_url')],\n\
          \        \"completion_time\": datetime.now().strftime(\"%H:%M:%S\"),\n \
          \       \"error_classification\": errors[0].get('error_type', '') if errors\
          \ else '',\n        \"formatted_audios\": formatted_audios,\n        \"\
          formatted_images\": formatted_images,\n        \"formatted_texts\": [],\n\
          \        \"metrics\": {\n            \"total_count\": total_count,\n   \
          \         \"success_count\": success_count,\n            \"failed_count\"\
          : failed_count,\n            \"success_rate\": success_rate\n        },\n\
          \        \"performance_info\": {\n            \"total_duration\": total_duration,\n\
          \            \"average_duration\": round(total_duration / total_count, 2)\
          \ if total_count > 0 else 0\n        },\n        \"processing_details\"\
          : [\n            {\n                \"index\": r.get('index', i+1),\n  \
          \              \"status\": r.get('status', 'unknown'),\n               \
          \ \"has_image\": bool(r.get('image_url')),\n                \"has_error\"\
          : bool(r.get('error'))\n            }\n            for i, r in enumerate(valid_results)\n\
          \        ],\n        \"recovery_plan\": \"è¯·æ£€æŸ¥å¤±è´¥é¡¹ç›®çš„é”™è¯¯ä¿¡æ¯\" if failed_count\
          \ > 0 else \"\",\n        \"retry_count\": sum([r.get('retry_count', 0)\
          \ for r in valid_results]),\n        \"retry_details\": [],\n        \"\
          total_duration_sec\": round(total_duration, 2),\n        \"total_retries\"\
          : sum([r.get('retry_count', 0) for r in valid_results]),\n        \"transaction_id\"\
          : transaction_id\n    }\n"
        code_language: python3
        desc: èšåˆæ‰€æœ‰å›¾åƒç”Ÿæˆçš„ç»“æœï¼Œç»Ÿè®¡æˆåŠŸç‡ï¼Œå¤„ç†Noneå€¼å’Œå¼‚å¸¸ï¼Œç”Ÿæˆcozeæ ¼å¼çš„æ—¶é—´è½´æ•°æ®
        outputs:
          aggregation_status:
            children: null
            type: string
          audio_url:
            children: null
            type: array[string]
          audios:
            children: null
            type: array[object]
          audios_json:
            children: null
            type: string
          completion_time:
            children: null
            type: string
          error_classification:
            children: null
            type: string
          errors:
            children: null
            type: array[object]
          failed_count:
            children: null
            type: number
          formatted_audios:
            children: null
            type: array[object]
          formatted_images:
            children: null
            type: array[object]
          formatted_texts:
            children: null
            type: array[object]
          images:
            children: null
            type: array[object]
          images_json:
            children: null
            type: string
          metrics:
            children: null
            type: object
          performance_info:
            children: null
            type: object
          processing_details:
            children: null
            type: array[object]
          progress_summary:
            children: null
            type: string
          recovery_plan:
            children: null
            type: string
          retry_count:
            children: null
            type: number
          retry_details:
            children: null
            type: array[object]
          success:
            children: null
            type: boolean
          success_count:
            children: null
            type: number
          success_rate:
            children: null
            type: number
          texts:
            children: null
            type: array[object]
          texts_json:
            children: null
            type: string
          total_count:
            children: null
            type: number
          total_duration:
            children: null
            type: number
          total_duration_sec:
            children: null
            type: number
          total_retries:
            children: null
            type: number
          transaction_id:
            children: null
            type: string
        selected: false
        title: èšåˆç»“æœç»Ÿè®¡
        type: code
        variables:
        - value_selector:
          - sync_gateway
          - image_results
          value_type: array[object]
          variable: results
        - value_selector:
          - sync_gateway
          - audio_results
          value_type: array[object]
          variable: output
      height: 111
      id: code_aggregate_results
      position:
        x: 4522
        y: 423
      positionAbsolute:
        x: 4522
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: "\U0001F3AC **çŸ­è§†é¢‘ç”Ÿæˆå®Œæˆï¼**\nâœ… **è‰ç¨¿ä¿¡æ¯**ï¼š - è‰ç¨¿IDï¼š{{#1761045650096.draft_id#}}\
          \ - ä¿å­˜çŠ¶æ€ï¼š{{#17610437271090.body#}} \n\U0001F3AF **é¢„è§ˆä¸ä¸‹è½½**ï¼š - \U0001F4F1\
          \ è‰ç¨¿é¢„è§ˆï¼š{{#1761045650096.preview_url#}} - \U0001F4E5 ç›´æ¥ä¸‹è½½ï¼š{{#1761045650096.real_download_url#}}\n\
          \U0001F4A1 **ä½¿ç”¨è¯´æ˜**ï¼š 1. ç‚¹å‡»\"è‰ç¨¿é¢„è§ˆ\"é“¾æ¥å¯åœ¨çº¿é¢„è§ˆè‰ç¨¿å†…å®¹å’Œæ—¶é—´è½´ 2. é¢„è§ˆç•Œé¢é›†æˆäº†ä¸‹è½½åŠŸèƒ½ï¼Œæ”¯æŒç³»ç»Ÿé€‰æ‹©å’Œè‡ªå®šä¹‰è·¯å¾„\
          \ 3. å¯ä¸€é”®ä¿å­˜å¹¶ä¸Šä¼ åˆ°OSSï¼Œè‡ªåŠ¨ç”Ÿæˆä¸‹è½½é“¾æ¥"
        selected: false
        title: è¾“å‡ºç»“æœ
        type: answer
        variables: []
      height: 303
      id: answer_1
      position:
        x: 7542
        y: 423
      positionAbsolute:
        x: 7542
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        error_handle_mode: terminated
        height: 446
        is_parallel: false
        iterator_input_type: array[object]
        iterator_selector:
        - code_input_validation
        - srt_array
        output_selector:
        - '17606215510130'
        - result
        output_type: array[object]
        parallel_nums: 10
        selected: false
        start_node_id: 1760602669786start
        title: æ–‡ç”Ÿå›¾ç‰‡
        type: iteration
        width: 2318
      height: 446
      id: '1760602669786'
      position:
        x: 1842
        y: 423
      positionAbsolute:
        x: 1842
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 2318
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1760602669786start
      parentId: '1760602669786'
      position:
        x: 60
        y: 158.5
      positionAbsolute:
        x: 1902
        y: 581.5
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        is_team_authorization: true
        iteration_id: '1760602669786'
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            ja_JP: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            pt_BR: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            zh_Hans: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
          label:
            en_US: Prompt
            ja_JP: Prompt
            pt_BR: Prompt
            zh_Hans: Prompt
          llm_description: This prompt text will be used to generate image.
          max: null
          min: null
          name: prompt
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: 1024x1024
          form: form
          human_description:
            en_US: The size of the generated image.
            ja_JP: The size of the generated image.
            pt_BR: The size of the generated image.
            zh_Hans: The size of the generated image.
          label:
            en_US: Image Size
            ja_JP: Image Size
            pt_BR: Image Size
            zh_Hans: Image Size
          llm_description: ''
          max: null
          min: null
          name: size
          options:
          - icon: ''
            label:
              en_US: 1024x1024 (Square)
              ja_JP: 1024x1024 (Square)
              pt_BR: 1024x1024 (Square)
              zh_Hans: 1024x1024 (Square)
            value: 1024x1024
          - icon: ''
            label:
              en_US: 1024x1792 (Portrait)
              ja_JP: 1024x1792 (Portrait)
              pt_BR: 1024x1792 (Portrait)
              zh_Hans: 1024x1792 (Portrait)
            value: 1024x1792
          - icon: ''
            label:
              en_US: 1792x1024 (Landscape)
              ja_JP: 1792x1024 (Landscape)
              pt_BR: 1792x1024 (Landscape)
              zh_Hans: 1792x1024 (Landscape)
            value: 1792x1024
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: select
        - auto_generate: null
          default: doubao-seedream-3-0-t2i-250415
          form: form
          human_description:
            en_US: Model version to use for image generation.
            ja_JP: Model version to use for image generation.
            pt_BR: Model version to use for image generation.
            zh_Hans: Model version to use for image generation.
          label:
            en_US: Model Version
            ja_JP: Model Version
            pt_BR: Model Version
            zh_Hans: Model Version
          llm_description: ''
          max: null
          min: null
          name: model
          options:
          - icon: ''
            label:
              en_US: Doubao Seedream 3.0
              ja_JP: Doubao Seedream 3.0
              pt_BR: Doubao Seedream 3.0
              zh_Hans: Doubao Seedream 3.0
            value: doubao-seedream-3-0-t2i-250415
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: select
        params:
          model: ''
          prompt: ''
          size: ''
        provider_id: allenwriter/doubao_image/doubao
        provider_name: allenwriter/doubao_image/doubao
        provider_type: builtin
        selected: false
        title: Text to Image
        tool_configurations:
          model:
            type: constant
            value: doubao-seedream-3-0-t2i-250415
          size:
            type: constant
            value: 1024x1024
        tool_description: Generate images with Doubao (è±†åŒ…) AI.
        tool_label: Text to Image
        tool_name: text2image
        tool_node_version: '2'
        tool_parameters:
          model:
            type: constant
            value: doubao-seedream-3-0-t2i-250415
          prompt:
            type: mixed
            value: '{{#17606223903400.text#}}'
          size:
            type: mixed
            value: '{{#code_input_validation.config.image_size#}}'
        type: tool
      height: 113
      id: '1760602895868'
      parentId: '1760602669786'
      position:
        x: 506
        y: 126
      positionAbsolute:
        x: 2348
        y: 549
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "from typing import Any, Dict, Tuple\nimport ssl, urllib.request, urllib.error,\
          \ json, uuid, mimetypes\nimport logging\n\nDEF_PREFIX = 'capcut/image'\n\
          DEFAULT_REFERER = 'http://8.148.70.18:8080'\nDEFAULT_UA = 'Mozilla/5.0 (Windows\
          \ NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0\
          \ Safari/537.36'\n\ndef _pick_file(files: Any) -> Tuple[str, str, str]:\n\
          \    \"\"\"Return (url, filename, content_type) if possible.\"\"\"\n   \
          \ url = ''\n    filename = 'upload.bin'\n    content_type = ''\n    if isinstance(files,\
          \ dict) and isinstance(files.get('files'), list):\n        files = files['files']\n\
          \    if isinstance(files, list) and files:\n        f = files[0] if isinstance(files[0],\
          \ dict) else None\n        if isinstance(f, dict):\n            # å›¾ç‰‡æ–‡ä»¶ï¼šæŸ¥æ‰¾urlå­—æ®µï¼ˆdoubaoå›¾ç‰‡ç”Ÿæˆè¿”å›æ ¼å¼ï¼‰\n\
          \            url = (f.get('url') or f.get('remote_url') or f.get('signed_url')\
          \ or f.get('file_url') or '').strip()\n            name = f.get('filename')\
          \ or f.get('name') or ''\n            ext = f.get('extension') or ''\n \
          \           mt = f.get('mime_type') or ''\n            if name:\n      \
          \          filename = name\n            elif ext:\n                filename\
          \ = 'upload' + (ext if ext.startswith('.') else ('.' + ext))\n         \
          \   if isinstance(mt, str) and mt.strip():\n                content_type\
          \ = mt.strip()\n            elif isinstance(filename, str):\n          \
          \      guessed = mimetypes.guess_type(filename)[0]\n                if guessed:\n\
          \                    content_type = guessed\n    return url, filename, content_type\n\
          \ndef _http_json(api_base_url: str, path: str, payload: Dict[str, Any])\
          \ -> Dict[str, Any]:\n    req = urllib.request.Request(\n        url=f\"\
          {api_base_url.rstrip('/')}/{path.lstrip('/')}\",\n        data=json.dumps(payload).encode('utf-8'),\n\
          \        headers={'Content-Type': 'application/json'},\n        method='POST',\n\
          \    )\n    ctx = ssl.create_default_context()\n    with urllib.request.urlopen(req,\
          \ timeout=30, context=ctx) as resp:\n        return json.loads(resp.read().decode('utf-8'))\n\
          \ndef _http_multipart(api_base_url: str, filename: str, content: bytes,\
          \ content_type: str) -> Dict[str, Any]:\n    boundary = '----DifyBoundary'\
          \ + uuid.uuid4().hex\n    ct = content_type or 'application/octet-stream'\n\
          \    parts = []\n    parts.append(f\"--{boundary}\\r\\nContent-Disposition:\
          \ form-data; name=\\\"prefix\\\"\\r\\n\\r\\n{DEF_PREFIX}\\r\\n\")\n    header\
          \ = (\n        f\"--{boundary}\\r\\n\"\n        f\"Content-Disposition:\
          \ form-data; name=\\\"file\\\"; filename=\\\"{filename}\\\"\\r\\n\"\n  \
          \      f\"Content-Type: {ct}\\r\\n\\r\\n\"\n    ).encode('utf-8')\n    tail\
          \ = f\"\\r\\n--{boundary}--\\r\\n\".encode('utf-8')\n    body = b''.join([p.encode('utf-8')\
          \ for p in parts]) + header + content + tail\n    req = urllib.request.Request(\n\
          \        url=f\"{api_base_url.rstrip('/')}/upload_to_oss\",\n        data=body,\n\
          \        headers={'Content-Type': f'multipart/form-data; boundary={boundary}'},\n\
          \        method='POST',\n    )\n    ctx = ssl.create_default_context()\n\
          \    with urllib.request.urlopen(req, timeout=60, context=ctx) as resp:\n\
          \        return json.loads(resp.read().decode('utf-8'))\n\ndef _try_upload(api_base_url:\
          \ str, file_url: str, filename: str, content_type: str) -> str:\n    ctx\
          \ = ssl.create_default_context()\n    req = urllib.request.Request(file_url,\
          \ method='GET', headers={'Referer': DEFAULT_REFERER, 'User-Agent': DEFAULT_UA})\n\
          \    try:\n        with urllib.request.urlopen(req, timeout=60, context=ctx)\
          \ as r:\n            data = r.read()\n            ct = content_type or r.headers.get('Content-Type',\
          \ '')\n        out = _http_multipart(api_base_url, filename, data, ct or\
          \ content_type)\n        return (out.get('oss_url') or '').strip()\n   \
          \ except Exception as e:\n        logging.warning(f\"Multipart upload failed:\
          \ {str(e)}\")\n        return ''\n\ndef _try_mirror(api_base_url: str, file_url:\
          \ str) -> str:\n    try:\n        out = _http_json(api_base_url, 'mirror_to_oss',\
          \ {'url': file_url, 'prefix': DEF_PREFIX})\n        return (out.get('oss_url')\
          \ or '').strip()\n    except Exception as e:\n        logging.warning(f\"\
          Mirror upload failed: {str(e)}\")\n        return ''\n\ndef main(files:\
          \ Any, api_base_url: str) -> Dict[str, Any]:\n    \"\"\"å°†è±†åŒ…ç”Ÿæˆçš„éŸ³é¢‘ä¸Šä¼ åˆ°OSSï¼Œè·å–æŒä¹…åŒ–çš„å…¬ç½‘è®¿é—®URL\"\
          \"\"\n    try:\n        url, filename, content_type = _pick_file(files)\n\
          \        \n        if not isinstance(api_base_url, str) or not api_base_url.strip():\n\
          \            logging.warning(\"API base URLæœªé…ç½®ï¼Œè¿”å›åŸå§‹URL\")\n            return\
          \ {\n                'oss_url': url or '',\n                'upload_success':\
          \ bool(url),\n                'error': 'API base URLæœªé…ç½®' if not url else\
          \ ''\n            }\n        \n        if not url:\n            logging.error(\"\
          æœªæ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é¢‘URL\")\n            return {\n                'oss_url': '',\n \
          \               'upload_success': False,\n                'error': 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é¢‘URL'\n\
          \            }\n        \n        logging.info(f\"å¼€å§‹ä¸Šä¼ éŸ³é¢‘åˆ°OSS: {filename},\
          \ åŸå§‹URL: {url[:100]}...\")\n        logging.info(f\"ä½¿ç”¨OSSæœåŠ¡åœ°å€: {api_base_url}\"\
          )\n        \n        # 1) ä¼˜å…ˆä½¿ç”¨ç›´æ¥ä¸Šä¼  (multipart)\n        oss_url = _try_upload(api_base_url,\
          \ url, filename, content_type)\n        if oss_url:\n            logging.info(f\"\
          Multipartä¸Šä¼ æˆåŠŸ: {oss_url}\")\n            return {\n                'oss_url':\
          \ oss_url,\n                'upload_success': True,\n                'error':\
          \ ''\n            }\n        \n        # 2) é™çº§ä¸ºURLé•œåƒä¸Šä¼ \n        logging.info(\"\
          Multipartä¸Šä¼ å¤±è´¥ï¼Œå°è¯•URLé•œåƒä¸Šä¼ \")\n        oss_url = _try_mirror(api_base_url,\
          \ url)\n        if oss_url:\n            logging.info(f\"URLé•œåƒä¸Šä¼ æˆåŠŸ: {oss_url}\"\
          )\n            return {\n                'oss_url': oss_url,\n         \
          \       'upload_success': True,\n                'error': ''\n         \
          \   }\n        \n        # 3) æ£€æŸ¥åŸå§‹URLæ˜¯å¦å¯è®¿é—®\n        logging.info(\"OSSä¸Šä¼ å¤±è´¥ï¼Œæ£€æŸ¥åŸå§‹URLå¯è®¿é—®æ€§\"\
          )\n        try:\n            req = urllib.request.Request(url, method='HEAD')\n\
          \            with urllib.request.urlopen(req, timeout=10) as response:\n\
          \                if response.status == 200:\n                    logging.info(f\"\
          åŸå§‹URLå¯è®¿é—®ï¼Œç›´æ¥ä½¿ç”¨: {url}\")\n                    return {\n                \
          \        'oss_url': url,\n                        'upload_success': True,\n\
          \                        'error': 'OSSä¸Šä¼ å¤±è´¥ï¼Œä½†åŸå§‹URLå¯ç”¨'\n                 \
          \   }\n        except Exception as e:\n            logging.warning(f\"åŸå§‹URLæ£€æŸ¥å¤±è´¥:\
          \ {str(e)}\")\n        \n        # 4) æ‰€æœ‰æ–¹å¼éƒ½å¤±è´¥ï¼Œä½†ä»è¿”å›åŸå§‹URLä½œä¸ºé™çº§\n        logging.warning(\"\
          æ‰€æœ‰ä¸Šä¼ æ–¹å¼éƒ½å¤±è´¥ï¼Œè¿”å›åŸå§‹URLä½œä¸ºé™çº§æ–¹æ¡ˆ\")\n        return {\n            'oss_url': url,\n\
          \            'upload_success': True,\n            'error': 'OSSä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹URL'\n\
          \        }\n        \n    except Exception as e:\n        error_msg = f\"\
          OSSä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: {str(e)}\"\n        logging.error(error_msg)\n        try:\n\
          \            url, _, _ = _pick_file(files)\n            if url:\n      \
          \          return {\n                    'oss_url': url,\n             \
          \       'upload_success': True,\n                    'error': f'OSSä¸Šä¼ å¼‚å¸¸ï¼Œè¿”å›åŸå§‹URL:\
          \ {str(e)}'\n                }\n        except:\n            pass\n    \
          \    return {\n            'oss_url': '',\n            'upload_success':\
          \ False,\n            'error': error_msg\n        }\n"
        code_language: python3
        desc: å°†è±†åŒ…ç”Ÿæˆçš„éŸ³é¢‘ä¸Šä¼ åˆ°OSSï¼Œè·å–æŒä¹…åŒ–çš„å…¬ç½‘è®¿é—®URL
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        outputs:
          error:
            children: null
            type: string
          oss_url:
            children: null
            type: string
          upload_success:
            children: null
            type: boolean
        selected: false
        title: ä¸Šä¼ å›¾ç‰‡åˆ°OSS
        type: code
        variables:
        - value_selector:
          - '1760602895868'
          - files
          value_type: array[file]
          variable: files
        - value_selector:
          - env
          - api_base_url
          value_type: string
          variable: api_base_url
      height: 95
      id: '1760999999001'
      parentId: '1760602669786'
      position:
        x: 808
        y: 135
      positionAbsolute:
        x: 2650
        y: 558
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "def main(image_files: str, srt_item: dict, max_retries: int = 3) ->\
          \ dict:\n    \"\"\"\n    æ£€æŸ¥ç”Ÿæˆå›¾åƒçš„è´¨é‡å¹¶æ”¯æŒé‡è¯•æœºåˆ¶ï¼ˆå¢å¼ºç‰ˆï¼‰\n    \n    åŠŸèƒ½è¯´æ˜ï¼š\n    1.\
          \ æ£€æŸ¥å›¾åƒURLæ˜¯å¦æœ‰æ•ˆ\n    2. éªŒè¯å›¾åƒæ–‡ä»¶æ˜¯å¦å­˜åœ¨\n    3. è¿›è¡ŒåŸºç¡€è´¨é‡è¯„ä¼°\n    4. è¿”å›è´¨é‡æ£€æŸ¥ç»“æœ\n   \
          \ 5. æ”¯æŒé‡è¯•è®¡æ•°å’Œé”™è¯¯åˆ†ç±»\n    6. å¢å¼ºé”™è¯¯å¤„ç†å’Œäº‹åŠ¡æ€§å¤„ç†\n    7. æ€§èƒ½ç›‘æ§å’Œèµ„æºç®¡ç†\n    \n    Args:\n\
          \        image_files: OSSä¸Šä¼ åçš„å›¾åƒURLå­—ç¬¦ä¸²\n        srt_item: å½“å‰SRTé¡¹\n      \
          \  max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°\n        \n    Returns:\n        è´¨é‡æ£€æŸ¥ç»“æœï¼ˆå¢å¼ºç‰ˆï¼‰\n  \
          \  \"\"\"\n    import logging\n    import time\n    import uuid\n    from\
          \ enum import Enum\n    \n    class ErrorType(Enum):\n        URL_EMPTY\
          \ = \"URL_EMPTY\"\n        URL_INVALID = \"URL_INVALID\"\n        QUALITY_LOW\
          \ = \"QUALITY_LOW\"\n        NETWORK_ERROR = \"NETWORK_ERROR\"\n       \
          \ TIMEOUT_ERROR = \"TIMEOUT_ERROR\"\n        VALIDATION_ERROR = \"VALIDATION_ERROR\"\
          \n        SYSTEM_ERROR = \"SYSTEM_ERROR\"\n    \n    def classify_error(error_msg:\
          \ str, context: dict = None) -> ErrorType:\n        \"\"\"é”™è¯¯åˆ†ç±»å™¨\"\"\"\n\
          \        error_lower = error_msg.lower()\n        if \"urlä¸ºç©º\" in error_lower\
          \ or \"empty\" in error_lower:\n            return ErrorType.URL_EMPTY\n\
          \        elif \"urlæ ¼å¼\" in error_lower or \"invalid\" in error_lower:\n\
          \            return ErrorType.URL_INVALID\n        elif \"è´¨é‡\" in error_lower\
          \ or \"quality\" in error_lower:\n            return ErrorType.QUALITY_LOW\n\
          \        elif \"ç½‘ç»œ\" in error_lower or \"network\" in error_lower:\n   \
          \         return ErrorType.NETWORK_ERROR\n        elif \"è¶…æ—¶\" in error_lower\
          \ or \"timeout\" in error_lower:\n            return ErrorType.TIMEOUT_ERROR\n\
          \        elif \"éªŒè¯\" in error_lower or \"validation\" in error_lower:\n\
          \            return ErrorType.VALIDATION_ERROR\n        else:\n        \
          \    return ErrorType.SYSTEM_ERROR\n    \n    def handle_error(error_type:\
          \ ErrorType, error_msg: str, context: dict) -> dict:\n        \"\"\"ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨\"\
          \"\"\n        recovery_suggestions = {\n            ErrorType.URL_EMPTY:\
          \ \"æ£€æŸ¥å›¾åƒç”Ÿæˆæµç¨‹ï¼Œç¡®ä¿URLæ­£ç¡®è¿”å›\",\n            ErrorType.URL_INVALID: \"éªŒè¯URLæ ¼å¼ï¼Œæ£€æŸ¥åè®®å’ŒåŸŸå\"\
          ,\n            ErrorType.QUALITY_LOW: \"è°ƒæ•´ç”Ÿæˆå‚æ•°æˆ–é‡æ–°ç”Ÿæˆ\",\n            ErrorType.NETWORK_ERROR:\
          \ \"æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¨åé‡è¯•\",\n            ErrorType.TIMEOUT_ERROR: \"å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥æœåŠ¡çŠ¶æ€\"\
          ,\n            ErrorType.VALIDATION_ERROR: \"æ£€æŸ¥è¾“å…¥å‚æ•°æ ¼å¼å’ŒèŒƒå›´\",\n          \
          \  ErrorType.SYSTEM_ERROR: \"è”ç³»æŠ€æœ¯æ”¯æŒ\"\n        }\n        \n        return\
          \ {\n            \"error_type\": error_type.value,\n            \"error_message\"\
          : error_msg,\n            \"recovery_suggestion\": recovery_suggestions.get(error_type,\
          \ \"æœªçŸ¥é”™è¯¯ç±»å‹\"),\n            \"context\": context,\n            \"timestamp\"\
          : time.time(),\n            \"error\": \"\",\n            \"error_details\"\
          : {},\n            \"image_url\": \"\",\n            \"performance_info\"\
          : {},\n            \"quality_pass\": False,\n            \"quality_score\"\
          : 0,\n            \"retry_count\": 0,\n            \"should_retry\": False,\n\
          \            \"srt_item\": {},\n            \"transaction_id\": \"\",\n\
          \        }\n    \n    # ç”Ÿæˆäº‹åŠ¡ID\n    transaction_id = str(uuid.uuid4())[:8]\n\
          \    start_time = time.time()\n    \n    try:\n        # è·å–å½“å‰é‡è¯•æ¬¡æ•°\n    \
          \    current_retry = srt_item.get(\"retry_count\", 0)\n        \n      \
          \  # è¾“å…¥éªŒè¯\n        if not isinstance(srt_item, dict):\n            error_msg\
          \ = \"SRTé¡¹å¿…é¡»æ˜¯å­—å…¸ç±»å‹\"\n            error_info = handle_error(ErrorType.VALIDATION_ERROR,\
          \ error_msg, {\"srt_item\": str(srt_item)})\n            return {\n    \
          \            \"quality_pass\": False,\n                \"quality_score\"\
          : 0.0,\n                \"error\": error_msg,\n                \"error_type\"\
          : \"\",\n                \"error_details\": error_info,\n              \
          \  \"transaction_id\": transaction_id,\n                \"performance_info\"\
          : {\"duration\": round(time.time() - start_time, 3)},\n                \"\
          should_retry\": False,\n                \"image_url\": \"\",\n         \
          \       \"retry_count\": 0,\n                \"srt_item\": {},\n       \
          \     }\n        \n        # æ£€æŸ¥å›¾åƒURL\n        if not image_files or not\
          \ isinstance(image_files, str) or not image_files.strip():\n           \
          \ error_msg = f\"å›¾åƒURLä¸ºç©º (é‡è¯• {current_retry}/{max_retries})\"\n        \
          \    error_info = handle_error(ErrorType.URL_EMPTY, error_msg, {\"retry\"\
          : current_retry})\n            should_retry = current_retry < max_retries\n\
          \            return {\n                \"quality_pass\": False,\n      \
          \          \"quality_score\": 0.3,\n                \"error\": error_msg,\n\
          \                \"error_type\": \"\",\n                \"error_details\"\
          : error_info,\n                \"image_url\": \"\",\n                \"\
          srt_item\": {**srt_item, \"retry_count\": current_retry + 1},\n        \
          \        \"should_retry\": should_retry,\n                \"retry_count\"\
          : current_retry,\n                \"transaction_id\": transaction_id,\n\
          \                \"performance_info\": {\"duration\": round(time.time()\
          \ - start_time, 3)},\n            }\n        \n        # æ¸…ç†URL\n       \
          \ image_url = image_files.strip()\n        \n        # è®°å½•æ¥æ”¶åˆ°çš„URLç”¨äºè°ƒè¯•\n \
          \       logging.info(f\"[{transaction_id}] æ¥æ”¶åˆ°çš„OSSå›¾åƒURL: {image_url}\")\n\
          \        \n        # æ£€æŸ¥URLæ ¼å¼\n        if not image_url.startswith(('http://',\
          \ 'https://')):\n            error_msg = f\"å›¾åƒURLæ ¼å¼æ— æ•ˆ: '{image_url}' (é‡è¯•\
          \ {current_retry}/{max_retries})\"\n            error_info = handle_error(ErrorType.URL_INVALID,\
          \ error_msg, {\"url\": image_url, \"retry\": current_retry})\n         \
          \   should_retry = current_retry < max_retries\n            logging.warning(f\"\
          [{transaction_id}] å›¾åƒURLæ ¼å¼æ— æ•ˆ: '{image_url}'\")\n            return {\n \
          \               \"quality_pass\": False,\n                \"quality_score\"\
          : 0.15,\n                \"error\": error_msg,\n                \"error_type\"\
          : \"\",\n                \"error_details\": error_info,\n              \
          \  \"image_url\": image_url,\n                \"srt_item\": {**srt_item,\
          \ \"retry_count\": current_retry + 1},\n                \"should_retry\"\
          : should_retry,\n                \"retry_count\": current_retry,\n     \
          \           \"transaction_id\": transaction_id,\n                \"performance_info\"\
          : {\"duration\": round(time.time() - start_time, 3)},\n            }\n \
          \       \n        # éªŒè¯URLçš„å¯è®¿é—®æ€§ï¼ˆç®€åŒ–æ£€æŸ¥ï¼‰\n        url_quality_bonus = 0.0\n\
          \        \n        # æ£€æŸ¥æ˜¯å¦ä¸ºOSS URLï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰\n        if 'oss' in image_url.lower()\
          \ or 'aliyuncs.com' in image_url.lower():\n            logging.info(f\"\
          [{transaction_id}] æ£€æµ‹åˆ°OSSæŒä¹…åŒ–URL: {image_url[:50]}...\")\n            url_quality_bonus\
          \ = 0.15  # OSS URLè´¨é‡è¾ƒé«˜\n        elif '?' in image_url and ('timestamp'\
          \ in image_url or 'expires' in image_url):\n            logging.info(f\"\
          [{transaction_id}] æ£€æµ‹åˆ°å¸¦ç­¾åçš„ä¸´æ—¶URL: {image_url[:50]}...\")\n            url_quality_bonus\
          \ = 0.1  # ä¸´æ—¶URLè´¨é‡ä¸­ç­‰\n        \n        # åŸºç¡€è´¨é‡è¯„åˆ†ï¼ˆç®€åŒ–å®ç°ï¼‰\n        base_quality_score\
          \ = 0.85  # é»˜è®¤è´¨é‡åˆ†æ•°\n        \n        # åº”ç”¨URLè´¨é‡åŠ åˆ†\n        quality_score\
          \ = min(1.0, base_quality_score + url_quality_bonus)\n        \n       \
          \ # è´¨é‡é˜ˆå€¼\n        quality_threshold = 0.7\n        \n        # è®°å½•è´¨é‡æ£€æŸ¥ç»“æœ\n\
          \        logging.info(f\"[{transaction_id}] è´¨é‡æ£€æŸ¥å®Œæˆ - åˆ†æ•°: {quality_score:.2f},\
          \ é˜ˆå€¼: {quality_threshold}, URL: {image_url[:50]}...\")\n        \n     \
          \   # å¦‚æœè´¨é‡ä¸è¾¾æ ‡ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•\n        if quality_score < quality_threshold:\n\
          \            error_msg = f\"å›¾åƒè´¨é‡ä¸è¾¾æ ‡ (åˆ†æ•°: {quality_score:.2f}, é‡è¯• {current_retry}/{max_retries})\"\
          \n            error_info = handle_error(ErrorType.QUALITY_LOW, error_msg,\
          \ {\"score\": quality_score, \"threshold\": quality_threshold, \"retry\"\
          : current_retry})\n            should_retry = current_retry < max_retries\n\
          \            return {\n                \"quality_pass\": False,\n      \
          \          \"quality_score\": quality_score,\n                \"error\"\
          : error_msg,\n                \"error_type\": \"\",\n                \"\
          error_details\": error_info,\n                \"image_url\": image_url,\n\
          \                \"srt_item\": {**srt_item, \"retry_count\": current_retry\
          \ + 1},\n                \"should_retry\": should_retry,\n             \
          \   \"retry_count\": current_retry,\n                \"transaction_id\"\
          : transaction_id,\n                \"performance_info\": {\"duration\":\
          \ round(time.time() - start_time, 3)},\n            }\n        \n      \
          \  # è´¨é‡æ£€æŸ¥é€šè¿‡\n        duration = round(time.time() - start_time, 3)\n   \
          \     logging.info(f\"[{transaction_id}] è´¨é‡æ£€æŸ¥é€šè¿‡ï¼Œè€—æ—¶: {duration:.2f}s\")\n\
          \        \n        return {\n            \"quality_pass\": True,\n     \
          \       \"quality_score\": quality_score,\n            \"error\": \"\",\n\
          \            \"error_type\": \"\",\n            \"error_details\": None,\n\
          \            \"image_url\": image_url,  # ä½¿ç”¨OSS URLä½œä¸ºæœ€ç»ˆå›¾åƒURL,\n        \
          \    \"srt_item\": srt_item,\n            \"should_retry\": False,\n   \
          \         \"retry_count\": current_retry,\n            \"transaction_id\"\
          : transaction_id,\n            \"performance_info\": {\n               \
          \ \"duration\": duration,\n                \"quality_bonus\": url_quality_bonus,\n\
          \                \"threshold_used\": quality_threshold,\n            }\n\
          \        }\n        \n    except Exception as e:\n        # ç³»ç»Ÿçº§é”™è¯¯å¤„ç†\n  \
          \      error_msg = f\"è´¨é‡æ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç”Ÿç³»ç»Ÿé”™è¯¯: {str(e)}\"\n        error_info = handle_error(ErrorType.SYSTEM_ERROR,\
          \ error_msg, {\"exception\": str(e), \"transaction_id\": transaction_id})\n\
          \        logging.error(f\"[{transaction_id}] {error_msg}\")\n        \n\
          \        return {\n            \"quality_pass\": False,\n            \"\
          quality_score\": 0.0,\n            \"error\": error_msg,\n            \"\
          error_type\": \"\",\n            \"error_details\": error_info,\n      \
          \      \"image_url\": image_files if isinstance(image_files, str) else \"\
          \",\n            \"srt_item\": srt_item if isinstance(srt_item, dict) else\
          \ {},\n            \"should_retry\": False,\n            \"retry_count\"\
          : srt_item.get(\"retry_count\", 0) if isinstance(srt_item, dict) else 0,\n\
          \            \"transaction_id\": transaction_id,\n            \"performance_info\"\
          : {\"duration\": time.time() - start_time},\n        }"
        code_language: python3
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        outputs:
          error:
            children: null
            type: string
          error_details:
            children: null
            type: object
          error_type:
            children: null
            type: string
          image_url:
            children: null
            type: string
          performance_info:
            children: null
            type: object
          quality_pass:
            children: null
            type: boolean
          quality_score:
            children: null
            type: number
          retry_count:
            children: null
            type: number
          should_retry:
            children: null
            type: boolean
          srt_item:
            children: null
            type: object
          transaction_id:
            children: null
            type: string
        selected: false
        title: è´¨é‡æ£€æŸ¥
        type: code
        variables:
        - value_selector:
          - '1760999999001'
          - oss_url
          value_type: string
          variable: image_files
        - value_selector:
          - '1760602669786'
          - item
          value_type: object
          variable: srt_item
        - value_selector:
          - code_input_validation
          - config
          - max_retries
          value_type: number
          variable: max_retries
      height: 51
      id: '1760602942927'
      parentId: '1760602669786'
      position:
        x: 1110
        y: 157
      positionAbsolute:
        x: 2952
        y: 580
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 9557a27c-8db7-4b51-9a9d-ffe60f81ec6c
            value: true
            varType: boolean
            variable_selector:
            - '1760602942927'
            - quality_pass
          id: 'true'
          logical_operator: and
        - case_id: retry
          conditions:
          - comparison_operator: is
            id: b47a38ee-9fc1-4d62-8e8f-2a1b5c3d7e9f
            value: true
            varType: boolean
            variable_selector:
            - '1760602942927'
            - should_retry
          id: retry
          logical_operator: and
        - case_id: 328e3dc0-d189-4b54-b120-17bd316652e1
          conditions:
          - comparison_operator: is
            id: a37927dd-8ed0-4251-bfdf-7d87c2a0522e
            value: false
            varType: boolean
            variable_selector:
            - '1760602942927'
            - quality_pass
          - comparison_operator: is
            id: c58f49dd-7bc2-4e73-9d4a-8f6e1a2b3c4d
            value: false
            varType: boolean
            variable_selector:
            - '1760602942927'
            - should_retry
          id: 328e3dc0-d189-4b54-b120-17bd316652e1
          logical_operator: and
        isInIteration: true
        isInLoop: false
        iteration_id: '1760602669786'
        selected: false
        title: æ¡ä»¶åˆ†æ”¯ 2
        type: if-else
      height: 245
      id: '1760603125046'
      parentId: '1760602669786'
      position:
        x: 1412
        y: 60
      positionAbsolute:
        x: 3254
        y: 483
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        is_team_authorization: true
        iteration_id: '1760602669786'
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            ja_JP: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            pt_BR: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
            zh_Hans: The text prompt used to generate the image. Doubao will generate
              an image based on this prompt.
          label:
            en_US: Prompt
            ja_JP: Prompt
            pt_BR: Prompt
            zh_Hans: Prompt
          llm_description: This prompt text will be used to generate image.
          max: null
          min: null
          name: prompt
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: 1024x1024
          form: form
          human_description:
            en_US: The size of the generated image.
            ja_JP: The size of the generated image.
            pt_BR: The size of the generated image.
            zh_Hans: The size of the generated image.
          label:
            en_US: Image Size
            ja_JP: Image Size
            pt_BR: Image Size
            zh_Hans: Image Size
          llm_description: ''
          max: null
          min: null
          name: size
          options:
          - icon: ''
            label:
              en_US: 1024x1024 (Square)
              ja_JP: 1024x1024 (Square)
              pt_BR: 1024x1024 (Square)
              zh_Hans: 1024x1024 (Square)
            value: 1024x1024
          - icon: ''
            label:
              en_US: 1024x1792 (Portrait)
              ja_JP: 1024x1792 (Portrait)
              pt_BR: 1024x1792 (Portrait)
              zh_Hans: 1024x1792 (Portrait)
            value: 1024x1792
          - icon: ''
            label:
              en_US: 1792x1024 (Landscape)
              ja_JP: 1792x1024 (Landscape)
              pt_BR: 1792x1024 (Landscape)
              zh_Hans: 1792x1024 (Landscape)
            value: 1792x1024
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: select
        - auto_generate: null
          default: doubao-seedream-3-0-t2i-250415
          form: form
          human_description:
            en_US: Model version to use for image generation.
            ja_JP: Model version to use for image generation.
            pt_BR: Model version to use for image generation.
            zh_Hans: Model version to use for image generation.
          label:
            en_US: Model Version
            ja_JP: Model Version
            pt_BR: Model Version
            zh_Hans: Model Version
          llm_description: ''
          max: null
          min: null
          name: model
          options:
          - icon: ''
            label:
              en_US: Doubao Seedream 3.0
              ja_JP: Doubao Seedream 3.0
              pt_BR: Doubao Seedream 3.0
              zh_Hans: Doubao Seedream 3.0
            value: doubao-seedream-3-0-t2i-250415
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: select
        params:
          model: ''
          prompt: ''
          size: ''
        provider_id: allenwriter/doubao_image/doubao
        provider_name: allenwriter/doubao_image/doubao
        provider_type: builtin
        selected: false
        title: Text to Image
        tool_configurations:
          model:
            type: constant
            value: doubao-seedream-3-0-t2i-250415
          size:
            type: constant
            value: 1024x1024
        tool_description: Generate images with Doubao (è±†åŒ…) AI.
        tool_label: Text to Image
        tool_name: text2image
        tool_node_version: '2'
        tool_parameters:
          model:
            type: constant
            value: doubao-seedream-3-0-t2i-250415
          prompt:
            type: mixed
            value: '{{#17606223903400.text#}}'
          size:
            type: mixed
            value: '{{#code_input_validation.config.image_size#}}'
        type: tool
      height: 113
      id: '1760603213982'
      parentId: '1760602669786'
      position:
        x: 1714
        y: 212.5
      positionAbsolute:
        x: 3556
        y: 635.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "def main(quality_pass: bool, image_url: str, quality_score: float,\
          \ error: str, srt_item: dict, error_type: str = \"\", should_retry: bool\
          \ = False, retry_count: int = 0, error_details: dict = None, transaction_id:\
          \ str = \"\", performance_info: dict = None) -> dict:\n    \"\"\"\n    æ”¶é›†å•ä¸ªå›¾åƒç”Ÿæˆçš„ç»“æœå¹¶æ˜¾ç¤ºè¿›åº¦çŠ¶æ€ï¼ˆå¢å¼ºç‰ˆï¼‰\n\
          \    \n    åŠŸèƒ½è¯´æ˜ï¼š\n    1. æ•´ç†å›¾åƒç”Ÿæˆç»“æœ\n    2. è®°å½•æˆåŠŸæˆ–å¤±è´¥çŠ¶æ€\n    3. å¤„ç†é‡è¯•ä¿¡æ¯\n   \
          \ 4. è¿”å›æ ‡å‡†åŒ–çš„ç»“æœå¯¹è±¡\n    5. æ˜¾ç¤ºå½“å‰å¤„ç†è¿›åº¦\n    6. å¢å¼ºé”™è¯¯å¤„ç†å’Œäº‹åŠ¡æ€§å¤„ç†\n    7. æ€§èƒ½ç›‘æ§å’Œèµ„æºç®¡ç†\n\
          \    \n    Args:\n        quality_pass: è´¨é‡æ£€æŸ¥æ˜¯å¦é€šè¿‡\n        image_url: å›¾åƒURL\n\
          \        quality_score: è´¨é‡åˆ†æ•°\n        error: é”™è¯¯ä¿¡æ¯\n        srt_item: å½“å‰SRTé¡¹\n\
          \        error_type: é”™è¯¯ç±»å‹\n        should_retry: æ˜¯å¦éœ€è¦é‡è¯•\n        retry_count:\
          \ é‡è¯•æ¬¡æ•°\n        error_details: è¯¦ç»†é”™è¯¯ä¿¡æ¯\n        transaction_id: äº‹åŠ¡ID\n  \
          \      performance_info: æ€§èƒ½ä¿¡æ¯\n        \n    Returns:\n        ç»“æœå¯¹è±¡ï¼ŒåŒ…è£…åœ¨resulté”®ä¸­ï¼ˆå¢å¼ºç‰ˆï¼‰\n\
          \    \"\"\"\n    import time\n    import logging\n    import uuid\n    from\
          \ enum import Enum\n    \n    class StatusType(Enum):\n        SUCCESS =\
          \ \"success\"\n        RETRYING = \"retrying\"\n        FAILED = \"failed\"\
          \n        PENDING = \"pending\"\n        PROCESSING = \"processing\"\n \
          \   \n    def calculate_metrics(quality_score: float, retry_count: int,\
          \ performance_info: dict) -> dict:\n        \"\"\"è®¡ç®—æ€§èƒ½æŒ‡æ ‡\"\"\"\n       \
          \ base_metrics = {\n            \"quality_score\": quality_score,\n    \
          \        \"retry_count\": retry_count,\n            \"efficiency_score\"\
          : max(0.0, 1.0 - (retry_count * 0.2)),  # é‡è¯•æ¬¡æ•°å½±å“æ•ˆç‡\n            \"quality_grade\"\
          : \"A\" if quality_score >= 0.9 else \"B\" if quality_score >= 0.7 else\
          \ \"C\" if quality_score >= 0.5 else \"D\"\n        }\n        \n      \
          \  if performance_info:\n            base_metrics.update({\n           \
          \     \"processing_duration\": performance_info.get(\"duration\", 0),\n\
          \                \"quality_bonus\": performance_info.get(\"quality_bonus\"\
          , 0),\n                \"threshold_used\": performance_info.get(\"threshold_used\"\
          , 0.7)\n            })\n        \n        return base_metrics\n    \n  \
          \  def generate_recovery_plan(error_type: str, retry_count: int, error_details:\
          \ dict) -> dict:\n        \"\"\"ç”Ÿæˆæ¢å¤è®¡åˆ’\"\"\"\n        recovery_plans = {\n\
          \            \"URL_EMPTY\": {\n                \"immediate_action\": \"\
          æ£€æŸ¥å›¾åƒç”Ÿæˆæµç¨‹\",\n                \"next_steps\": [\"éªŒè¯APIè¿æ¥\", \"æ£€æŸ¥å‚æ•°é…ç½®\", \"\
          é‡æ–°ç”Ÿæˆ\"],\n                \"estimated_time\": \"1-2åˆ†é’Ÿ\"\n            },\n\
          \            \"URL_INVALID\": {\n                \"immediate_action\": \"\
          éªŒè¯URLæ ¼å¼\",\n                \"next_steps\": [\"æ£€æŸ¥åè®®\", \"éªŒè¯åŸŸå\", \"æµ‹è¯•è¿æ¥\"\
          ],\n                \"estimated_time\": \"30ç§’-1åˆ†é’Ÿ\"\n            },\n  \
          \          \"QUALITY_LOW\": {\n                \"immediate_action\": \"\
          è°ƒæ•´ç”Ÿæˆå‚æ•°\",\n                \"next_steps\": [\"ä¼˜åŒ–æç¤ºè¯\", \"è°ƒæ•´æ¨¡å‹å‚æ•°\", \"é‡æ–°ç”Ÿæˆ\"\
          ],\n                \"estimated_time\": \"1-3åˆ†é’Ÿ\"\n            }\n     \
          \   }\n        \n        default_plan = {\n            \"immediate_action\"\
          : \"ç³»ç»Ÿè¯Šæ–­\",\n            \"next_steps\": [\"æ£€æŸ¥æ—¥å¿—\", \"è”ç³»æŠ€æœ¯æ”¯æŒ\"],\n     \
          \       \"estimated_time\": \"5-10åˆ†é’Ÿ\"\n        }\n        \n        plan\
          \ = recovery_plans.get(error_type, default_plan)\n        plan[\"retry_count\"\
          ] = retry_count\n        plan[\"max_retries_reached\"] = retry_count >=\
          \ 3\n        \n        return plan\n    \n    try:\n        # ç”Ÿæˆæˆ–ä½¿ç”¨ç°æœ‰äº‹åŠ¡ID\n\
          \        if not transaction_id:\n            transaction_id = str(uuid.uuid4())[:8]\n\
          \        \n        start_time = time.time()\n        \n        # è¾“å…¥éªŒè¯\n\
          \        if not isinstance(srt_item, dict):\n            logging.error(f\"\
          [{transaction_id}] SRTé¡¹å¿…é¡»æ˜¯å­—å…¸ç±»å‹\")\n            return {\n              \
          \  \"result\": {\n                    \"index\": 0,\n                  \
          \  \"status\": StatusType.FAILED.value,\n                    \"error\":\
          \ \"è¾“å…¥éªŒè¯å¤±è´¥ï¼šSRTé¡¹æ ¼å¼é”™è¯¯\",\n                    \"transaction_id\": transaction_id,\n\
          \                    \"processing_time\": time.strftime(\"%H:%M:%S\", time.localtime())\n\
          \                }\n            }\n        \n        # è·å–å½“å‰å¤„ç†çš„ç´¢å¼•\n     \
          \   current_index = srt_item.get(\"index\", 0)\n        current_text = srt_item.get(\"\
          text\", \"\")\n        \n        # è®¡ç®—æ€§èƒ½æŒ‡æ ‡\n        metrics = calculate_metrics(quality_score,\
          \ retry_count, performance_info)\n        \n        # ç”Ÿæˆè¿›åº¦çŠ¶æ€ä¿¡æ¯\n       \
          \ if quality_pass:\n            status_emoji = \"âœ…\"\n            progress_info\
          \ = f\"{status_emoji} ç¬¬ {current_index} é¡¹å¤„ç†å®Œæˆ\"\n            progress_detail\
          \ = f\"\U0001F3A8 æˆåŠŸç”Ÿæˆå›¾åƒ | è´¨é‡åˆ†æ•°: {quality_score:.2f} ({metrics['quality_grade']})\
          \ | æ•ˆç‡: {metrics['efficiency_score']:.2f} | æ–‡æœ¬: {current_text[:30]}{'...'\
          \ if len(current_text) > 30 else ''}\"\n            final_status = StatusType.SUCCESS.value\n\
          \            recovery_plan = None\n        elif should_retry:\n        \
          \    status_emoji = \"\U0001F504\"\n            progress_info = f\"{status_emoji}\
          \ ç¬¬ {current_index} é¡¹éœ€è¦é‡è¯• (ç¬¬{retry_count}æ¬¡)\"\n            progress_detail\
          \ = f\"âš ï¸ é‡è¯•ä¸­ | é”™è¯¯ç±»å‹: {error_type} | é”™è¯¯: {error} | æ–‡æœ¬: {current_text[:30]}{'...'\
          \ if len(current_text) > 30 else ''}\"\n            final_status = StatusType.RETRYING.value\n\
          \            recovery_plan = generate_recovery_plan(error_type, retry_count,\
          \ error_details or {})\n        else:\n            status_emoji = \"âŒ\"\n\
          \            progress_info = f\"{status_emoji} ç¬¬ {current_index} é¡¹å¤„ç†å¤±è´¥\"\
          \n            progress_detail = f\"\U0001F4A5 æœ€ç»ˆå¤±è´¥ | é”™è¯¯ç±»å‹: {error_type}\
          \ | é”™è¯¯: {error} | é‡è¯•æ¬¡æ•°: {retry_count} | æ–‡æœ¬: {current_text[:30]}{'...' if\
          \ len(current_text) > 30 else ''}\"\n            final_status = StatusType.FAILED.value\n\
          \            recovery_plan = generate_recovery_plan(error_type, retry_count,\
          \ error_details or {})\n        \n        # è®°å½•å¤„ç†æ—¶é—´æˆ³\n        processing_timestamp\
          \ = time.strftime(\"%H:%M:%S\", time.localtime())\n        processing_duration\
          \ = round(time.time() - start_time, 3)\n        \n        result_obj = {\n\
          \            \"index\": current_index,\n            \"srt_text\": current_text,\n\
          \            \"timestamp\": srt_item.get(\"timestamp\", \"\"),\n       \
          \     \"image_url\": image_url if quality_pass else \"\",\n            \"\
          quality_score\": quality_score,\n            \"status\": final_status,\n\
          \            \"error\": error if not quality_pass else \"\",\n         \
          \   \"error_type\": error_type,\n            \"error_details\": error_details,\n\
          \            \"retry_count\": retry_count,\n            \"should_retry\"\
          : should_retry,\n            \"progress_info\": progress_info,\n       \
          \     \"progress_detail\": progress_detail,\n            \"processing_time\"\
          : processing_timestamp,\n            \"transaction_id\": transaction_id,\n\
          \            \"metrics\": metrics,\n            \"recovery_plan\": recovery_plan,\n\
          \            \"performance_info\": {\n                \"collection_duration\"\
          : processing_duration,\n                \"total_processing_time\": performance_info.get(\"\
          duration\", 0) if performance_info else 0,\n                \"efficiency_rating\"\
          : metrics['efficiency_score']\n            }\n        }\n        \n    \
          \    # è¾“å‡ºè¿›åº¦æ—¥å¿—\n        logging.info(f\"[{transaction_id}] {progress_info}\
          \ - {progress_detail}\")\n        \n        if recovery_plan:\n        \
          \    logging.info(f\"[{transaction_id}] æ¢å¤è®¡åˆ’: {recovery_plan['immediate_action']}\
          \ | é¢„è®¡æ—¶é—´: {recovery_plan['estimated_time']}\")\n        \n        return\
          \ {\"result\": result_obj}\n        \n    except Exception as e:\n     \
          \   # ç³»ç»Ÿçº§é”™è¯¯å¤„ç†\n        error_msg = f\"æ”¶é›†ç»“æœè¿‡ç¨‹ä¸­å‘ç”Ÿç³»ç»Ÿé”™è¯¯: {str(e)}\"\n      \
          \  logging.error(f\"[{transaction_id}] {error_msg}\")\n        \n      \
          \  return {\n            \"result\": {\n                \"index\": srt_item.get(\"\
          index\", 0) if isinstance(srt_item, dict) else 0,\n                \"status\"\
          : StatusType.FAILED.value,\n                \"error\": error_msg,\n    \
          \            \"error_type\": \"SYSTEM_ERROR\",\n                \"transaction_id\"\
          : transaction_id,\n                \"processing_time\": time.strftime(\"\
          %H:%M:%S\", time.localtime()),\n                \"performance_info\": {\"\
          collection_duration\": round(time.time() - start_time if 'start_time' in\
          \ locals() else 0, 3)}\n            }\n        }\n"
        code_language: python3
        desc: æ”¶é›†å•ä¸ªå›¾åƒç”Ÿæˆçš„ç»“æœ
        isInIteration: true
        outputs:
          result:
            children:
              error:
                type: string
              error_details:
                type: object
              error_type:
                type: string
              image_url:
                type: string
              index:
                type: number
              metrics:
                type: object
              performance_info:
                type: object
              processing_time:
                type: string
              progress_detail:
                type: string
              progress_info:
                type: string
              quality_score:
                type: number
              recovery_plan:
                type: object
              retry_count:
                type: number
              should_retry:
                type: boolean
              srt_text:
                type: string
              status:
                type: string
              timestamp:
                type: string
              transaction_id:
                type: string
            type: object
        selected: false
        title: æ”¶é›†ç»“æœ
        type: code
        variables:
        - value_selector:
          - '1760602942927'
          - quality_pass
          value_type: boolean
          variable: quality_pass
        - value_selector:
          - '1760602942927'
          - image_url
          value_type: string
          variable: image_url
        - value_selector:
          - '1760602942927'
          - quality_score
          value_type: number
          variable: quality_score
        - value_selector:
          - '1760602942927'
          - error
          value_type: string
          variable: error
        - value_selector:
          - '1760602942927'
          - srt_item
          value_type: object
          variable: srt_item
        - value_selector:
          - '1760602942927'
          - error_type
          value_type: string
          variable: error_type
        - value_selector:
          - '1760602942927'
          - should_retry
          value_type: boolean
          variable: should_retry
        - value_selector:
          - '1760602942927'
          - retry_count
          value_type: number
          variable: retry_count
      height: 79
      id: '17606215510130'
      parentId: '1760602669786'
      position:
        x: 2016
        y: 143
      positionAbsolute:
        x: 3858
        y: 566
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Doubao-pro-128k
          provider: langgenius/volcengine_maas/volcengine_maas
        prompt_template:
        - id: c2a261e2-2f32-48e0-832c-759d2e8574d0
          role: system
          text: ä½ æ˜¯ä¸“ä¸šçŸ­è§†é¢‘ç¼–å¯¼ã€‚æ ¹æ®ä¸»é¢˜ç”Ÿæˆç”¨äºé…å­—å¹•çš„ç®€æ´è„šæœ¬ï¼š\n1) æ ‡é¢˜ï¼ˆ<=20å­—ï¼‰\n2) å¼€åœºé’©å­ï¼ˆ1å¥ï¼‰\n3) æ­£æ–‡ï¼ˆ2-5å¥ï¼‰\n4)
            æ”¶å°¾ï¼ˆ1å¥ï¼‰\nç”¨å£è¯­åŒ–ä¸­æ–‡ï¼Œå»é™¤å¤šä½™è¯´æ˜ï¼Œä»…è¾“å‡ºæ–‡æœ¬å†…å®¹ã€‚
        - id: 05e32605-7023-478c-9fb7-6a77b2141d31
          role: user
          text: ä¸»é¢˜ï¼š{{#start_1.prompt#}}\næ—¶é•¿ï¼ˆç§’ï¼‰ï¼š{{#start_1.duration#}}
        selected: false
        title: ç”ŸæˆçŸ­è§†é¢‘è„šæœ¬
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1760621763757'
      position:
        x: 332
        y: 423
      positionAbsolute:
        x: 332
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Doubao-pro-128k
          provider: langgenius/volcengine_maas/volcengine_maas
        prompt_template:
        - id: 642ca730-6e40-4f9a-80e5-51b9a73367a7
          role: system
          text: æŠŠä¸‹é¢è„šæœ¬è½¬ä¸ºæ ‡å‡†SRTå­—å¹•å†…å®¹ã€‚æ€»æ—¶é•¿â‰ˆ{{#start_1.duration#}}ç§’ï¼Œå¹³å‡åˆ†é…ã€‚è¾“å‡ºä¸¥æ ¼ä¸ºSRTæ–‡æœ¬æ–‡æœ¬ï¼Œä¸è¦JSONæˆ–é¢å¤–è§£é‡Šã€‚
        - id: ffd1071d-58d5-4c1a-89cc-2761c848b6cf
          role: user
          text: '{{#1760621763757.text#}}'
        selected: false
        title: è„šæœ¬è½¬SRT
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1760621945531'
      position:
        x: 634
        y: 423
      positionAbsolute:
        x: 634
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(srt_text: str) -> dict:\n    \"\"\"\n    å°†SRTæ–‡æœ¬è½¬æ¢ä¸ºå¯¹è±¡æ•°ç»„æ ¼å¼\n\
          \    \n    åŠŸèƒ½è¯´æ˜ï¼š\n    1. è¿‡æ»¤æ‰æ€è€ƒæ ‡ç­¾å’Œä»£ç å—æ ‡è®°\n    2. æå–çº¯å‡€çš„SRTæ ¼å¼æ–‡æœ¬\n    3. è§£æSRTæ¡ç›®ä¸ºç»“æ„åŒ–æ•°ç»„\n\
          \    4. é¿å…é‡å¤æ•°æ®\n    \n    Args:\n        srt_text: ä»è„šæœ¬è½¬SRTèŠ‚ç‚¹è¾“å‡ºçš„æ–‡æœ¬ï¼ˆå¯èƒ½åŒ…å«æ€è€ƒè¿‡ç¨‹ï¼‰\n\
          \        \n    Returns:\n        dict: åŒ…å«è½¬æ¢åçš„å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«åºå·ã€æ—¶é—´æˆ³å’Œæ–‡æœ¬å†…å®¹\n  \
          \  \"\"\"\n    import re\n    \n    # å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œè¿”å›ç©ºæ•°ç»„\n    if not srt_text\
          \ or not srt_text.strip():\n        return {\"srt_array\": []}\n    \n \
          \   # é¢„å¤„ç†ï¼šç§»é™¤æ€è€ƒæ ‡ç­¾å’Œä»£ç å—æ ‡è®°\n    cleaned_text = srt_text\n    \n    # ç§»é™¤ <think>...</think>\
          \ æ ‡ç­¾åŠå…¶å†…å®¹\n    cleaned_text = re.sub(r'<think>.*?</think>', '', cleaned_text,\
          \ flags=re.DOTALL)\n    \n    # ç§»é™¤ä»£ç å—æ ‡è®°ï¼ˆ```å¼€å¤´å’Œç»“å°¾ï¼‰\n    cleaned_text = re.sub(r'^```[\\\
          w]*\\n?', '', cleaned_text, flags=re.MULTILINE)\n    cleaned_text = re.sub(r'\\\
          n?```$', '', cleaned_text, flags=re.MULTILINE)\n    cleaned_text = re.sub(r'```$',\
          \ '', cleaned_text)\n    \n    # æ¸…ç†å¤šä½™çš„ç©ºç™½å­—ç¬¦\n    cleaned_text = cleaned_text.strip()\n\
          \    \n    # å¦‚æœæ¸…ç†åä¸ºç©ºï¼Œè¿”å›ç©ºæ•°ç»„\n    if not cleaned_text:\n        return {\"\
          srt_array\": []}\n    \n    # æŒ‰è¡Œåˆ†å‰²SRTæ–‡æœ¬\n    lines = cleaned_text.split('\\\
          n')\n    \n    srt_array = []\n    current_subtitle = {}\n    \n    i =\
          \ 0\n    while i < len(lines):\n        line = lines[i].strip()\n      \
          \  \n        # è·³è¿‡ç©ºè¡Œ\n        if not line:\n            i += 1\n        \
          \    continue\n        \n        # æ£€æŸ¥æ˜¯å¦ä¸ºåºå·è¡Œï¼ˆçº¯æ•°å­—ï¼‰\n        if line.isdigit():\n\
          \            # å¼€å§‹æ–°çš„å­—å¹•æ¡ç›®\n            current_subtitle = {\n            \
          \    \"index\": int(line),\n                \"timestamp\": \"\",\n     \
          \           \"text\": \"\"\n            }\n            i += 1\n        \
          \    \n            # è·å–æ—¶é—´æˆ³è¡Œ\n            if i < len(lines) and '-->' in\
          \ lines[i]:\n                current_subtitle[\"timestamp\"] = lines[i].strip()\n\
          \                i += 1\n                \n                # è·å–æ–‡æœ¬å†…å®¹ï¼ˆå¯èƒ½å¤šè¡Œï¼‰\n\
          \                text_lines = []\n                while i < len(lines) and\
          \ lines[i].strip() and not lines[i].strip().isdigit():\n               \
          \     # æ¸…ç†æ–‡æœ¬è¡Œï¼Œç§»é™¤å¯èƒ½çš„ä»£ç å—æ ‡è®°\n                    text_line = lines[i].strip()\n\
          \                    text_line = re.sub(r'^```[\\w]*$', '', text_line)\n\
          \                    text_line = re.sub(r'^```$', '', text_line)\n     \
          \               if text_line:  # åªæ·»åŠ éç©ºè¡Œ\n                        text_lines.append(text_line)\n\
          \                    i += 1\n                \n                current_subtitle[\"\
          text\"] = \" \".join(text_lines)\n                \n                # æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼ˆç¡®ä¿ä¸é‡å¤ï¼‰\n\
          \                if current_subtitle[\"text\"] and current_subtitle not\
          \ in srt_array:\n                    srt_array.append(current_subtitle.copy())\n\
          \        else:\n            i += 1\n    \n    return {\"srt_array\": srt_array}"
        code_language: python3
        outputs:
          srt_array:
            children: null
            type: array[object]
        selected: false
        title: SRTè½¬æ•°ç»„
        type: code
        variables:
        - value_selector:
          - '1760621945531'
          - text
          value_type: string
          variable: srt_text
      height: 51
      id: '1760622014513'
      position:
        x: 936
        y: 423
      positionAbsolute:
        x: 936
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        isInIteration: true
        memory:
          query_prompt_template: ''
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: false
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Doubao-pro-128k
          provider: langgenius/volcengine_maas/volcengine_maas
        prompt_template:
        - id: sys-enhance
          role: system
          text: 'ä½ æ˜¯ä¸“ä¸šçš„AIå›¾åƒæç¤ºè¯ä¼˜åŒ–ä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·æä¾›çš„ç®€çŸ­æ–‡æœ¬ï¼Œç”Ÿæˆè¯¦ç»†çš„å›¾åƒç”Ÿæˆæç¤ºè¯ã€‚


            ä¼˜åŒ–è§„åˆ™ï¼š

            1. ä¿ç•™åŸæ–‡æœ¬çš„æ ¸å¿ƒå†…å®¹å’Œæ„å›¾

            2. æ·»åŠ è§†è§‰ç»†èŠ‚ï¼ˆå…‰çº¿ã€è‰²å½©ã€æ„å›¾ç­‰ï¼‰

            3. æ ¹æ®é£æ ¼æ·»åŠ ç›¸åº”çš„è‰ºæœ¯æè¿°è¯

            4. ç¡®ä¿æç¤ºè¯æ¸…æ™°ã€å…·ä½“ã€å¯Œæœ‰è¡¨ç°åŠ›

            5. è¾“å‡ºçº¯æ–‡æœ¬æç¤ºè¯ï¼Œä¸è¦åŒ…å«ä»»ä½•è¯´æ˜æˆ–æ ¼å¼æ ‡è®°


            é£æ ¼è¯´æ˜ï¼š

            - realistic: æ·»åŠ "é«˜æ¸…æ‘„å½±ã€çœŸå®æ„Ÿã€è‡ªç„¶å…‰çº¿ã€ç»†èŠ‚ä¸°å¯Œ"

            - anime: æ·»åŠ "åŠ¨æ¼«é£æ ¼ã€æ—¥å¼æ’ç”»ã€é²œè‰³è‰²å½©ã€äºŒæ¬¡å…ƒ"

            - oil_painting: æ·»åŠ "æ²¹ç”»é£æ ¼ã€å¤å…¸è‰ºæœ¯ã€åšé‡ç¬”è§¦ã€è‰ºæœ¯æ„Ÿ"

            - watercolor: æ·»åŠ "æ°´å½©ç”»ã€æŸ”å’Œè‰²è°ƒã€æ¸å˜æ•ˆæœã€æ¸…æ–°æ·¡é›…"

            - sketch: æ·»åŠ "ç´ æé£æ ¼ã€é»‘ç™½çº¿æ¡ã€æ‰‹ç»˜æ„Ÿã€è‰ºæœ¯åˆ›ä½œ"

            '
        - id: user-enhance
          role: user
          text: 'åŸå§‹æ–‡æœ¬ï¼š{{#1760602669786.item.text#}}

            å›¾åƒé£æ ¼ï¼š{{#code_input_validation.config.image_style#}}


            è¯·ä¼˜åŒ–è¿™ä¸ªæç¤ºè¯ï¼Œä½¿å…¶æ›´é€‚åˆç”Ÿæˆ{{#code_input_validation.config.image_style#}}é£æ ¼çš„å›¾åƒã€‚

            '
        selected: false
        title: æç¤ºè¯ä¼˜åŒ–
        type: llm
        vision:
          configs:
            detail: high
          enabled: false
      height: 87
      id: '17606223903400'
      parentId: '1760602669786'
      position:
        x: 204
        y: 139
      positionAbsolute:
        x: 2046
        y: 562
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-212
            key: ''
            type: text
            value: "{\n  \"width\": {{#start_1.width#}},\n  \"height\": {{#start_1.height#}}\n\
              }"
          type: raw-text
        headers: Content-Type:application/json
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: åˆ›å»ºè‰ç¨¿
        type: http-request
        url: '{{#env.api_base_url#}}/create_draft'
        variables: []
      height: 141
      id: '1761041582774'
      position:
        x: 4824
        y: 423
      positionAbsolute:
        x: 4824
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nimport re\n\ndef main(http_response_body: str) -> dict:\n\
          \    \"\"\"\n    ä»HTTPå“åº”ä¸­è§£æå¹¶è§„èŒƒåŒ–draft_id\n    \n    Args:\n        http_response_body:\
          \ HTTPè¯·æ±‚è¿”å›çš„JSONå­—ç¬¦ä¸²\n        \n    Returns:\n        dict: åŒ…å«è§„èŒƒåŒ–ådraft_idçš„å­—å…¸\n\
          \    \"\"\"\n    try:\n        # è§£æJSONå“åº”\n        response_data = json.loads(http_response_body)\n\
          \        \n        # æå–draft_id\n        draft_id = response_data.get('output',\
          \ {}).get('draft_id', '')\n        \n        # è§„èŒƒåŒ–å¤„ç†ï¼šå»é™¤æ¢è¡Œã€é¦–å°¾ç©ºç™½ï¼Œç¡®ä¿è¾“å‡ºä¸€è¡Œå­—ç¬¦ä¸²\n\
          \        if draft_id:\n            draft_id = str(draft_id)\n          \
          \  # å»é™¤æ‰€æœ‰æ¢è¡Œç¬¦ï¼ˆ\\n, \\rï¼‰\n            draft_id = re.sub(r'[\\n\\r]+', '',\
          \ draft_id)\n            # å»é™¤é¦–å°¾ç©ºç™½\n            draft_id = draft_id.strip()\n\
          \        else:\n            draft_id = ''\n            \n        return\
          \ {\n            'draft_id': draft_id\n        }\n        \n    except (json.JSONDecodeError,\
          \ AttributeError, KeyError) as e:\n        # å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n        return\
          \ {\n            'draft_id': ''\n        }"
        code_language: python3
        outputs:
          draft_id:
            children: null
            type: string
        selected: false
        title: è§£æå¹¶è§„èŒƒåŒ–è‰ç¨¿ID
        type: code
        variables:
        - value_selector:
          - '1761041582774'
          - body
          variable: http_response_body
      height: 51
      id: '1761042052305'
      position:
        x: 5126
        y: 423
      positionAbsolute:
        x: 5126
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-435
            key: ''
            type: text
            value: "{\n  \"audio_url\": \"{{#start_1.bgm_url#}}\",\n  \"draft_id\"\
              : \"{{#1761042052305.draft_id#}}\",\n  \"start\": 0,\n  \"end\": {{#start_1.duration#}},\n\
              \  \"volume\": 0.7,\n  \"track_name\": \"audio_main\",\n  \"material_type\"\
              : \"audio\",\n  \"type\": \"audio\",\n  \"materialType\": \"audio\"\n\
              }"
          type: raw-text
        headers: Content-Type:application/json
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: åŠ èƒŒæ™¯éŸ³ä¹æ·»
        type: http-request
        url: '{{#env.api_base_url#}}/add_audio'
        variables: []
      height: 125
      id: '17610437227200'
      position:
        x: 6334
        y: 423
      positionAbsolute:
        x: 6334
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-435
            key: ''
            type: text
            value: "{\n  \"draft_id\": \"{{#1761042052305.draft_id#}}\"\n}"
          type: raw-text
        headers: Content-Type:application/json
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: ä¿å­˜è‰ç¨¿
        type: http-request
        url: '{{#env.api_base_url#}}/save_draft'
        variables: []
      height: 125
      id: '17610437271090'
      position:
        x: 6636
        y: 423
      positionAbsolute:
        x: 6636
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        error_handle_mode: terminated
        height: 216
        is_parallel: false
        iterator_input_type: array[object]
        iterator_selector:
        - code_input_validation
        - srt_array
        output_selector:
        - '1761044999999'
        - audio_info
        output_type: array[object]
        parallel_nums: 10
        selected: false
        start_node_id: 1761044157730start
        title: è¯­éŸ³åˆæˆ
        type: iteration
        width: 1220
      height: 216
      id: '1761044157730'
      position:
        x: 2391
        y: 909
      positionAbsolute:
        x: 2391
        y: 909
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 1220
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1761044157730start
      parentId: '1761044157730'
      position:
        x: 60
        y: 83.5
      positionAbsolute:
        x: 2451
        y: 992.5
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        is_team_authorization: true
        iteration_id: '1761044157730'
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            ja_JP: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            pt_BR: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            zh_Hans: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
          label:
            en_US: text
            ja_JP: text
            pt_BR: text
            zh_Hans: text
          llm_description: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
          max: null
          min: null
          name: text
          options: []
          placeholder:
            en_US: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            ja_JP: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            pt_BR: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
            zh_Hans: è¦åˆæˆçš„æ–‡æœ¬å†…å®¹
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: éŸ³è‰²ç±»å‹
            ja_JP: éŸ³è‰²ç±»å‹
            pt_BR: éŸ³è‰²ç±»å‹
            zh_Hans: éŸ³è‰²ç±»å‹
          label:
            en_US: voice_type
            ja_JP: voice_type
            pt_BR: voice_type
            zh_Hans: voice_type
          llm_description: éŸ³è‰²ç±»å‹
          max: null
          min: null
          name: voice_type
          options: []
          placeholder:
            en_US: éŸ³è‰²ç±»å‹
            ja_JP: éŸ³è‰²ç±»å‹
            pt_BR: éŸ³è‰²ç±»å‹
            zh_Hans: éŸ³è‰²ç±»å‹
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: '1.0'
          form: llm
          human_description:
            en_US: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            ja_JP: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            pt_BR: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            zh_Hans: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
          label:
            en_US: speed_ratio
            ja_JP: speed_ratio
            pt_BR: speed_ratio
            zh_Hans: speed_ratio
          llm_description: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
          max: null
          min: null
          name: speed_ratio
          options: []
          placeholder:
            en_US: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            ja_JP: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            pt_BR: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
            zh_Hans: è¯­é€Ÿæ¯”ä¾‹ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œæ”¯æŒDifyå˜é‡è¡¨è¾¾å¼ï¼‰
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: mp3
          form: llm
          human_description:
            en_US: éŸ³é¢‘æ ¼å¼
            ja_JP: éŸ³é¢‘æ ¼å¼
            pt_BR: éŸ³é¢‘æ ¼å¼
            zh_Hans: éŸ³é¢‘æ ¼å¼
          label:
            en_US: audio_format
            ja_JP: audio_format
            pt_BR: audio_format
            zh_Hans: audio_format
          llm_description: éŸ³é¢‘æ ¼å¼
          max: null
          min: null
          name: audio_format
          options: []
          placeholder:
            en_US: éŸ³é¢‘æ ¼å¼
            ja_JP: éŸ³é¢‘æ ¼å¼
            pt_BR: éŸ³é¢‘æ ¼å¼
            zh_Hans: éŸ³é¢‘æ ¼å¼
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: 24000
          form: llm
          human_description:
            en_US: é‡‡æ ·ç‡
            ja_JP: é‡‡æ ·ç‡
            pt_BR: é‡‡æ ·ç‡
            zh_Hans: é‡‡æ ·ç‡
          label:
            en_US: sample_rate
            ja_JP: sample_rate
            pt_BR: sample_rate
            zh_Hans: sample_rate
          llm_description: é‡‡æ ·ç‡
          max: null
          min: null
          name: sample_rate
          options: []
          placeholder:
            en_US: é‡‡æ ·ç‡
            ja_JP: é‡‡æ ·ç‡
            pt_BR: é‡‡æ ·ç‡
            zh_Hans: é‡‡æ ·ç‡
          precision: null
          required: false
          scope: null
          template: null
          type: number
        params:
          audio_format: ''
          sample_rate: ''
          speed_ratio: ''
          text: ''
          voice_type: ''
        provider_id: e16b4054-17e0-4eeb-87e4-4fd994a92b6a
        provider_name: tts_gateway3006
        provider_type: api
        selected: false
        title: tts_synthesize
        tool_configurations: {}
        tool_description: è¾“å…¥æ–‡æœ¬å’ŒéŸ³è‰²å‚æ•°ï¼Œè¿”å›åˆæˆçš„éŸ³é¢‘URL
        tool_label: tts_synthesize
        tool_name: tts_synthesize
        tool_node_version: '2'
        tool_parameters:
          audio_format:
            type: mixed
            value: mp3
          sample_rate:
            type: constant
            value: 24000
          speed_ratio:
            type: mixed
            value: '1.0'
          text:
            type: mixed
            value: '{{#1761044157730.item.text#}}'
          voice_type:
            type: mixed
            value: '{{#start_1.tts_voice#}}'
        type: tool
      height: 51
      id: '1761044198738'
      parentId: '1761044157730'
      position:
        x: 204
        y: 82
      positionAbsolute:
        x: 2595
        y: 991
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "from typing import Any, Dict, Tuple\nimport ssl, urllib.request, urllib.error,\
          \ json, uuid, mimetypes\nimport logging\n\nDEF_PREFIX = 'capcut/audio'\n\
          DEFAULT_REFERER = 'http://8.148.70.18:8080'\nDEFAULT_UA = 'Mozilla/5.0 (Windows\
          \ NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0\
          \ Safari/537.36'\n\ndef _pick_file(files: Any) -> Tuple[str, str, str]:\n\
          \    \"\"\"Return (url, filename, content_type) if possible.\"\"\"\n   \
          \ url = ''\n    filename = 'upload.bin'\n    content_type = ''\n    if isinstance(files,\
          \ dict) and isinstance(files.get('files'), list):\n        files = files['files']\n\
          \    if isinstance(files, list) and files:\n        f = files[0] if isinstance(files[0],\
          \ dict) else None\n        if isinstance(f, dict):\n            url = (f.get('url')\
          \ or f.get('remote_url') or f.get('signed_url') or f.get('file_url') or\
          \ f.get('audio_url') or '').strip()\n            name = f.get('filename')\
          \ or f.get('name') or ''\n            ext = f.get('extension') or ''\n \
          \           mt = f.get('mime_type') or ''\n            if name:\n      \
          \          filename = name\n            elif ext:\n                filename\
          \ = 'upload' + (ext if ext.startswith('.') else ('.' + ext))\n         \
          \   if isinstance(mt, str) and mt.strip():\n                content_type\
          \ = mt.strip()\n            elif isinstance(filename, str):\n          \
          \      guessed = mimetypes.guess_type(filename)[0]\n                if guessed:\n\
          \                    content_type = guessed\n    return url, filename, content_type\n\
          \ndef _http_json(api_base_url: str, path: str, payload: Dict[str, Any])\
          \ -> Dict[str, Any]:\n    req = urllib.request.Request(\n        url=f\"\
          {api_base_url.rstrip('/')}/{path.lstrip('/')}\",\n        data=json.dumps(payload).encode('utf-8'),\n\
          \        headers={'Content-Type': 'application/json'},\n        method='POST',\n\
          \    )\n    ctx = ssl.create_default_context()\n    with urllib.request.urlopen(req,\
          \ timeout=30, context=ctx) as resp:\n        return json.loads(resp.read().decode('utf-8'))\n\
          \ndef _http_multipart(api_base_url: str, filename: str, content: bytes,\
          \ content_type: str) -> Dict[str, Any]:\n    boundary = '----DifyBoundary'\
          \ + uuid.uuid4().hex\n    ct = content_type or 'application/octet-stream'\n\
          \    parts = []\n    parts.append(f\"--{boundary}\\r\\nContent-Disposition:\
          \ form-data; name=\\\"prefix\\\"\\r\\n\\r\\n{DEF_PREFIX}\\r\\n\")\n    header\
          \ = (\n        f\"--{boundary}\\r\\n\"\n        f\"Content-Disposition:\
          \ form-data; name=\\\"file\\\"; filename=\\\"{filename}\\\"\\r\\n\"\n  \
          \      f\"Content-Type: {ct}\\r\\n\\r\\n\"\n    ).encode('utf-8')\n    tail\
          \ = f\"\\r\\n--{boundary}--\\r\\n\".encode('utf-8')\n    body = b''.join([p.encode('utf-8')\
          \ for p in parts]) + header + content + tail\n    req = urllib.request.Request(\n\
          \        url=f\"{api_base_url.rstrip('/')}/upload_to_oss\",\n        data=body,\n\
          \        headers={'Content-Type': f'multipart/form-data; boundary={boundary}'},\n\
          \        method='POST',\n    )\n    ctx = ssl.create_default_context()\n\
          \    with urllib.request.urlopen(req, timeout=60, context=ctx) as resp:\n\
          \        return json.loads(resp.read().decode('utf-8'))\n\ndef _try_upload(api_base_url:\
          \ str, file_url: str, filename: str, content_type: str) -> str:\n    ctx\
          \ = ssl.create_default_context()\n    req = urllib.request.Request(file_url,\
          \ method='GET', headers={'Referer': DEFAULT_REFERER, 'User-Agent': DEFAULT_UA})\n\
          \    try:\n        with urllib.request.urlopen(req, timeout=60, context=ctx)\
          \ as r:\n            data = r.read()\n            ct = content_type or r.headers.get('Content-Type',\
          \ '')\n        out = _http_multipart(api_base_url, filename, data, ct or\
          \ content_type)\n        return (out.get('oss_url') or '').strip()\n   \
          \ except Exception as e:\n        logging.warning(f\"Multipart upload failed:\
          \ {str(e)}\")\n        return ''\n\ndef _try_mirror(api_base_url: str, file_url:\
          \ str) -> str:\n    try:\n        out = _http_json(api_base_url, 'mirror_to_oss',\
          \ {'url': file_url, 'prefix': DEF_PREFIX})\n        return (out.get('oss_url')\
          \ or '').strip()\n    except Exception as e:\n        logging.warning(f\"\
          Mirror upload failed: {str(e)}\")\n        return ''\n\ndef main(files:\
          \ Any, api_base_url: str) -> Dict[str, Any]:\n    \"\"\"å°†è±†åŒ…ç”Ÿæˆçš„éŸ³é¢‘ä¸Šä¼ åˆ°OSSï¼Œè·å–æŒä¹…åŒ–çš„å…¬ç½‘è®¿é—®URL\"\
          \"\"\n    try:\n        url, filename, content_type = _pick_file(files)\n\
          \        \n        if not isinstance(api_base_url, str) or not api_base_url.strip():\n\
          \            logging.warning(\"API base URLæœªé…ç½®ï¼Œè¿”å›åŸå§‹URL\")\n            return\
          \ {\n                'oss_url': url or '',\n                'upload_success':\
          \ bool(url),\n                'error': 'API base URLæœªé…ç½®' if not url else\
          \ ''\n            }\n        \n        if not url:\n            logging.error(\"\
          æœªæ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é¢‘URL\")\n            return {\n                'oss_url': '',\n \
          \               'upload_success': False,\n                'error': 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„éŸ³é¢‘URL'\n\
          \            }\n        \n        logging.info(f\"å¼€å§‹ä¸Šä¼ éŸ³é¢‘åˆ°OSS: {filename},\
          \ åŸå§‹URL: {url[:100]}...\")\n        logging.info(f\"ä½¿ç”¨OSSæœåŠ¡åœ°å€: {api_base_url}\"\
          )\n        \n        # 1) ä¼˜å…ˆä½¿ç”¨ç›´æ¥ä¸Šä¼  (multipart)\n        oss_url = _try_upload(api_base_url,\
          \ url, filename, content_type)\n        if oss_url:\n            logging.info(f\"\
          Multipartä¸Šä¼ æˆåŠŸ: {oss_url}\")\n            return {\n                'oss_url':\
          \ oss_url,\n                'upload_success': True,\n                'error':\
          \ ''\n            }\n        \n        # 2) é™çº§ä¸ºURLé•œåƒä¸Šä¼ \n        logging.info(\"\
          Multipartä¸Šä¼ å¤±è´¥ï¼Œå°è¯•URLé•œåƒä¸Šä¼ \")\n        oss_url = _try_mirror(api_base_url,\
          \ url)\n        if oss_url:\n            logging.info(f\"URLé•œåƒä¸Šä¼ æˆåŠŸ: {oss_url}\"\
          )\n            return {\n                'oss_url': oss_url,\n         \
          \       'upload_success': True,\n                'error': ''\n         \
          \   }\n        \n        # 3) æ£€æŸ¥åŸå§‹URLæ˜¯å¦å¯è®¿é—®\n        logging.info(\"OSSä¸Šä¼ å¤±è´¥ï¼Œæ£€æŸ¥åŸå§‹URLå¯è®¿é—®æ€§\"\
          )\n        try:\n            req = urllib.request.Request(url, method='HEAD')\n\
          \            with urllib.request.urlopen(req, timeout=10) as response:\n\
          \                if response.status == 200:\n                    logging.info(f\"\
          åŸå§‹URLå¯è®¿é—®ï¼Œç›´æ¥ä½¿ç”¨: {url}\")\n                    return {\n                \
          \        'oss_url': url,\n                        'upload_success': True,\n\
          \                        'error': 'OSSä¸Šä¼ å¤±è´¥ï¼Œä½†åŸå§‹URLå¯ç”¨'\n                 \
          \   }\n        except Exception as e:\n            logging.warning(f\"åŸå§‹URLæ£€æŸ¥å¤±è´¥:\
          \ {str(e)}\")\n        \n        # 4) æ‰€æœ‰æ–¹å¼éƒ½å¤±è´¥ï¼Œä½†ä»è¿”å›åŸå§‹URLä½œä¸ºé™çº§\n        logging.warning(\"\
          æ‰€æœ‰ä¸Šä¼ æ–¹å¼éƒ½å¤±è´¥ï¼Œè¿”å›åŸå§‹URLä½œä¸ºé™çº§æ–¹æ¡ˆ\")\n        return {\n            'oss_url': url,\n\
          \            'upload_success': True,\n            'error': 'OSSä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹URL'\n\
          \        }\n        \n    except Exception as e:\n        error_msg = f\"\
          OSSä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: {str(e)}\"\n        logging.error(error_msg)\n        try:\n\
          \            url, _, _ = _pick_file(files)\n            if url:\n      \
          \          return {\n                    'oss_url': url,\n             \
          \       'upload_success': True,\n                    'error': f'OSSä¸Šä¼ å¼‚å¸¸ï¼Œè¿”å›åŸå§‹URL:\
          \ {str(e)}'\n                }\n        except:\n            pass\n    \
          \    return {\n            'oss_url': '',\n            'upload_success':\
          \ False,\n            'error': error_msg\n        }\n"
        code_language: python3
        isInIteration: true
        isInLoop: false
        iteration_id: '1761044157730'
        outputs:
          error:
            children: null
            type: string
          oss_url:
            children: null
            type: string
          upload_success:
            children: null
            type: boolean
        selected: false
        title: ä¸Šä¼ è¯­éŸ³åˆ°OSS
        type: code
        variables:
        - value_selector:
          - '1761044198738'
          - json
          value_type: array[object]
          variable: files
        - value_selector:
          - env
          - api_base_url
          value_type: string
          variable: api_base_url
      height: 51
      id: '1761044567218'
      parentId: '1761044157730'
      position:
        x: 506
        y: 82
      positionAbsolute:
        x: 2897
        y: 991
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "import urllib.request\nimport ssl\nimport struct\nimport logging\n\
          from typing import Dict, Any\n\ndef main(audio_url: str, srt_item: dict)\
          \ -> Dict[str, Any]:\n    \"\"\"\n    è·å–éŸ³é¢‘æ–‡ä»¶çš„å®é™…æ—¶é•¿\n    \n    åŠŸèƒ½è¯´æ˜ï¼š\n   \
          \ 1. ä¸‹è½½éŸ³é¢‘æ–‡ä»¶çš„å‰å‡ KBæ•°æ®\n    2. è§£æMP3æ–‡ä»¶å¤´è·å–æ—¶é•¿\n    3. è¿”å›éŸ³é¢‘ä¿¡æ¯ï¼ˆURLã€æ—¶é•¿ã€SRTä¿¡æ¯ï¼‰\n \
          \   \n    Args:\n        audio_url: OSSéŸ³é¢‘URL\n        srt_item: å½“å‰SRTé¡¹ï¼ˆåŒ…å«indexã€timestampã€textï¼‰\n\
          \        \n    Returns:\n        åŒ…å«éŸ³é¢‘URLã€æ—¶é•¿å’ŒSRTä¿¡æ¯çš„å­—å…¸\n    \"\"\"\n    \n\
          \    try:\n        if not audio_url or not isinstance(audio_url, str):\n\
          \            logging.warning(\"éŸ³é¢‘URLä¸ºç©ºæˆ–æ ¼å¼æ— æ•ˆ\")\n            return {\n \
          \               \"audio_info\": {\n                    \"audio_url\": \"\
          \",\n                    \"duration\": 0.0,\n                    \"index\"\
          : srt_item.get(\"index\", 0),\n                    \"timestamp\": srt_item.get(\"\
          timestamp\", \"\"),\n                    \"srt_text\": srt_item.get(\"text\"\
          , \"\"),\n                    \"method\": \"error\",\n                 \
          \   \"error\": \"éŸ³é¢‘URLä¸ºç©º\",\n                    \"warning\": \"\",\n  \
          \                  \"file_size\": 0\n                }\n            }\n\
          \        \n        logging.info(f\"å¼€å§‹è·å–éŸ³é¢‘æ—¶é•¿: {audio_url[:80]}...\")\n  \
          \      \n        # \U0001F3B5 æ–¹æ³•1ï¼šå°è¯•ä»HTTPå¤´è·å–Content-Lengthä¼°ç®—æ—¶é•¿\n       \
          \ try:\n            # åˆ›å»ºä¸éªŒè¯SSLè¯ä¹¦çš„contextï¼ˆé€‚ç”¨äºå†…ç½‘æˆ–è‡ªç­¾åè¯ä¹¦ï¼‰\n            ctx =\
          \ ssl.create_default_context()\n            ctx.check_hostname = False\n\
          \            ctx.verify_mode = ssl.CERT_NONE\n            \n           \
          \ req = urllib.request.Request(audio_url, method='HEAD')\n            with\
          \ urllib.request.urlopen(req, timeout=5, context=ctx) as response:\n   \
          \             content_length = response.headers.get('Content-Length')\n\
          \                if content_length:\n                    # MP3æ¯”ç‰¹ç‡é€šå¸¸ä¸º128kbps\
          \ = 16KB/s\n                    # duration (ç§’) â‰ˆ file_size (bytes) / (bitrate\
          \ / 8)\n                    file_size = int(content_length)\n          \
          \          estimated_duration = file_size / 16000  # å‡è®¾128kbps\n       \
          \             logging.info(f\"ä¼°ç®—éŸ³é¢‘æ—¶é•¿: {estimated_duration:.2f}ç§’ (æ–‡ä»¶å¤§å°: {file_size}\
          \ bytes)\")\n                    \n                    return {\n      \
          \                  \"audio_info\": {\n                            \"audio_url\"\
          : audio_url,\n                            \"duration\": round(estimated_duration,\
          \ 2),\n                            \"index\": srt_item.get(\"index\", 0),\n\
          \                            \"timestamp\": srt_item.get(\"timestamp\",\
          \ \"\"),\n                            \"srt_text\": srt_item.get(\"text\"\
          , \"\"),\n                            \"method\": \"estimated_from_size\"\
          ,\n                            \"file_size\": file_size,\n             \
          \               \"error\": \"\",\n                            \"warning\"\
          : \"\"\n                        }\n                    }\n        except\
          \ Exception as e:\n            logging.debug(f\"æ–¹æ³•1å¤±è´¥ï¼ˆHTTPå¤´ï¼‰: {str(e)[:100]}\"\
          )\n        \n        # \U0001F3B5 æ–¹æ³•2ï¼šä»SRTæ—¶é—´æˆ³è®¡ç®—æ—¶é•¿ï¼ˆæœ€å¯é ï¼‰\n        timestamp\
          \ = srt_item.get(\"timestamp\", \"\")\n        if \" --> \" in timestamp:\n\
          \            try:\n                start_str, end_str = timestamp.split(\"\
          \ --> \")\n                \n                def time_to_seconds(time_str:\
          \ str) -> float:\n                    \"\"\"è½¬æ¢ HH:MM:SS,mmm æ ¼å¼ä¸ºç§’æ•°\"\"\"\n\
          \                    parts = time_str.strip().split(',')\n             \
          \       if len(parts) != 2:\n                        return 0\n        \
          \            main_part = parts[0]  # HH:MM:SS\n                    ms =\
          \ parts[1]  # mmm\n                    time_parts = main_part.split(':')\n\
          \                    if len(time_parts) != 3:\n                        return\
          \ 0\n                    h = int(time_parts[0])\n                    m =\
          \ int(time_parts[1])\n                    s = int(time_parts[2])\n     \
          \               ms_val = int(ms) if ms.isdigit() else 0\n              \
          \      return h * 3600 + m * 60 + s + ms_val / 1000\n                \n\
          \                start = time_to_seconds(start_str)\n                end\
          \ = time_to_seconds(end_str)\n                srt_duration = end - start\n\
          \                \n                if srt_duration > 0:\n              \
          \      logging.info(f\"ä»SRTè·å–éŸ³é¢‘æ—¶é•¿: {srt_duration:.2f}ç§’\")\n            \
          \        return {\n                        \"audio_info\": {\n         \
          \                   \"audio_url\": audio_url,\n                        \
          \    \"duration\": round(srt_duration, 2),\n                           \
          \ \"index\": srt_item.get(\"index\", 0),\n                            \"\
          timestamp\": timestamp,\n                            \"srt_text\": srt_item.get(\"\
          text\", \"\"),\n                            \"method\": \"from_srt_timestamp\"\
          ,\n                            \"error\": \"\",\n                      \
          \      \"warning\": \"\",\n                            \"file_size\": 0\n\
          \                        }\n                    }\n            except Exception\
          \ as e:\n                logging.debug(f\"æ–¹æ³•2å¤±è´¥ï¼ˆSRTè§£æï¼‰: {str(e)[:100]}\"\
          )\n        \n        # \U0001F3B5 æ–¹æ³•3ï¼šä½¿ç”¨é»˜è®¤æ—¶é•¿ï¼ˆå…œåº•ï¼‰\n        logging.info(\"\
          ä½¿ç”¨é»˜è®¤æ—¶é•¿1.0ç§’\")\n        return {\n            \"audio_info\": {\n       \
          \         \"audio_url\": audio_url,\n                \"duration\": 1.0,\n\
          \                \"index\": srt_item.get(\"index\", 0),\n              \
          \  \"timestamp\": srt_item.get(\"timestamp\", \"\"),\n                \"\
          srt_text\": srt_item.get(\"text\", \"\"),\n                \"method\": \"\
          default\",\n                \"error\": \"\",\n                \"warning\"\
          : \"æ— æ³•è·å–å®é™…æ—¶é•¿ï¼Œä½¿ç”¨é»˜è®¤å€¼\",\n                \"file_size\": 0\n            }\n\
          \        }\n        \n    except Exception as e:\n        error_msg = f\"\
          è·å–éŸ³é¢‘æ—¶é•¿å¼‚å¸¸: {str(e)}\"\n        logging.error(error_msg)\n        return {\n\
          \            \"audio_info\": {\n                \"audio_url\": audio_url\
          \ or \"\",\n                \"duration\": 1.0,\n                \"index\"\
          : srt_item.get(\"index\", 0),\n                \"timestamp\": srt_item.get(\"\
          timestamp\", \"\"),\n                \"srt_text\": srt_item.get(\"text\"\
          , \"\"),\n                \"method\": \"error\",\n                \"error\"\
          : error_msg,\n                \"warning\": \"\",\n                \"file_size\"\
          : 0\n            }\n        }\n"
        code_language: python3
        desc: è·å–éŸ³é¢‘æ–‡ä»¶çš„å®é™…æ—¶é•¿ï¼Œä¼˜å…ˆä»SRTæ—¶é—´æˆ³è®¡ç®—
        isInIteration: true
        isInLoop: false
        iteration_id: '1761044157730'
        outputs:
          audio_info:
            children:
              audio_url:
                type: string
              duration:
                type: number
              error:
                type: string
              file_size:
                type: number
              index:
                type: number
              method:
                type: string
              srt_text:
                type: string
              timestamp:
                type: string
              warning:
                type: string
            type: object
        selected: false
        title: è·å–éŸ³é¢‘æ—¶é•¿
        type: code
        variables:
        - value_selector:
          - '1761044567218'
          - oss_url
          value_type: string
          variable: audio_url
        - value_selector:
          - '1761044157730'
          - item
          value_type: object
          variable: srt_item
      height: 95
      id: '1761044999999'
      parentId: '1761044157730'
      position:
        x: 808
        y: 60
      positionAbsolute:
        x: 3199
        y: 969
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "import requests\nimport json\nimport logging\n\ndef main(audios: list,\
          \ draft_id: str, api_base_url: str) -> dict:\n    \"\"\"\n    æ‰¹é‡æ·»åŠ è¯­éŸ³åˆ°è‰ç¨¿ï¼Œä½¿ç”¨æ ¼å¼åŒ–çš„éŸ³é¢‘æ•°ç»„ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰\n\
          \    \n    ä¿®å¤å†…å®¹ï¼š\n    1. ä¿®æ­£å­—æ®µåæ˜ å°„ï¼šä½¿ç”¨ start_time è€Œä¸æ˜¯ start\n    2. ä¿®æ­£æ—¶é—´å•ä½ï¼šç›´æ¥ä½¿ç”¨ç§’çº§æ—¶é—´æˆ³ï¼Œä¸è¿›è¡Œå¾®ç§’è½¬æ¢\n\
          \    3. æ·»åŠ å‚æ•°éªŒè¯\n    \n    Args:\n        audios: æ ¼å¼åŒ–çš„éŸ³é¢‘å¯¹è±¡æ•°ç»„ [{material_url,\
          \ start_time, duration, ...}]\n               start_time/durationéƒ½æ˜¯ç§’å•ä½\n\
          \        draft_id: è‰ç¨¿ID\n        api_base_url: APIåŸºç¡€URL\n        \n    Returns:\n\
          \        æ‰¹é‡å¤„ç†ç»“æœ\n    \"\"\"\n    results = []\n    success_count = 0\n \
          \   failed_count = 0\n    \n    logging.info(f\"========== å¼€å§‹æ‰¹é‡æ·»åŠ è¯­éŸ³ ==========\"\
          )\n    logging.info(f\"æ€»è®¡: {len(audios)} æ®µè¯­éŸ³\")\n    logging.info(f\"è‰ç¨¿ID:\
          \ {draft_id}\")\n    logging.info(f\"APIåœ°å€: {api_base_url}\")\n    \n  \
          \  for idx, audio in enumerate(audios, 1):\n        try:\n            #\
          \ \U0001F3B5 ä¿®å¤ï¼šæ­£ç¡®è·å–å­—æ®µå\n            # æ”¯æŒä» audio_url æˆ– material_url å­—æ®µè·å–éŸ³é¢‘URL\n\
          \            audio_url = audio.get('audio_url', '') or audio.get('material_url',\
          \ '')\n            \n            # ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„å­—æ®µå start_time å’Œ durationï¼ˆç§’çº§ï¼‰\n\
          \            start = audio.get('start_time', 0)  # ç§’çº§æ—¶é—´æˆ³\n            duration\
          \ = audio.get('duration', 0)  # ç§’çº§æ—¶é•¿\n            volume = audio.get('volume',\
          \ 10)  # éŸ³é‡ï¼ˆé»˜è®¤10ï¼‰\n            \n            if not audio_url:\n       \
          \         logging.warning(f\"è¯­éŸ³ {idx}: éŸ³é¢‘URLä¸ºç©º - audio_url: {audio.get('audio_url',\
          \ 'None')}, material_url: {audio.get('material_url', 'None')}\")\n     \
          \           failed_count += 1\n                results.append({\n      \
          \              \"index\": idx,\n                    \"status\": \"error\"\
          ,\n                    \"error\": \"éŸ³é¢‘URLä¸ºç©º\",\n                    \"audio_url\"\
          : audio_url\n                })\n                continue\n            \n\
          \            # éªŒè¯æ—¶é—´å‚æ•°çš„æœ‰æ•ˆæ€§\n            if start < 0 or duration <= 0:\n\
          \                logging.warning(f\"è¯­éŸ³ {idx}: æ—¶é—´å‚æ•°æ— æ•ˆ - start: {start}, duration:\
          \ {duration}\")\n                failed_count += 1\n                results.append({\n\
          \                    \"index\": idx,\n                    \"status\": \"\
          error\",\n                    \"error\": f\"æ—¶é—´å‚æ•°æ— æ•ˆ: start={start}, duration={duration}\"\
          ,\n                    \"audio_url\": audio_url\n                })\n  \
          \              continue\n            \n            # ä¿®å¤ï¼šç›´æ¥ä½¿ç”¨ç§’çº§æ—¶é—´æˆ³ï¼Œæ— éœ€è½¬æ¢\n\
          \            # start å’Œ duration å·²ç»æ˜¯ç§’çº§ï¼Œç›´æ¥ä½¿ç”¨\n            \n            #\
          \ å‡†å¤‡APIè¯·æ±‚æ•°æ®\n            payload = {\n                \"draft_id\": draft_id,\n\
          \                \"audio_url\": audio_url,\n                \"start\": start,\n\
          \                \"duration\": duration,\n                \"volume\": 1.0,\n\
          \                \"track_name\": \"audio_voice\",\n                \"material_type\"\
          : \"audio\",\n                \"type\": \"audio\"\n            }\n     \
          \       \n            logging.info(f\"è¯­éŸ³ {idx}/{len(audios)}\")\n      \
          \      logging.info(f\"  start={start:.3f}ç§’, duration={duration:.3f}ç§’, end={(start+duration):.3f}ç§’\"\
          )\n            logging.info(f\"  URL: {audio_url[:80]}...\")\n         \
          \   \n            # è°ƒç”¨API\n            response = requests.post(\n     \
          \           f\"{api_base_url}/add_audio\",\n                json=payload,\n\
          \                headers={'Content-Type': 'application/json'},\n       \
          \         timeout=30\n            )\n            \n            if response.status_code\
          \ == 200:\n                success_count += 1\n                logging.info(f\"\
          \  âœ… æˆåŠŸ\")\n                results.append({\n                    \"index\"\
          : audio.get('index', idx),\n                    \"status\": \"success\"\
          ,\n                    \"audio_url\": audio_url,  # ä½¿ç”¨å·²ç»è·å–çš„audio_urlå˜é‡ï¼ˆåŒ…å«material_urlçš„å€¼ï¼‰\n\
          \                    \"start\": start,\n                    \"duration\"\
          : duration,\n                    \"response\": response.text[:100]\n   \
          \             })\n            else:\n                failed_count += 1\n\
          \                logging.error(f\"  âŒ HTTP {response.status_code}: {response.text[:100]}\"\
          )\n                results.append({\n                    \"index\": audio.get('index',\
          \ idx),\n                    \"status\": \"error\",\n                  \
          \  \"error\": f\"HTTP {response.status_code}\",\n                    \"\
          audio_url\": audio_url,\n                    \"response\": response.text[:200]\n\
          \                })\n        except requests.Timeout:\n            failed_count\
          \ += 1\n            logging.error(f\"è¯­éŸ³ {idx}: è¯·æ±‚è¶…æ—¶\")\n            results.append({\n\
          \                \"index\": audio.get('index', idx),\n                \"\
          status\": \"error\",\n                \"error\": \"è¯·æ±‚è¶…æ—¶\",\n           \
          \     \"audio_url\": audio_url\n            })\n        except Exception\
          \ as e:\n            failed_count += 1\n            logging.error(f\"è¯­éŸ³\
          \ {idx}: å¼‚å¸¸ - {str(e)}\")\n            results.append({\n              \
          \  \"index\": audio.get('index', idx),\n                \"status\": \"error\"\
          ,\n                \"error\": str(e)[:200],\n                \"audio_url\"\
          : audio_url if 'audio_url' in locals() else audio.get('material_url', '')\n\
          \            })\n    \n    # ç”Ÿæˆæ‘˜è¦\n    summary = f\"âœ… æˆåŠŸ: {success_count},\
          \ âŒ å¤±è´¥: {failed_count}, \U0001F4CA æ€»è®¡: {len(audios)}\"\n    logging.info(f\"\
          ========== æ‰¹é‡æ·»åŠ å®Œæˆ ==========\")\n    logging.info(summary)\n    \n    return\
          \ {\n        \"success\": success_count > 0,\n        \"success_count\"\
          : success_count,\n        \"failed_count\": failed_count,\n        \"total_count\"\
          : len(audios),\n        \"summary\": summary,\n        \"results\": results\n\
          \    }"
        code_language: python3
        desc: æ‰¹é‡æ·»åŠ è¯­éŸ³åˆ°è‰ç¨¿ï¼Œæ¯ä¸ªè¯­éŸ³ä½¿ç”¨SRTæ—¶é—´æˆ³ä¸å›¾ç‰‡å¯¹é½
        outputs:
          failed_count:
            children: null
            type: number
          results:
            children: null
            type: array[object]
          success:
            children: null
            type: boolean
          success_count:
            children: null
            type: number
          summary:
            children: null
            type: string
          total_count:
            children: null
            type: number
        selected: false
        title: æ‰¹é‡æ·»åŠ è¯­éŸ³
        type: code
        variables:
        - value_selector:
          - code_aggregate_results
          - formatted_audios
          value_type: array[object]
          variable: audios
        - value_selector:
          - '1761042052305'
          - draft_id
          value_type: string
          variable: draft_id
        - value_selector:
          - env
          - api_base_url
          value_type: string
          variable: api_base_url
      height: 95
      id: '17610450813550'
      position:
        x: 5428
        y: 423
      positionAbsolute:
        x: 5428
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-212
            key: ''
            type: text
            value: "{\n  \"draft_id\": \"{{#1761042052305.draft_id#}}\"\n}"
          type: raw-text
        headers: Content-Type:application/json
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: ç”Ÿæˆè‰ç¨¿ä¸‹è½½é“¾æ¥
        type: http-request
        url: '{{#env.api_base_url#}}/generate_draft_url'
        variables: []
      height: 141
      id: '17610453130500'
      position:
        x: 6938
        y: 423
      positionAbsolute:
        x: 6938
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nimport requests\nimport time\n\ndef main(draft_id: str)\
          \ -> dict:\n    \"\"\"\n    ç”Ÿæˆè‰ç¨¿ä¸‹è½½é“¾æ¥çš„ä¼˜åŒ–ç‰ˆæœ¬\n    \n    ç­–ç•¥ï¼š\n    1. ç›´æ¥è°ƒç”¨ /generate_draft_url\
          \ API è·å–ä¸‹è½½é“¾æ¥ï¼ˆæ¨èæ–¹æ¡ˆï¼‰\n    2. å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨é¢„è§ˆé“¾æ¥ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ\n    3. ç”Ÿæˆé¢„è§ˆé“¾æ¥ç”¨äºåœ¨çº¿é¢„è§ˆ\n    \n\
          \    Args:\n        draft_id: è‰ç¨¿ID\n        \n    Returns:\n        åŒ…å«ä¸‹è½½é“¾æ¥å’Œé¢„è§ˆé“¾æ¥çš„å­—å…¸\n\
          \    \"\"\"\n    \n    result = {\n        \"real_download_url\": \"\",\n\
          \        \"preview_url\": \"\",\n        \"draft_id\": \"\",\n        \"\
          status\": \"success\",\n        \"debug_log\": [],\n        \"error_reason\"\
          : \"\"\n    }\n    \n    debug_log = result[\"debug_log\"]\n    \n    try:\n\
          \        if not draft_id:\n            result[\"status\"] = \"error: draft_idä¸ºç©º\"\
          \n            result[\"error_reason\"] = \"è¾“å…¥draft_idä¸ºç©º\"\n            return\
          \ result\n        \n        # æ¸…ç† draft_id\n        draft_id = str(draft_id).strip().strip('\"\
          ').strip(\"'\")\n        result[\"draft_id\"] = draft_id\n        debug_log.append(f\"\
          âœ… å¼€å§‹å¤„ç† - draft_id: {draft_id}\")\n        \n        # ç­–ç•¥1ï¼šè°ƒç”¨ /generate_draft_url\
          \ API è·å–æœ€å¯é çš„ä¸‹è½½é“¾æ¥\n        api_base = \"http://8.148.70.18:9000\"\n     \
          \   generate_url_api = f\"{api_base}/generate_draft_url\"\n        \n  \
          \      max_retries = 5\n        retry_delays = [2, 3, 4, 5, 6]\n       \
          \ last_error = \"\"\n        \n        for attempt in range(max_retries):\n\
          \            try:\n                # è°ƒç”¨ /generate_draft_url API\n      \
          \          payload = {\n                    \"draft_id\": draft_id,\n  \
          \                  \"client_os\": \"windows\",\n                    \"force_save\"\
          : True\n                }\n                \n                response =\
          \ requests.post(generate_url_api, json=payload, timeout=30)\n          \
          \      \n                if response.status_code == 200:\n             \
          \       try:\n                        result_data = response.json()\n  \
          \                      \n                        # æ£€æŸ¥APIæ˜¯å¦æˆåŠŸ\n         \
          \               if result_data.get('success'):\n                       \
          \     output = result_data.get('output', {})\n                         \
          \   download_url = output.get('draft_url')\n                           \
          \ \n                            if download_url and isinstance(download_url,\
          \ str) and download_url.strip():\n                                result[\"\
          real_download_url\"] = download_url.strip()\n                          \
          \      debug_log.append(f\"âœ… æˆåŠŸè·å–ä¸‹è½½é“¾æ¥ (å°è¯•{attempt + 1})\")\n           \
          \                     break\n                            else:\n       \
          \                         last_error = f\"draft_urlä¸ºç©º (æ¥æº: {output.get('source',\
          \ 'unknown')})\"\n                                if attempt < max_retries\
          \ - 1:\n                                    time.sleep(retry_delays[attempt])\n\
          \                        else:\n                            # APIè¿”å›å¤±è´¥\n\
          \                            last_error = result_data.get('error', 'APIè¿”å›success=false')\n\
          \                            if attempt < max_retries - 1:\n           \
          \                     time.sleep(retry_delays[attempt])\n              \
          \      except json.JSONDecodeError:\n                        last_error\
          \ = \"JSONè§£æå¤±è´¥\"\n                        if attempt < max_retries - 1:\n\
          \                            time.sleep(retry_delays[attempt])\n       \
          \         else:\n                    last_error = f\"HTTPçŠ¶æ€ç  {response.status_code}\"\
          \n                    if attempt < max_retries - 1:\n                  \
          \      time.sleep(retry_delays[attempt])\n                    \n       \
          \     except requests.Timeout:\n                last_error = \"è¯·æ±‚è¶…æ—¶\"\n\
          \                if attempt < max_retries - 1:\n                    time.sleep(retry_delays[attempt])\n\
          \            except Exception as e:\n                last_error = f\"å¼‚å¸¸:\
          \ {str(e)[:40]}\"\n                if attempt < max_retries - 1:\n     \
          \               time.sleep(retry_delays[attempt])\n        \n        # å¦‚æœæ²¡æœ‰è·å–åˆ°ä¸‹è½½é“¾æ¥ï¼Œä½¿ç”¨é¢„è§ˆé“¾æ¥ä½œä¸ºå¤‡é€‰ï¼ˆç”¨æˆ·å¯åœ¨é¢„è§ˆé¡µé¢ä¸­ä¸‹è½½ï¼‰\n\
          \        if not result[\"real_download_url\"]:\n            debug_log.append(f\"\
          âš ï¸ æ— æ³•è·å–ç›´æ¥ä¸‹è½½é“¾æ¥\")\n            debug_log.append(f\"\U0001F4A1 åŸå› : {last_error}\"\
          )\n            result[\"error_reason\"] = f\"æ— æ³•ç”Ÿæˆç›´æ¥ä¸‹è½½é“¾æ¥: {last_error}. è¯·ä½¿ç”¨é¢„è§ˆé“¾æ¥ä¸­çš„ä¸‹è½½æŒ‰é’®\"\
          \n        \n        # ç”Ÿæˆé¢„è§ˆé“¾æ¥ï¼ˆæ€»æ˜¯ç”Ÿæˆï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼‰\n        clean_draft_id = str(draft_id).strip().strip('\"\
          ').strip(\"'\")\n        if clean_draft_id:\n            result[\"preview_url\"\
          ] = f\"{api_base}/draft/preview/{clean_draft_id}\"\n            debug_log.append(f\"\
          âœ… ç”Ÿæˆé¢„è§ˆé“¾æ¥æˆåŠŸ\")\n        \n    except Exception as e:\n        result[\"status\"\
          ] = f\"error: {str(e)[:50]}\"\n        result[\"error_reason\"] = str(e)[:100]\n\
          \        debug_log.append(f\"âŒ å¼‚å¸¸: {str(e)[:40]}\")\n    \n    # æœ€ç»ˆçŠ¶æ€\n\
          \    debug_log.append(f\"\U0001F4CA çŠ¶æ€: {result['status']}\")\n    \n  \
          \  return result\n"
        code_language: python3
        outputs:
          debug_log:
            children: null
            type: array[string]
          draft_id:
            children: null
            type: string
          error_reason:
            children: null
            type: string
          preview_url:
            children: null
            type: string
          real_download_url:
            children: null
            type: string
          status:
            children: null
            type: string
        selected: false
        title: è§£æé“¾æ¥å’Œç”Ÿæˆé¢„è§ˆ
        type: code
        variables:
        - value_selector:
          - '1761042052305'
          - draft_id
          value_type: string
          variable: draft_id
      height: 51
      id: '1761045650096'
      position:
        x: 7240
        y: 423
      positionAbsolute:
        x: 7240
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import requests\nimport json\nimport logging\nfrom typing import List,\
          \ Dict, Any\nimport time\n\ndef main(images: list, draft_id: str, api_base_url:\
          \ str) -> dict:\n    \"\"\"\n    æ‰¹é‡æ·»åŠ å›¾ç‰‡åˆ°è‰ç¨¿ï¼Œä¿®å¤å­—æ®µåä¸åŒ¹é…é—®é¢˜\n    \n    Args:\n\
          \        images: å›¾ç‰‡å¯¹è±¡æ•°ç»„ï¼Œæ”¯æŒå¤šç§æ—¶é—´å­—æ®µæ ¼å¼\n        draft_id: è‰ç¨¿ID\n        api_base_url:\
          \ APIåŸºç¡€URL\n        \n    Returns:\n        æ‰¹é‡å¤„ç†ç»“æœ\n    \"\"\"\n    results\
          \ = []\n    success_count = 0\n    failed_count = 0\n    \n    logging.info(f\"\
          ========== å¼€å§‹æ‰¹é‡æ·»åŠ å›¾ç‰‡ ==========\")\n    logging.info(f\"æ€»è®¡: {len(images)}\
          \ å¼ å›¾ç‰‡\")\n    logging.info(f\"è‰ç¨¿ID: {draft_id}\")\n    logging.info(f\"\
          APIåœ°å€: {api_base_url}\")\n    \n    # \U0001F527 è·å–è‰ç¨¿å½“å‰æ—¶é•¿ï¼Œé¿å…æ—¶é—´æ®µé‡å \n    draft_duration\
          \ = 0\n    try:\n        # å°è¯•è·å–è‰ç¨¿ä¿¡æ¯ï¼ˆå¦‚æœAPIæ”¯æŒï¼‰\n        draft_info_response\
          \ = requests.get(f\"{api_base_url}/draft_info/{draft_id}\", timeout=10)\n\
          \        if draft_info_response.status_code == 200:\n            draft_data\
          \ = draft_info_response.json()\n            if draft_data.get('success')\
          \ and 'duration' in draft_data.get('output', {}):\n                draft_duration\
          \ = float(draft_data['output']['duration'])\n                logging.info(f\"\
          \U0001F4CF æ£€æµ‹åˆ°è‰ç¨¿å½“å‰æ—¶é•¿: {draft_duration:.3f}ç§’\")\n        else:\n        \
          \    logging.info(\"\U0001F4CF æ— æ³•è·å–è‰ç¨¿æ—¶é•¿ä¿¡æ¯ï¼Œå‡è®¾ä¸ºç©ºè‰ç¨¿\")\n    except Exception\
          \ as e:\n        logging.info(f\"\U0001F4CF è·å–è‰ç¨¿æ—¶é•¿å¤±è´¥: {str(e)[:50]}ï¼Œå‡è®¾ä¸ºç©ºè‰ç¨¿\"\
          )\n    \n    # åˆ¤æ–­APIä½¿ç”¨çš„æ—¶é—´å•ä½ï¼ˆåŸºäºé”™è¯¯ä¿¡æ¯åˆ†æï¼ŒAPIä½¿ç”¨å¾®ç§’ï¼‰\n    use_microseconds = True\n\
          \    logging.info(\"\U0001F550 æ£€æµ‹åˆ°APIä½¿ç”¨å¾®ç§’æ—¶é—´å•ä½\")\n    \n    # å¦‚æœè‰ç¨¿å·²æœ‰å†…å®¹ï¼Œå°†æ‰€æœ‰å›¾ç‰‡æ—¶é—´åç§»åˆ°è‰ç¨¿æœ«å°¾\n\
          \    # è‰ç¨¿æ—¶é•¿å¦‚æœæ˜¯å¾®ç§’ï¼Œéœ€è¦è½¬æ¢ä¸ºç§’è¿›è¡Œè®¡ç®—\n    time_offset_seconds = draft_duration /\
          \ 1000000 if use_microseconds and draft_duration > 0 else draft_duration\n\
          \    \n    # å¦‚æœæ£€æµ‹ä¸åˆ°è‰ç¨¿æ—¶é•¿ä½†ç¬¬ä¸€å¼ å›¾ç‰‡ä»0å¼€å§‹å¤±è´¥ï¼Œè¯´æ˜è‰ç¨¿æœ‰å†…å®¹\n    # æ ¹æ®é”™è¯¯ä¿¡æ¯ [start: 0, end:\
          \ 3000000] æ¨æµ‹è‰ç¨¿å·²æœ‰3ç§’å†…å®¹\n    if time_offset_seconds == 0:\n        # ä¿å®ˆèµ·è§ï¼Œä»3.1ç§’å¼€å§‹æ·»åŠ å›¾ç‰‡\n\
          \        time_offset_seconds = 3.1\n        logging.info(f\"âš ï¸  æ£€æµ‹åˆ°è‰ç¨¿å¯èƒ½å·²æœ‰å†…å®¹ï¼Œä»\
          \ {time_offset_seconds:.1f}ç§’ å¼€å§‹æ·»åŠ å›¾ç‰‡\")\n    elif time_offset_seconds > 0:\n\
          \        logging.info(f\"â° åº”ç”¨æ—¶é—´åç§»: +{time_offset_seconds:.3f}ç§’ï¼ˆé¿å…ä¸ç°æœ‰å†…å®¹é‡å ï¼‰\"\
          )\n    \n    for idx, img in enumerate(images, 1):\n        try:\n     \
          \       # \U0001F3A8 è·å–å›¾ç‰‡URL\n            image_url = img.get('image_url',\
          \ '') or img.get('material_url', '')\n            \n            # \U0001F550\
          \ æ”¯æŒå¤šç§æ—¶é—´å­—æ®µæ ¼å¼\n            start_time = img.get('start_time', img.get('start',\
          \ 0))  # ä¼˜å…ˆä½¿ç”¨start_time\n            end_time = img.get('end_time', img.get('end',\
          \ 0))  # ä¼˜å…ˆä½¿ç”¨end_time\n            duration_time = img.get('duration', 0)\
          \  # æŒç»­æ—¶é—´\n            \n            # ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æ—¶é—´å€¼ï¼ˆç§’ä¸ºå•ä½ï¼‰\n            start\
          \ = float(start_time)\n            duration = float(duration_time)\n   \
          \         \n            # å¦‚æœæœªæä¾›æŒç»­æ—¶é—´ä½†ç»™äº†ç»“æŸæ—¶é—´ï¼Œåˆ™ç”± end - start è®¡ç®—\n         \
          \   if duration <= 0 and end_time not in (None, \"\", 0):\n            \
          \    try:\n                    duration_candidate = float(end_time) - float(start_time)\n\
          \                    if duration_candidate > 0:\n                      \
          \  duration = duration_candidate\n                        logging.info(f\"\
          \  æ ¹æ®end_timeæ¨ç®—duration: {duration:.3f}ç§’\")\n                except Exception:\n\
          \                    pass\n            \n            # åº”ç”¨æ—¶é—´åç§»ï¼Œé¿å…ä¸ç°æœ‰å†…å®¹é‡å \n\
          \            start_with_offset = start + time_offset_seconds\n         \
          \   \n            if not image_url:\n                logging.warning(f\"\
          å›¾ç‰‡ {idx}: å›¾ç‰‡URLä¸ºç©º - image_url: '{img.get('image_url', '')}', material_url:\
          \ '{img.get('material_url', '')}'\")\n                failed_count += 1\n\
          \                results.append({\n                    \"index\": idx,\n\
          \                    \"status\": \"error\",\n                    \"error\"\
          : \"å›¾ç‰‡URLä¸ºç©º\"\n                })\n                continue\n          \
          \  \n            # éªŒè¯æ—¶é—´å‚æ•°çš„æœ‰æ•ˆæ€§\n            if start < 0 or duration <= 0:\n\
          \                logging.warning(f\"å›¾ç‰‡ {idx}: æ—¶é—´å‚æ•°æ— æ•ˆ - start: {start}, duration:\
          \ {duration}\")\n                failed_count += 1\n                results.append({\n\
          \                    \"index\": idx,\n                    \"status\": \"\
          error\",\n                    \"error\": f\"æ—¶é—´å‚æ•°æ— æ•ˆ: start={start}, duration={duration}\"\
          \n                })\n                continue\n            \n         \
          \   # \U0001F504 æ„å»ºAPIè¯·æ±‚æ•°æ®\n            request_data = {\n             \
          \   \"draft_id\": draft_id,\n                \"image_url\": image_url, \
          \ # APIæœŸæœ›çš„å‚æ•°åæ˜¯ image_url\n                \"start\": int(start_with_offset\
          \ * 1000000),\n                \"duration\": int(duration * 1000000)\n \
          \           }\n            \n            logging.info(f\"å›¾ç‰‡ {idx}/{len(images)}\"\
          )\n            logging.info(f\"  åŸå§‹æ—¶é—´: start={start:.3f}ç§’, duration={duration:.3f}ç§’\"\
          )\n            logging.info(f\"  åç§»å: start={start_with_offset:.3f}ç§’, end={(start_with_offset+duration):.3f}ç§’\"\
          )\n            logging.info(f\"  URL: {image_url[:80]}...\")\n         \
          \   \n            # è°ƒç”¨APIï¼ˆæ·»åŠ å‰ç­‰å¾…100msç¡®ä¿APIå®Œå…¨å¤„ç†å®Œä¸Šä¸€å¼ å›¾ç‰‡ï¼‰\n            if idx\
          \ > 1:\n                time.sleep(0.1)  # ç­‰å¾…100æ¯«ç§’\n            \n     \
          \       response = requests.post(\n                f\"{api_base_url}/add_image\"\
          ,\n                json=request_data,\n                headers={'Content-Type':\
          \ 'application/json'},\n                timeout=30\n            )\n    \
          \        \n            if response.status_code == 200:\n               \
          \ # æ£€æŸ¥å“åº”bodyä¸­çš„errorå­—æ®µ\n                try:\n                    response_data\
          \ = response.json()\n                    api_error = response_data.get('error',\
          \ '')\n                    \n                    if api_error and api_error.strip():\n\
          \                        # APIè¿”å›äº†é”™è¯¯ä¿¡æ¯\n                        failed_count\
          \ += 1\n                        logging.error(f\"  âŒ APIé”™è¯¯: {api_error[:100]}\"\
          )\n                        results.append({\n                          \
          \  \"index\": img.get('index', idx),\n                            \"status\"\
          : \"error\",\n                            \"error\": api_error[:200],\n\
          \                            \"image_url\": img.get('image_url'),\n    \
          \                        \"start\": start_with_offset,\n               \
          \             \"duration\": duration,\n                            \"response\"\
          : response.text[:100]\n                        })\n                    else:\n\
          \                        # çœŸæ­£æˆåŠŸ\n                        success_count +=\
          \ 1\n                        logging.info(f\"  âœ… æˆåŠŸ\")\n               \
          \         results.append({\n                            \"index\": img.get('index',\
          \ idx),\n                            \"status\": \"success\",\n        \
          \                    \"image_url\": img.get('image_url'),\n            \
          \                \"start\": start_with_offset,\n                       \
          \     \"duration\": duration,\n                            \"response\"\
          : response.text[:100]\n                        })\n                    \
          \    # è¿ç»­è¿½åŠ ï¼šæ›´æ–°åç§»åˆ°å½“å‰ç‰‡æ®µç»“æŸï¼Œé¿å…åç»­é‡å \n                        time_offset_seconds\
          \ = start_with_offset + duration + 0.001  # åŠ 1æ¯«ç§’é—´éš”\n                except\
          \ json.JSONDecodeError:\n                    # JSONè§£æå¤±è´¥ï¼ŒæŒ‰æˆåŠŸå¤„ç†\n        \
          \            success_count += 1\n                    logging.info(f\"  âœ…\
          \ æˆåŠŸ (æ— æ³•è§£æå“åº”JSON)\")\n                    results.append({\n           \
          \             \"index\": img.get('index', idx),\n                      \
          \  \"status\": \"success\",\n                        \"image_url\": img.get('image_url'),\n\
          \                        \"start\": start_with_offset,\n               \
          \         \"duration\": duration,\n                        \"response\"\
          : response.text[:100]\n                    })\n                    # è¿ç»­è¿½åŠ ï¼šæ›´æ–°åç§»åˆ°å½“å‰ç‰‡æ®µç»“æŸï¼Œé¿å…åç»­é‡å \n\
          \                    time_offset_seconds = start_with_offset + duration\
          \ + 0.001  # åŠ 1æ¯«ç§’é—´éš”\n            else:\n                failed_count +=\
          \ 1\n                logging.error(f\"  âŒ HTTP {response.status_code}: {response.text[:100]}\"\
          )\n                results.append({\n                    \"index\": img.get('index',\
          \ idx),\n                    \"status\": \"error\",\n                  \
          \  \"error\": f\"HTTP {response.status_code}\",\n                    \"\
          response\": response.text[:200]\n                })\n                \n\
          \        except requests.Timeout:\n            failed_count += 1\n     \
          \       logging.error(f\"å›¾ç‰‡ {idx}: è¯·æ±‚è¶…æ—¶\")\n            results.append({\n\
          \                \"index\": img.get('index', idx),\n                \"status\"\
          : \"error\",\n                \"error\": \"è¯·æ±‚è¶…æ—¶\"\n            })\n    \
          \    except Exception as e:\n            failed_count += 1\n           \
          \ logging.error(f\"å›¾ç‰‡ {idx}: å¼‚å¸¸ - {str(e)}\")\n            results.append({\n\
          \                \"index\": img.get('index', idx),\n                \"status\"\
          : \"error\",\n                \"error\": str(e)[:200]\n            })\n\
          \    \n    # ç”Ÿæˆæ‘˜è¦\n    summary = f\"âœ… æˆåŠŸ: {success_count}, âŒ å¤±è´¥: {failed_count},\
          \ \U0001F4CA æ€»è®¡: {len(images)}\"\n    logging.info(f\"========== æ‰¹é‡æ·»åŠ å®Œæˆ\
          \ ==========\")\n    logging.info(summary)\n    \n    return {\n       \
          \ \"success\": success_count > 0,\n        \"success_count\": success_count,\n\
          \        \"failed_count\": failed_count,\n        \"total_count\": len(images),\n\
          \        \"summary\": summary,\n        \"results\": results\n    }\n"
        code_language: python3
        desc: æ‰¹é‡æ·»åŠ å›¾ç‰‡åˆ°è‰ç¨¿ï¼Œé¿å…è¿­ä»£å…¼å®¹æ€§é—®é¢˜
        outputs:
          failed_count:
            children: null
            type: number
          results:
            children: null
            type: array[object]
          success:
            children: null
            type: boolean
          success_count:
            children: null
            type: number
          summary:
            children: null
            type: string
          total_count:
            children: null
            type: number
        selected: false
        title: æ‰¹é‡æ·»åŠ å›¾ç‰‡(ä¿®å¤ç‰ˆ)
        type: code
        variables:
        - value_selector:
          - code_aggregate_results
          - formatted_images
          value_type: array[object]
          variable: images
        - value_selector:
          - '1761042052305'
          - draft_id
          value_type: string
          variable: draft_id
        - value_selector:
          - env
          - api_base_url
          value_type: string
          variable: api_base_url
      height: 95
      id: code_batch_add_images
      position:
        x: 5730
        y: 423
      positionAbsolute:
        x: 5730
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1
    - data:
        code: "import requests\nimport json\nimport logging\nfrom typing import List,\
          \ Dict, Any\nimport time\nimport re\n\ndef parse_srt_timestamp(timestamp:\
          \ str) -> tuple:\n    \"\"\"\n    è§£æSRTæ—¶é—´æˆ³æ ¼å¼ \"00:00:00,000 --> 00:00:01,250\"\
          \n    \n    Args:\n        timestamp: SRTæ ¼å¼çš„æ—¶é—´æˆ³\n        \n    Returns:\n\
          \        (start_seconds, end_seconds, duration_seconds)\n    \"\"\"\n  \
          \  try:\n        # åˆ†å‰²å¼€å§‹å’Œç»“æŸæ—¶é—´\n        start_str, end_str = timestamp.split('\
          \ --> ')\n        \n        def time_to_seconds(time_str):\n           \
          \ # æ ¼å¼: \"00:00:00,000\"\n            time_part, ms_part = time_str.split(',')\n\
          \            h, m, s = map(int, time_part.split(':'))\n            ms =\
          \ int(ms_part)\n            return h * 3600 + m * 60 + s + ms / 1000.0\n\
          \        \n        start_seconds = time_to_seconds(start_str)\n        end_seconds\
          \ = time_to_seconds(end_str)\n        duration_seconds = end_seconds - start_seconds\n\
          \        \n        return start_seconds, end_seconds, duration_seconds\n\
          \        \n    except Exception as e:\n        logging.error(f\"è§£ææ—¶é—´æˆ³å¤±è´¥:\
          \ {timestamp}, é”™è¯¯: {e}\")\n        return 0, 0, 0\n\ndef main(srt_data:\
          \ list[dict], draft_id: str, api_base_url: str) -> dict:\n    \"\"\"\n \
          \   æ‰¹é‡æ·»åŠ å­—å¹•åˆ°è‰ç¨¿\n    \n    Args:\n        srt_data: å­—å¹•æ•°æ®æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å« index, timestamp,\
          \ text\n        draft_id: è‰ç¨¿ID\n        api_base_url: APIåŸºç¡€URL\n       \
          \ \n    Returns:\n        æ‰¹é‡å¤„ç†ç»“æœ\n    \"\"\"\n    results = []\n    success_count\
          \ = 0\n    failed_count = 0\n    \n    # é»˜è®¤å­—å¹•æ ·å¼å‚æ•°\n    default_params =\
          \ {\n        \"font\": \"SourceHanSansCN_Regular\",\n        \"font_size\"\
          : 24.0,\n        \"font_color\": \"#FFFFFF\",\n        \"width\": 1080,\n\
          \        \"height\": 1920,\n        \"material_type\": \"subtitle\",\n \
          \       \"type\": \"subtitle\",\n        \"materialType\": \"subtitle\"\n\
          \    }\n    \n    # åˆå¹¶ç”¨æˆ·æä¾›çš„å‚æ•°\n    subtitle_params = default_params\n  \
          \  \n    logging.info(f\"========== å¼€å§‹æ‰¹é‡æ·»åŠ å­—å¹• ==========\")\n    logging.info(f\"\
          æ€»è®¡: {len(srt_data)} æ¡å­—å¹•\")\n    logging.info(f\"è‰ç¨¿ID: {draft_id}\")\n  \
          \  logging.info(f\"APIåœ°å€: {api_base_url}\")\n    \n    # \U0001F527 è·å–è‰ç¨¿å½“å‰æ—¶é•¿ï¼Œé¿å…æ—¶é—´æ®µé‡å \n\
          \    draft_duration = 0\n    try:\n        draft_info_response = requests.get(f\"\
          {api_base_url}/draft_info/{draft_id}\", timeout=10)\n        if draft_info_response.status_code\
          \ == 200:\n            draft_data = draft_info_response.json()\n       \
          \     if draft_data.get('success') and 'duration' in draft_data.get('output',\
          \ {}):\n                draft_duration = float(draft_data['output']['duration'])\n\
          \                logging.info(f\"\U0001F4CF æ£€æµ‹åˆ°è‰ç¨¿å½“å‰æ—¶é•¿: {draft_duration:.3f}ç§’\"\
          )\n        else:\n            logging.info(\"\U0001F4CF æ— æ³•è·å–è‰ç¨¿æ—¶é•¿ä¿¡æ¯ï¼Œå‡è®¾ä¸ºç©ºè‰ç¨¿\"\
          )\n    except Exception as e:\n        logging.info(f\"\U0001F4CF è·å–è‰ç¨¿æ—¶é•¿å¤±è´¥:\
          \ {str(e)[:50]}ï¼Œå‡è®¾ä¸ºç©ºè‰ç¨¿\")\n    \n    # åˆ¤æ–­APIä½¿ç”¨çš„æ—¶é—´å•ä½ï¼ˆåŸºäºä¹‹å‰çš„åˆ†æï¼ŒAPIä½¿ç”¨å¾®ç§’ï¼‰\n \
          \   use_microseconds = True\n    logging.info(\"\U0001F550 æ£€æµ‹åˆ°APIä½¿ç”¨å¾®ç§’æ—¶é—´å•ä½\"\
          )\n    \n    # è®¡ç®—æ—¶é—´åç§»\n    time_offset_seconds = draft_duration / 1000000\
          \ if use_microseconds and draft_duration > 0 else draft_duration\n    \n\
          \    # å¦‚æœæ£€æµ‹ä¸åˆ°è‰ç¨¿æ—¶é•¿ï¼Œä¿å®ˆèµ·è§è®¾ç½®åç§»\n    if time_offset_seconds == 0:\n        time_offset_seconds\
          \ = 0  # å­—å¹•é€šå¸¸ä»0å¼€å§‹ï¼Œä¸éœ€è¦åç§»\n        logging.info(\"\U0001F4DD å­—å¹•ä»æ—¶é—´è½´èµ·å§‹ä½ç½®å¼€å§‹æ·»åŠ \"\
          )\n    else:\n        logging.info(f\"â° åº”ç”¨æ—¶é—´åç§»: +{time_offset_seconds:.3f}ç§’ï¼ˆé¿å…ä¸ç°æœ‰å†…å®¹é‡å ï¼‰\"\
          )\n    \n    for idx, subtitle in enumerate(srt_data, 1):\n        try:\n\
          \            # \U0001F3AF è§£æå­—å¹•æ•°æ®\n            subtitle_index = subtitle.get('index',\
          \ idx)\n            timestamp = subtitle.get('timestamp', '')\n        \
          \    text = subtitle.get('text', '')\n            \n            if not text.strip():\n\
          \                logging.warning(f\"å­—å¹• {idx}: æ–‡æœ¬å†…å®¹ä¸ºç©º\")\n              \
          \  failed_count += 1\n                results.append({\n               \
          \     \"index\": subtitle_index,\n                    \"status\": \"error\"\
          ,\n                    \"error\": \"å­—å¹•æ–‡æœ¬ä¸ºç©º\"\n                })\n     \
          \           continue\n            \n            if not timestamp:\n    \
          \            logging.warning(f\"å­—å¹• {idx}: æ—¶é—´æˆ³ä¸ºç©º\")\n                failed_count\
          \ += 1\n                results.append({\n                    \"index\"\
          : subtitle_index,\n                    \"status\": \"error\",\n        \
          \            \"error\": \"æ—¶é—´æˆ³ä¸ºç©º\"\n                })\n                continue\n\
          \            \n            # \U0001F550 è§£ææ—¶é—´æˆ³\n            start_seconds,\
          \ end_seconds, duration_seconds = parse_srt_timestamp(timestamp)\n     \
          \       \n            if duration_seconds <= 0:\n                logging.warning(f\"\
          å­—å¹• {idx}: æ—¶é—´æˆ³è§£æå¤±è´¥æˆ–æŒç»­æ—¶é—´æ— æ•ˆ: {timestamp}\")\n                failed_count +=\
          \ 1\n                results.append({\n                    \"index\": subtitle_index,\n\
          \                    \"status\": \"error\",\n                    \"error\"\
          : f\"æ—¶é—´æˆ³æ— æ•ˆ: {timestamp}\"\n                })\n                continue\n\
          \            \n            # åº”ç”¨æ—¶é—´åç§»\n            start_with_offset = start_seconds\
          \ + time_offset_seconds\n            \n            # \U0001F504 æ„å»ºAPIè¯·æ±‚æ•°æ®\
          \ - ä½¿ç”¨å®Œæ•´çš„SRTæ ¼å¼\n            # æ„å»ºSRTæ ¼å¼çš„å­—å¹•æ¡ç›®\n            srt_entry = f\"\
          {subtitle_index}\\n{timestamp}\\n{text}\\n\"\n            \n           \
          \ request_data = {\n                \"draft_id\": draft_id,\n          \
          \      \"srt\": srt_entry,  # å®Œæ•´çš„SRTæ ¼å¼æ•°æ®\n                \"time_offset\"\
          : int(time_offset_seconds * 1000000),  # åªä½¿ç”¨åç§»é‡ï¼Œä¸åŒ…å«å­—å¹•æœ¬èº«çš„å¼€å§‹æ—¶é—´\n         \
          \       **subtitle_params  # åˆå¹¶å­—å¹•æ ·å¼å‚æ•°\n            }\n            \n   \
          \         logging.info(f\"å­—å¹• {idx}/{len(srt_data)}\")\n            logging.info(f\"\
          \  åŸå§‹æ—¶é—´: {timestamp}\")\n            logging.info(f\"  è§£ææ—¶é—´: start={start_seconds:.3f}s,\
          \ end={end_seconds:.3f}s, duration={duration_seconds:.3f}s\")\n        \
          \    logging.info(f\"  åç§»å: start={start_with_offset:.3f}s\")\n        \
          \    logging.info(f\"  æ–‡æœ¬: {text[:50]}{'...' if len(text) > 50 else ''}\"\
          )\n            \n            # è°ƒç”¨APIï¼ˆæ·»åŠ å‰ç­‰å¾…100msç¡®ä¿APIå®Œå…¨å¤„ç†å®Œä¸Šä¸€æ¡å­—å¹•ï¼‰\n      \
          \      if idx > 1:\n                time.sleep(0.1)\n            \n    \
          \        response = requests.post(\n                f\"{api_base_url}/add_subtitle\"\
          ,\n                json=request_data,\n                headers={'Content-Type':\
          \ 'application/json'},\n                timeout=30\n            )\n    \
          \        \n            if response.status_code == 200:\n               \
          \ try:\n                    response_data = response.json()\n          \
          \          api_error = response_data.get('error', '')\n                \
          \    \n                    if api_error and api_error.strip():\n       \
          \                 # APIè¿”å›äº†é”™è¯¯ä¿¡æ¯\n                        failed_count +=\
          \ 1\n                        logging.error(f\"  âŒ APIé”™è¯¯: {api_error[:100]}\"\
          )\n                        results.append({\n                          \
          \  \"index\": subtitle_index,\n                            \"status\": \"\
          error\",\n                            \"error\": api_error[:200],\n    \
          \                        \"text\": text,\n                            \"\
          timestamp\": timestamp,\n                            \"start\": start_with_offset,\n\
          \                            \"duration\": duration_seconds,\n         \
          \                   \"response\": response.text[:100]\n                \
          \        })\n                    else:\n                        # æˆåŠŸ\n \
          \                       success_count += 1\n                        logging.info(f\"\
          \  âœ… æˆåŠŸæ·»åŠ \")\n                        results.append({\n               \
          \             \"index\": subtitle_index,\n                            \"\
          status\": \"success\",\n                            \"text\": text,\n  \
          \                          \"timestamp\": timestamp,\n                 \
          \           \"start\": start_with_offset,\n                            \"\
          duration\": duration_seconds,\n                            \"response\"\
          : response.text[:100]\n                        })\n                    \
          \    \n                except json.JSONDecodeError:\n                  \
          \  # JSONè§£æå¤±è´¥ï¼ŒæŒ‰æˆåŠŸå¤„ç†\n                    success_count += 1\n          \
          \          logging.info(f\"  âœ… æˆåŠŸæ·»åŠ  (æ— æ³•è§£æå“åº”JSON)\")\n                  \
          \  results.append({\n                        \"index\": subtitle_index,\n\
          \                        \"status\": \"success\",\n                    \
          \    \"text\": text,\n                        \"timestamp\": timestamp,\n\
          \                        \"start\": start_with_offset,\n               \
          \         \"duration\": duration_seconds,\n                        \"response\"\
          : response.text[:100]\n                    })\n            else:\n     \
          \           failed_count += 1\n                logging.error(f\"  âŒ HTTP\
          \ {response.status_code}: {response.text[:100]}\")\n                results.append({\n\
          \                    \"index\": subtitle_index,\n                    \"\
          status\": \"error\",\n                    \"error\": f\"HTTP {response.status_code}\"\
          ,\n                    \"response\": response.text[:200]\n             \
          \   })\n                \n        except requests.Timeout:\n           \
          \ failed_count += 1\n            logging.error(f\"å­—å¹• {idx}: è¯·æ±‚è¶…æ—¶\")\n  \
          \          results.append({\n                \"index\": subtitle.get('index',\
          \ idx),\n                \"status\": \"error\",\n                \"error\"\
          : \"è¯·æ±‚è¶…æ—¶\"\n            })\n        except Exception as e:\n           \
          \ failed_count += 1\n            logging.error(f\"å­—å¹• {idx}: å¼‚å¸¸ - {str(e)}\"\
          )\n            results.append({\n                \"index\": subtitle.get('index',\
          \ idx),\n                \"status\": \"error\",\n                \"error\"\
          : str(e)[:200]\n            })\n    \n    # ç”Ÿæˆæ‘˜è¦\n    summary = f\"âœ… æˆåŠŸ:\
          \ {success_count}, âŒ å¤±è´¥: {failed_count}, \U0001F4CA æ€»è®¡: {len(srt_data)}\"\
          \n    logging.info(f\"========== æ‰¹é‡æ·»åŠ å­—å¹•å®Œæˆ ==========\")\n    logging.info(summary)\n\
          \    \n    return {\n        \"summary\": summary\n    }"
        code_language: python3
        desc: æ‰¹é‡æ·»åŠ å­—å¹•
        outputs:
          summary:
            children: null
            type: string
        retry_config:
          max_retries: 3
          retry_enabled: false
          retry_interval: 1000
        selected: false
        title: æ‰¹é‡æ·»åŠ å­—å¹•
        type: code
        variables:
        - value_selector:
          - '1760622014513'
          - srt_array
          value_type: array[object]
          variable: srt_data
        - value_selector:
          - '1761042052305'
          - draft_id
          value_type: string
          variable: draft_id
        - value_selector:
          - env
          - api_base_url
          value_type: string
          variable: api_base_url
      height: 79
      id: '1761461437058'
      position:
        x: 6032
        y: 423
      positionAbsolute:
        x: 6032
        y: 423
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -1359.000000000001
      y: -239.0000000000001
      zoom: 0.7
  rag_pipeline_variables: []
