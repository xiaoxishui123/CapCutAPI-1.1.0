app:
  description: "åŸºäºMCP Bridgeçš„æ™ºèƒ½çŸ­è§†é¢‘ç”Ÿæˆå·¥ä½œæµ - å®Œæ•´åŠŸèƒ½ç‰ˆ"
  icon: "ğŸ¬"
  icon_background: "#FF6B6B"
  mode: workflow
  name: "æ™ºèƒ½çŸ­è§†é¢‘ç”Ÿæˆå™¨ v2.0"

kind: app
version: 0.1.2

workflow:
  conversation_variables: []
  environment_variables:
    - name: MCP_BRIDGE_URL
      type: string
      value: "http://localhost:8082"
    - name: CAPCUT_API_URL
      type: string
      value: "http://localhost:9000"
    - name: ENABLE_HTTP_FALLBACK
      type: string
      value: "true"
    - name: MAX_RETRY_COUNT
      type: string
      value: "3"
    - name: RENDER_TIMEOUT
      type: string
      value: "300"

  features:
    file_upload:
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
          - local_file
          - remote_url
    opening_statement: ""
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ""
      voice: ""

  graph:
    edges:
      - id: start-to-validate
        source: start
        target: validate_input
      - id: validate-to-script
        source: validate_input
        target: generate_script
      - id: script-to-tts
        source: generate_script
        target: tts_generation
      - id: tts-to-subtitle
        source: tts_generation
        target: subtitle_generation
      - id: subtitle-to-bgm
        source: subtitle_generation
        target: bgm_generation
      - id: bgm-to-visual
        source: bgm_generation
        target: visual_materials
      - id: visual-to-draft
        source: visual_materials
        target: create_draft
      - id: draft-to-assembly
        source: create_draft
        target: timeline_assembly
      - id: assembly-to-audio
        source: timeline_assembly
        target: audio_mixing
      - id: audio-to-subtitle-align
        source: audio_mixing
        target: subtitle_alignment
      - id: subtitle-align-to-render
        source: subtitle_alignment
        target: submit_render
      - id: render-to-monitor
        source: submit_render
        target: monitor_progress
      - id: monitor-to-end
        source: monitor_progress
        target: end

    nodes:
      # èŠ‚ç‚¹1: å¼€å§‹èŠ‚ç‚¹ - ç”¨æˆ·è¾“å…¥
      - data:
          desc: "ç”¨æˆ·è¾“å…¥å‚æ•°æ”¶é›†"
          selected: false
          title: "ç”¨æˆ·è¾“å…¥"
          type: start
          variables:
            - label: "è§†é¢‘ä¸»é¢˜"
              max_length: 200
              options: []
              required: true
              type: text-input
              variable: video_topic
            - label: "è§†é¢‘æ—¶é•¿(ç§’)"
              max_length: 10
              options: []
              required: false
              type: number-input
              variable: video_duration
            - label: "è§†é¢‘é£æ ¼"
              options:
                - "ç°ä»£ç®€çº¦"
                - "å•†åŠ¡ä¸“ä¸š"
                - "æ—¶å°šæ½®æµ"
                - "æ•™è‚²ç§‘æ™®"
                - "è¥é”€æ¨å¹¿"
              required: false
              type: select
              variable: video_style
            - label: "è§†é¢‘æ¯”ä¾‹"
              options:
                - "9:16"
                - "16:9"
                - "1:1"
              required: false
              type: select
              variable: video_ratio
            - label: "å¯ç”¨å­—å¹•"
              options:
                - "true"
                - "false"
              required: false
              type: select
              variable: enable_subtitle
            - label: "å¯ç”¨èƒŒæ™¯éŸ³ä¹"
              options:
                - "true"
                - "false"
              required: false
              type: select
              variable: enable_bgm
        height: 54
        id: start
        position:
          x: 80
          y: 282
        positionAbsolute:
          x: 80
          y: 282
        selected: false
        type: start
        width: 244

      # èŠ‚ç‚¹2: å‚æ•°éªŒè¯å’Œé¢„å¤„ç†
      - data:
          code: |
            import json
            
            def main(video_topic: str, video_duration: int = 30, video_style: str = "ç°ä»£ç®€çº¦", 
                    video_ratio: str = "9:16", enable_subtitle: str = "true", 
                    enable_bgm: str = "true") -> dict:
                """
                éªŒè¯å’Œé¢„å¤„ç†ç”¨æˆ·è¾“å…¥å‚æ•°
                """
                try:
                    # å‚æ•°éªŒè¯
                    if not video_topic or len(video_topic.strip()) == 0:
                        raise ValueError("è§†é¢‘ä¸»é¢˜ä¸èƒ½ä¸ºç©º")
                    
                    if video_duration <= 0 or video_duration > 300:
                        video_duration = 30
                    
                    # æ„å»ºéªŒè¯åçš„å‚æ•°
                    validated_params = {
                        "video_topic": video_topic.strip(),
                        "video_duration": int(video_duration),
                        "video_style": video_style,
                        "video_ratio": video_ratio,
                        "enable_subtitle": enable_subtitle.lower() == "true",
                        "enable_bgm": enable_bgm.lower() == "true",
                        "timestamp": int(time.time())
                    }
                    
                    return {
                        "validated_params": json.dumps(validated_params),
                        "validation_success": True,
                        "message": "å‚æ•°éªŒè¯æˆåŠŸ"
                    }
                except Exception as e:
                    return {
                        "validated_params": json.dumps({}),
                        "validation_success": False,
                        "message": f"å‚æ•°éªŒè¯å¤±è´¥: {str(e)}"
                    }
          desc: "éªŒè¯ç”¨æˆ·è¾“å…¥å‚æ•°å¹¶è®¾ç½®é»˜è®¤å€¼"
          outputs:
            validated_params:
              type: string
            validation_success:
              type: boolean
            message:
              type: string
          selected: false
          title: "å‚æ•°éªŒè¯"
          type: code
          variables:
            - value_selector:
                - start
                - video_topic
              variable: video_topic
            - value_selector:
                - start
                - video_duration
              variable: video_duration
            - value_selector:
                - start
                - video_style
              variable: video_style
            - value_selector:
                - start
                - video_ratio
              variable: video_ratio
            - value_selector:
                - start
                - enable_subtitle
              variable: enable_subtitle
            - value_selector:
                - start
                - enable_bgm
              variable: enable_bgm
        height: 54
        id: validate_input
        position:
          x: 384
          y: 282
        positionAbsolute:
          x: 384
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹3: è„šæœ¬ç”Ÿæˆ
      - data:
          context:
            enabled: false
            variable_selector: []
          desc: "åŸºäºç”¨æˆ·ä¸»é¢˜ç”Ÿæˆç»“æ„åŒ–è§†é¢‘è„šæœ¬"
          model:
            completion_params:
              temperature: 0.7
            mode: chat
            name: doubao-pro-32k
            provider: volcengine_maas
          prompt_template:
            - id: system
              role: system
              text: |
                ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ­è§†é¢‘è„šæœ¬åˆ›ä½œä¸“å®¶ã€‚è¯·åŸºäºç”¨æˆ·æä¾›çš„ä¸»é¢˜å’Œå‚æ•°ï¼Œç”Ÿæˆä¸€ä¸ªç»“æ„åŒ–çš„è§†é¢‘è„šæœ¬ã€‚

                è¦æ±‚ï¼š
                1. è„šæœ¬å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ—¶é•¿å’Œé£æ ¼
                2. å†…å®¹è¦æœ‰å¸å¼•åŠ›ï¼Œé€‚åˆçŸ­è§†é¢‘ä¼ æ’­
                3. åœºæ™¯åˆ’åˆ†è¦åˆç†ï¼Œæ¯ä¸ªåœºæ™¯3-8ç§’
                4. åŒ…å«è§†è§‰æè¿°ï¼Œä¾¿äºåç»­ç´ æç”Ÿæˆ

                è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š
                {
                  "title": "è§†é¢‘æ ‡é¢˜",
                  "description": "è§†é¢‘æè¿°",
                  "total_duration": 30,
                  "scenes": [
                    {
                      "id": 1,
                      "text": "åœºæ™¯æ–‡å­—å†…å®¹",
                      "duration": 5,
                      "visual_description": "è§†è§‰åœºæ™¯æè¿°",
                      "text_style": "å­—ä½“æ ·å¼å»ºè®®",
                      "transition": "è½¬åœºæ•ˆæœ"
                    }
                  ],
                  "bgm_style": "èƒŒæ™¯éŸ³ä¹é£æ ¼",
                  "voice_style": "æ—ç™½é£æ ¼"
                }
            - id: user
              role: user
              text: |
                è¯·ä¸ºä»¥ä¸‹ä¸»é¢˜ç”ŸæˆçŸ­è§†é¢‘è„šæœ¬ï¼š

                ä¸»é¢˜ï¼š{{#validate_input.validated_params#}}
                
                è¯·ç¡®ä¿å†…å®¹æœ‰è¶£ã€å¸å¼•äººï¼Œé€‚åˆæŒ‡å®šé£æ ¼ã€‚
          selected: false
          title: "è„šæœ¬ç”Ÿæˆ"
          type: llm
          variables:
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
          vision:
            enabled: false
        height: 98
        id: generate_script
        position:
          x: 688
          y: 282
        positionAbsolute:
          x: 688
          y: 282
        selected: false
        type: llm
        width: 244

      # èŠ‚ç‚¹4: TTSè¯­éŸ³åˆæˆ
      - data:
          code: |
            import json
            import requests
            import time
            
            def main(video_script: str, validated_params: str) -> dict:
                """
                TTSè¯­éŸ³åˆæˆå¤„ç†
                """
                try:
                    script_data = json.loads(video_script)
                    params_data = json.loads(validated_params)
                    
                    # æå–æ‰€æœ‰åœºæ™¯æ–‡å­—
                    all_text = []
                    for scene in script_data.get("scenes", []):
                        all_text.append(scene.get("text", ""))
                    
                    full_text = " ".join(all_text)
                    
                    # è°ƒç”¨TTSæœåŠ¡
                    tts_result = {
                        "audio_url": f"/tmp/tts_audio_{int(time.time())}.mp3",
                        "duration": params_data.get("video_duration", 30),
                        "text": full_text,
                        "voice_style": script_data.get("voice_style", "æ ‡å‡†å¥³å£°")
                    }
                    
                    return {
                        "tts_result": json.dumps(tts_result),
                        "audio_duration": tts_result["duration"],
                        "success": True
                    }
                except Exception as e:
                    return {
                        "tts_result": json.dumps({"error": str(e)}),
                        "audio_duration": 0,
                        "success": False
                    }
          desc: "ç”ŸæˆTTSè¯­éŸ³æ–‡ä»¶"
          outputs:
            tts_result:
              type: string
            audio_duration:
              type: number
            success:
              type: boolean
          selected: false
          title: "TTSè¯­éŸ³åˆæˆ"
          type: code
          variables:
            - value_selector:
                - generate_script
                - text
              variable: video_script
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
        height: 54
        id: tts_generation
        position:
          x: 992
          y: 182
        positionAbsolute:
          x: 992
          y: 182
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹5: å­—å¹•ç”Ÿæˆ
      - data:
          code: |
            import json
            import time
            
            def main(video_script: str, validated_params: str) -> dict:
                """
                ç”ŸæˆSRTæ ¼å¼å­—å¹•æ–‡ä»¶
                """
                try:
                    script_data = json.loads(video_script)
                    params_data = json.loads(validated_params)
                    
                    subtitles = []
                    current_time = 0
                    
                    for i, scene in enumerate(script_data.get("scenes", [])):
                        start_time = current_time
                        duration = scene.get("duration", 5)
                        end_time = start_time + duration
                        
                        subtitle = {
                            "index": i + 1,
                            "start_time": start_time,
                            "end_time": end_time,
                            "text": scene.get("text", ""),
                            "style": scene.get("text_style", "é»˜è®¤")
                        }
                        subtitles.append(subtitle)
                        current_time = end_time
                    
                    subtitle_result = {
                        "subtitle_file": f"/tmp/subtitle_{int(time.time())}.srt",
                        "subtitles": subtitles,
                        "total_duration": current_time
                    }
                    
                    return {
                        "subtitle_result": json.dumps(subtitle_result),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "subtitle_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "ç”Ÿæˆå­—å¹•æ–‡ä»¶"
          outputs:
            subtitle_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "å­—å¹•ç”Ÿæˆ"
          type: code
          variables:
            - value_selector:
                - generate_script
                - text
              variable: video_script
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
        height: 54
        id: subtitle_generation
        position:
          x: 992
          y: 282
        positionAbsolute:
          x: 992
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹6: BGMç”Ÿæˆ
      - data:
          code: |
            import json
            import time
            
            def main(video_script: str, validated_params: str) -> dict:
                """
                ç”ŸæˆèƒŒæ™¯éŸ³ä¹
                """
                try:
                    script_data = json.loads(video_script)
                    params_data = json.loads(validated_params)
                    
                    if not params_data.get("enable_bgm", True):
                        return {
                            "bgm_result": json.dumps({"enabled": False}),
                            "success": True
                        }
                    
                    bgm_style = script_data.get("bgm_style", "è½»æ¾æ„‰å¿«")
                    duration = params_data.get("video_duration", 30)
                    
                    bgm_result = {
                        "bgm_url": f"/tmp/bgm_{int(time.time())}.mp3",
                        "style": bgm_style,
                        "duration": duration,
                        "volume": 0.3
                    }
                    
                    return {
                        "bgm_result": json.dumps(bgm_result),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "bgm_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "ç”ŸæˆèƒŒæ™¯éŸ³ä¹"
          outputs:
            bgm_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "BGMç”Ÿæˆ"
          type: code
          variables:
            - value_selector:
                - generate_script
                - text
              variable: video_script
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
        height: 54
        id: bgm_generation
        position:
          x: 992
          y: 382
        positionAbsolute:
          x: 992
          y: 382
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹7: è§†è§‰ç´ æç”Ÿæˆ
      - data:
          code: |
            import json
            import time
            
            def main(video_script: str, validated_params: str) -> dict:
                """
                ç”Ÿæˆè§†è§‰ç´ æ
                """
                try:
                    script_data = json.loads(video_script)
                    params_data = json.loads(validated_params)
                    
                    visual_materials = []
                    
                    for i, scene in enumerate(script_data.get("scenes", [])):
                        visual_desc = scene.get("visual_description", "")
                        material = {
                            "scene_id": scene.get("id", i + 1),
                            "type": "image",
                            "description": visual_desc,
                            "url": f"/tmp/visual_{i+1}_{int(time.time())}.jpg",
                            "duration": scene.get("duration", 5)
                        }
                        visual_materials.append(material)
                    
                    visual_result = {
                        "materials": visual_materials,
                        "total_count": len(visual_materials)
                    }
                    
                    return {
                        "visual_result": json.dumps(visual_result),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "visual_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "ç”Ÿæˆè§†è§‰ç´ æ"
          outputs:
            visual_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "è§†è§‰ç´ æç”Ÿæˆ"
          type: code
          variables:
            - value_selector:
                - generate_script
                - text
              variable: video_script
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
        height: 54
        id: visual_materials
        position:
          x: 992
          y: 482
        positionAbsolute:
          x: 992
          y: 482
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹8: åˆ›å»ºCapCutè‰ç¨¿
      - data:
          api: "{{#env.CAPCUT_API_URL#}}/create_draft"
          body:
            data: "{{#validate_input.validated_params#}}"
            script: "{{#generate_script.text#}}"
          desc: "è°ƒç”¨CapCut APIåˆ›å»ºè§†é¢‘è‰ç¨¿"
          headers:
            Content-Type: application/json
          method: post
          selected: false
          timeout:
            max_connect_timeout: 300
            max_read_timeout: 600
            max_write_timeout: 600
          title: "åˆ›å»ºè‰ç¨¿"
          type: http-request
          variables:
            - value_selector:
                - validate_input
                - validated_params
              variable: validated_params
            - value_selector:
                - generate_script
                - text
              variable: script_data
        height: 54
        id: create_draft
        position:
          x: 1296
          y: 282
        positionAbsolute:
          x: 1296
          y: 282
        selected: false
        type: http-request
        width: 244

      # èŠ‚ç‚¹9: æ—¶é—´è½´ç»„è£…
      - data:
          code: |
            import json
            import time
            
            def main(draft_response: str, tts_result: str, subtitle_result: str, 
                    bgm_result: str, visual_result: str) -> dict:
                """
                ç»„è£…è§†é¢‘æ—¶é—´è½´
                """
                try:
                    draft_data = json.loads(draft_response)
                    tts_data = json.loads(tts_result)
                    subtitle_data = json.loads(subtitle_result)
                    bgm_data = json.loads(bgm_result)
                    visual_data = json.loads(visual_result)
                    
                    timeline = {
                        "draft_id": draft_data.get("draft_id"),
                        "tracks": {
                            "video": visual_data.get("materials", []),
                            "audio": [tts_data],
                            "bgm": [bgm_data] if bgm_data.get("enabled", True) else [],
                            "subtitle": subtitle_data.get("subtitles", [])
                        },
                        "total_duration": max(
                            tts_data.get("duration", 0),
                            subtitle_data.get("total_duration", 0)
                        )
                    }
                    
                    return {
                        "timeline_result": json.dumps(timeline),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "timeline_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "ç»„è£…è§†é¢‘æ—¶é—´è½´"
          outputs:
            timeline_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "æ—¶é—´è½´ç»„è£…"
          type: code
          variables:
            - value_selector:
                - create_draft
                - body
              variable: draft_response
            - value_selector:
                - tts_generation
                - tts_result
              variable: tts_result
            - value_selector:
                - subtitle_generation
                - subtitle_result
              variable: subtitle_result
            - value_selector:
                - bgm_generation
                - bgm_result
              variable: bgm_result
            - value_selector:
                - visual_materials
                - visual_result
              variable: visual_result
        height: 54
        id: timeline_assembly
        position:
          x: 1600
          y: 282
        positionAbsolute:
          x: 1600
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹10: éŸ³é¢‘æ··åˆ
      - data:
          code: |
            import json
            
            def main(timeline_result: str) -> dict:
                """
                éŸ³é¢‘æ··åˆå¤„ç†
                """
                try:
                    timeline_data = json.loads(timeline_result)
                    
                    audio_tracks = timeline_data.get("tracks", {})
                    mixed_audio = {
                        "main_audio": audio_tracks.get("audio", []),
                        "bgm": audio_tracks.get("bgm", []),
                        "mixed_file": f"/tmp/mixed_audio_{int(time.time())}.mp3",
                        "total_duration": timeline_data.get("total_duration", 30)
                    }
                    
                    return {
                        "audio_result": json.dumps(mixed_audio),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "audio_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "æ··åˆéŸ³é¢‘è½¨é“"
          outputs:
            audio_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "éŸ³é¢‘æ··åˆ"
          type: code
          variables:
            - value_selector:
                - timeline_assembly
                - timeline_result
              variable: timeline_result
        height: 54
        id: audio_mixing
        position:
          x: 1904
          y: 282
        positionAbsolute:
          x: 1904
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹11: å­—å¹•å¯¹é½
      - data:
          code: |
            import json
            
            def main(timeline_result: str, audio_result: str) -> dict:
                """
                å­—å¹•æ—¶é—´å¯¹é½
                """
                try:
                    timeline_data = json.loads(timeline_result)
                    audio_data = json.loads(audio_result)
                    
                    subtitles = timeline_data.get("tracks", {}).get("subtitle", [])
                    aligned_subtitles = []
                    
                    for subtitle in subtitles:
                        aligned_subtitle = subtitle.copy()
                        # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´ç²¾ç¡®çš„æ—¶é—´å¯¹é½é€»è¾‘
                        aligned_subtitles.append(aligned_subtitle)
                    
                    alignment_result = {
                        "aligned_subtitles": aligned_subtitles,
                        "subtitle_file": f"/tmp/aligned_subtitle_{int(time.time())}.srt"
                    }
                    
                    return {
                        "alignment_result": json.dumps(alignment_result),
                        "success": True
                    }
                except Exception as e:
                    return {
                        "alignment_result": json.dumps({"error": str(e)}),
                        "success": False
                    }
          desc: "å¯¹é½å­—å¹•æ—¶é—´"
          outputs:
            alignment_result:
              type: string
            success:
              type: boolean
          selected: false
          title: "å­—å¹•å¯¹é½"
          type: code
          variables:
            - value_selector:
                - timeline_assembly
                - timeline_result
              variable: timeline_result
            - value_selector:
                - audio_mixing
                - audio_result
              variable: audio_result
        height: 54
        id: subtitle_alignment
        position:
          x: 2208
          y: 282
        positionAbsolute:
          x: 2208
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹12: æäº¤æ¸²æŸ“
      - data:
          api: "{{#env.CAPCUT_API_URL#}}/submit_render"
          body:
            draft_id: "{{#create_draft.body#}}"
            timeline: "{{#timeline_assembly.timeline_result#}}"
            audio: "{{#audio_mixing.audio_result#}}"
            subtitles: "{{#subtitle_alignment.alignment_result#}}"
          desc: "æäº¤è§†é¢‘æ¸²æŸ“ä»»åŠ¡"
          headers:
            Content-Type: application/json
          method: post
          selected: false
          timeout:
            max_connect_timeout: 300
            max_read_timeout: 600
            max_write_timeout: 600
          title: "æäº¤æ¸²æŸ“"
          type: http-request
          variables:
            - value_selector:
                - create_draft
                - body
              variable: draft_id
            - value_selector:
                - timeline_assembly
                - timeline_result
              variable: timeline_data
            - value_selector:
                - audio_mixing
                - audio_result
              variable: audio_data
            - value_selector:
                - subtitle_alignment
                - alignment_result
              variable: subtitle_data
        height: 54
        id: submit_render
        position:
          x: 2512
          y: 282
        positionAbsolute:
          x: 2512
          y: 282
        selected: false
        type: http-request
        width: 244

      # èŠ‚ç‚¹13: è¿›åº¦ç›‘æ§
      - data:
          code: |
            import json
            import time
            
            def main(render_response: str) -> dict:
                """
                ç›‘æ§æ¸²æŸ“è¿›åº¦
                """
                try:
                    render_data = json.loads(render_response)
                    render_id = render_data.get("render_id")
                    
                    # è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„è¿›åº¦æŸ¥è¯¢é€»è¾‘
                    progress_result = {
                        "render_id": render_id,
                        "status": "completed",
                        "progress": 100,
                        "video_url": f"/tmp/final_video_{int(time.time())}.mp4",
                        "completion_time": int(time.time())
                    }
                    
                    return {
                        "progress_result": json.dumps(progress_result),
                        "final_video_url": progress_result["video_url"],
                        "success": True
                    }
                except Exception as e:
                    return {
                        "progress_result": json.dumps({"error": str(e)}),
                        "final_video_url": "",
                        "success": False
                    }
          desc: "ç›‘æ§æ¸²æŸ“è¿›åº¦"
          outputs:
            progress_result:
              type: string
            final_video_url:
              type: string
            success:
              type: boolean
          selected: false
          title: "è¿›åº¦ç›‘æ§"
          type: code
          variables:
            - value_selector:
                - submit_render
                - body
              variable: render_response
        height: 54
        id: monitor_progress
        position:
          x: 2816
          y: 282
        positionAbsolute:
          x: 2816
          y: 282
        selected: false
        type: code
        width: 244

      # èŠ‚ç‚¹14: ç»“æŸèŠ‚ç‚¹
      - data:
          desc: "å·¥ä½œæµå®Œæˆï¼Œè¾“å‡ºæœ€ç»ˆç»“æœ"
          outputs:
            - value_selector:
                - monitor_progress
                - final_video_url
              variable: final_video_url
            - value_selector:
                - monitor_progress
                - progress_result
              variable: progress_details
          selected: false
          title: "å®Œæˆ"
          type: end
        height: 54
        id: end
        position:
          x: 3120
          y: 282
        positionAbsolute:
          x: 3120
          y: 282
        selected: false
        type: end
        width: 244