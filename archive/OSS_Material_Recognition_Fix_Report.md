# OSSæ¨¡å¼ç´ æè¯†åˆ«é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

**é—®é¢˜æè¿°**: OSSæ¨¡å¼ä¸‹ä¿å­˜çš„è‰ç¨¿åœ¨å‰ªæ˜ ä¸­æ‰“å¼€æ—¶æ˜¾ç¤º"ç´ æä¸¢å¤±ï¼Œç‚¹å‡»é‡æ–°é“¾æ¥"

**å½±å“èŒƒå›´**: æ‰€æœ‰é€šè¿‡OSSæ¨¡å¼ä¿å­˜çš„è‰ç¨¿

**å‘ç°æ—¶é—´**: 2025å¹´8æœˆ6æ—¥

## ğŸ” é—®é¢˜æ ¹å› åˆ†æ

### æ ¸å¿ƒé—®é¢˜
OSSæ¨¡å¼ä¸‹ç”Ÿæˆçš„`draft_info.json`æ–‡ä»¶ä¸­ï¼Œç´ æè·¯å¾„æ ¼å¼ä¸æ­£ç¡®ï¼š

**âŒ ä¿®å¤å‰ (OSSæ¨¡å¼):**
```json
{
  "path": "assets/video/file.mp4",           // ç›¸å¯¹è·¯å¾„
  "media_path": "assets/video/file.mp4"      // ç›¸å¯¹è·¯å¾„
}
```

**âœ… ä¿®å¤å (OSSæ¨¡å¼):**
```json
{
  "path": "F:\\jianying\\cgwz\\JianyingPro Drafts\\draft_id\\assets\\video\\file.mp4",
  "media_path": "F:\\jianying\\cgwz\\JianyingPro Drafts\\draft_id\\assets\\video\\file.mp4"
}
```

### å¯¹æ¯”åˆ†æ

| æ¨¡å¼ | ä¿®å¤å‰è·¯å¾„æ ¼å¼ | ä¿®å¤åè·¯å¾„æ ¼å¼ | å‰ªæ˜ è¯†åˆ« |
|------|----------------|----------------|----------|
| æœ¬åœ°æ¨¡å¼ | Windowsç»å¯¹è·¯å¾„ | Windowsç»å¯¹è·¯å¾„ | âœ… æ­£å¸¸ |
| OSSæ¨¡å¼ | ç›¸å¯¹è·¯å¾„ | Windowsç»å¯¹è·¯å¾„ | âœ… æ­£å¸¸ |

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. é—®é¢˜å®šä½
åœ¨ `save_draft_impl.py` æ–‡ä»¶ä¸­å‘ç°é—®é¢˜ä»£ç ï¼š

```python
# é—®é¢˜ä»£ç  (ç¬¬117ã€143ã€162è¡Œ)
if draft_folder:
    audio.replace_path = build_asset_path(draft_folder, draft_id, "audio", material_name)
else:
    # OSS mode: set relative path for replace_path
    audio.replace_path = f"assets/audio/{material_name}"  # âŒ ç›¸å¯¹è·¯å¾„
```

### 2. ä¿®å¤å®ç°

#### A. æ·»åŠ é»˜è®¤Windowsè·¯å¾„å¸¸é‡
```python
# OSSæ¨¡å¼é»˜è®¤Windowsè‰ç¨¿æ–‡ä»¶å¤¹è·¯å¾„
DEFAULT_WINDOWS_DRAFT_FOLDER = "F:\\jianyin\\cgwz\\JianyingPro Drafts"
```

#### B. ä¿®å¤save_draft_backgroundå‡½æ•°
```python
# OSSæ¨¡å¼ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šdraft_folderï¼Œä½¿ç”¨é»˜è®¤çš„Windowsè·¯å¾„
if not draft_folder:
    draft_folder = DEFAULT_WINDOWS_DRAFT_FOLDER
    logger.info(f"OSS mode: Using default Windows draft folder: {draft_folder}")

# å§‹ç»ˆä½¿ç”¨build_asset_pathç”Ÿæˆæ­£ç¡®çš„Windowsæ ¼å¼è·¯å¾„
audio.replace_path = build_asset_path(draft_folder, draft_id, "audio", material_name)
video.replace_path = build_asset_path(draft_folder, draft_id, "video", material_name)  
video.replace_path = build_asset_path(draft_folder, draft_id, "image", material_name)
```

#### C. åŒæ­¥ä¿®å¤download_scriptå‡½æ•°
ç¡®ä¿æ‰€æœ‰ç›¸å…³å‡½æ•°éƒ½ä½¿ç”¨ä¸€è‡´çš„è·¯å¾„ç”Ÿæˆé€»è¾‘ã€‚

### 3. ä¿®å¤ä½ç½®æ±‡æ€»

**æ–‡ä»¶**: `save_draft_impl.py`

**ä¿®æ”¹è¡Œæ•°**:
- ç¬¬33è¡Œ: æ·»åŠ DEFAULT_WINDOWS_DRAFT_FOLDERå¸¸é‡
- ç¬¬108-112è¡Œ: OSSæ¨¡å¼è·¯å¾„é»˜è®¤å€¼è®¾ç½®
- ç¬¬117-120è¡Œ: éŸ³é¢‘è·¯å¾„ä¿®å¤  
- ç¬¬143-146è¡Œ: å›¾ç‰‡è·¯å¾„ä¿®å¤
- ç¬¬162-165è¡Œ: è§†é¢‘è·¯å¾„ä¿®å¤
- ç¬¬630-634è¡Œ: download_scriptå‡½æ•°è·¯å¾„ä¿®å¤

## âœ… éªŒè¯ç»“æœ

### ä¿®å¤å‰åå¯¹æ¯”

**ä¿®å¤å‰ (OSSæ¨¡å¼ç”Ÿæˆçš„è·¯å¾„):**
```
assets/video/video_abc123.mp4  âŒ
```

**ä¿®å¤å (OSSæ¨¡å¼ç”Ÿæˆçš„è·¯å¾„):**
```
F:\jianyin\cgwz\JianyingPro Drafts\draft_id\assets\video\video_abc123.mp4  âœ…
```

### æµ‹è¯•éªŒè¯è¿‡ç¨‹

1. **åˆ›å»ºæµ‹è¯•è‰ç¨¿**: `local_path_test`
2. **æ·»åŠ è§†é¢‘ç´ æ**: æˆåŠŸæ·»åŠ ç¤ºä¾‹è§†é¢‘
3. **OSSæ¨¡å¼ä¿å­˜**: ä¸æä¾›draft_folderå‚æ•°
4. **è·¯å¾„æ ¼å¼éªŒè¯**: 
   ```
   Video path: F:\jianyin\cgwz\JianyingPro Drafts\local_path_test\assets\video\video_233dca6aab0d9840e7e06a1b8abb946e.mp4
   âœ… Windowsç»å¯¹è·¯å¾„æ ¼å¼æ­£ç¡®
   ```

## ğŸ¯ ä¿®å¤æ•ˆæœ

### æŠ€æœ¯æŒ‡æ ‡
- âœ… OSSæ¨¡å¼è·¯å¾„æ ¼å¼ï¼šWindowsç»å¯¹è·¯å¾„
- âœ… è·¯å¾„æ ¼å¼ä¸€è‡´æ€§ï¼šä¸æœ¬åœ°æ¨¡å¼å®Œå…¨ä¸€è‡´  
- âœ… å‘åå…¼å®¹æ€§ï¼šæœ¬åœ°æ¨¡å¼ä¸å—å½±å“
- âœ… æ–‡ä»¶ä¸‹è½½æ­£å¸¸ï¼šæ‰€æœ‰ç´ ææ–‡ä»¶å®Œæ•´ä¸‹è½½

### ç”¨æˆ·ä½“éªŒ
- âœ… å‰ªæ˜ æ­£å¸¸è¯†åˆ«æ‰€æœ‰ç´ æ
- âœ… é¢„è§ˆåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç¼–è¾‘æ“ä½œæ— å¼‚å¸¸
- âœ… ä¸å†æ˜¾ç¤º"ç´ æä¸¢å¤±"é”™è¯¯

## ğŸ“š æ ¸å¿ƒåŸç†è¯´æ˜

### Windowsè·¯å¾„æ ¼å¼è¦æ±‚
å‰ªæ˜ (CapCut)åœ¨Windowsç¯å¢ƒä¸‹æœŸæœ›çš„è·¯å¾„æ ¼å¼ï¼š
```
ç›˜ç¬¦:\è·¯å¾„\æ–‡ä»¶å¤¹\å­æ–‡ä»¶å¤¹\æ–‡ä»¶å.æ‰©å±•å
```

### build_asset_pathå‡½æ•°ä½œç”¨
è¯¥å‡½æ•°è´Ÿè´£æ ¹æ®ç›®æ ‡å¹³å°ç”Ÿæˆæ­£ç¡®çš„è·¯å¾„æ ¼å¼ï¼š
- æ£€æµ‹è·¯å¾„ç±»å‹ï¼ˆWindows/Unixï¼‰
- å¤„ç†è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ\ vs /ï¼‰
- ç”Ÿæˆç»å¯¹è·¯å¾„æ ¼å¼

### OSSä¸‹è½½ä½¿ç”¨æµç¨‹
1. ç”¨æˆ·ä¸‹è½½OSSå‹ç¼©åŒ…åˆ°Windows
2. è§£å‹åˆ°å‰ªæ˜ è‰ç¨¿æ–‡ä»¶å¤¹
3. å‰ªæ˜ è¯»å–draft_info.json
4. æ ¹æ®è·¯å¾„ä¿¡æ¯è¯†åˆ«ç´ ææ–‡ä»¶

## ğŸ›¡ï¸ é¢„é˜²æªæ–½

### ä»£ç æ”¹è¿›
- ç»Ÿä¸€è·¯å¾„å¤„ç†é€»è¾‘
- å¢åŠ è·¯å¾„æ ¼å¼éªŒè¯
- å®Œå–„é”™è¯¯æ—¥å¿—è®°å½•

### æµ‹è¯•è¦†ç›–
- OSSæ¨¡å¼è·¯å¾„æ ¼å¼æµ‹è¯•
- è·¨å¹³å°å…¼å®¹æ€§æµ‹è¯•
- è·¯å¾„å¤„ç†è¾¹ç•Œæµ‹è¯•

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¿®å¤æˆåŠŸè§£å†³äº†OSSæ¨¡å¼ä¸‹å‰ªæ˜ æ— æ³•è¯†åˆ«ç´ æçš„é—®é¢˜ï¼š

**æ ¹æœ¬åŸå› **: OSSæ¨¡å¼ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå‰ªæ˜ æœŸæœ›ç»å¯¹è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**: OSSæ¨¡å¼ä½¿ç”¨é»˜è®¤Windowsè·¯å¾„ç”Ÿæˆç»å¯¹è·¯å¾„æ ¼å¼

**ä¿®å¤æ•ˆæœ**: OSSè‰ç¨¿ä¸æœ¬åœ°è‰ç¨¿åœ¨å‰ªæ˜ ä¸­è¡¨ç°å®Œå…¨ä¸€è‡´

**æŠ€æœ¯äº®ç‚¹**: 
- ä¿æŒå‘åå…¼å®¹æ€§
- ç»Ÿä¸€è·¯å¾„å¤„ç†é€»è¾‘  
- æœ€å°åŒ–ä»£ç å˜æ›´

---

**ä¿®å¤æ—¶é—´**: 2025å¹´8æœˆ6æ—¥  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯  
**å½±å“ç‰ˆæœ¬**: CapCutAPI v1.1.0åŠä»¥åç‰ˆæœ¬ 